# バックアップと復元

---

## SQL SERVER のバックアップの仕方

1. バックアップしたいテーブルを右クリックする。  
2. [タスク∟バックアップ] を選択する。  
3. 全般のバックアップ先に[保存先]と[保存名.bak]を設定する。  
4. オプション ∟ メディア ∟ 上書きのオプションボタンを[既存のすべてのバックアップセットを上書きする]を選択する。  
5. OKを押してバックアップを実行する。  

---

## バックアップからの復元の仕方

1. 適当なデータベース右クリックする。  
2. 新しいデータベースの作成を選択する。  
3. データベース名を設定する。  
4. 特に何も設定しないでOKボタンを押す。  
5. 作成したDB右クリック
6. タスク→復元→データベース

- 全般  
  - ソース欄のチェックボタンをデータソースからデバイスに変更。  
  - デバイス入力欄右にあるメニューを開く。  
  - 追加ボタンを押す。  
  - バックアップする.bakファイルを選択する。  
  - OKボタンを押して復元するファイルを確定する。  
  - 転送先を作成したデータべースに変更する。(この変更先を間違えてはいけない)  

- ファイル  
  - [すべてのファイルをフォルダーに移動する] チェック入れない  
  - 論理ファイル名、ファイルの種類、元のファイル名、復元先と並んでいるリスト部分において復元先に書いてあるパスの最後のほうにあるデータベース名を作成したデータべースに変更する。(ここも間違えてはいけない)  
  - 2つリストに登録されているが、どちらのデータベース名も変更する。  

- オプション  
  - [既存のデータベースを上書きする] チェック入れる  
  - [ログ末尾のバックアップ] チェック外す(チェックが入っていることがある)  

---

## Insert Go文の作り方

1. データベースを右クリック  
2. タスク→スクリプトの生成  
3. 次へボタンを押す  
4. 特定のデータベースオブジェクトの選択  
5. 対象テーブルを選択して次へ  
6. クリップボードにコピーか新しいクエリウィンドウに保存  
7. 詳細設定ボタン  
   - 全般 : `USE DATABASEのスクリプトを作成` → False  
   - `サーバーのバーション互換のスクリプト` → SQLServer2008R2にする  
   - `スクリプトを作成するデータの種類` → データのみに設定  
8. 次へを押していけば完了  

---

## CREATE TABLEのスクリプト出力

CREATE TABLEする時のSQL文を出力するためにはスクリプトを実行する必要あり。  

1. データベースを右クリック  
2. タスク→スクリプトの生成  
3. 次へボタンを押す  
4. 特定のデータベースオブジェクトの選択  
5. 対象テーブルを選択して次へ  
6. クリップボードにコピーか新しいクエリウィンドウに保存  
7. 詳細設定  
   - `スクリプトを作成するデータの種類` → `スキーマのみ` になっていることを確認  
8. 次へを押していけば完了  

[【SQL Server】SSMSを使用して、各種定義やレコードをエクスポートする](https://sqlserver.work/2020/06/28/ssms%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%80%81%E5%90%84%E7%A8%AE%E5%AE%9A%E7%BE%A9%E3%82%84%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC/)  

---

## テーブルを複製する方法

``` sql
SELECT * INTO コピー先テーブル名 FROM コピー元テーブル名
```

`コピー元テーブル名`は名前の指定だけあればよい。  
あらかじめテーブルを作成する必要は無し。  
実行するとテーブルもSQLServerが自動でテーブルも作成してくれます。  
※注：ただし、テーブルは規定の領域（なにも設定してなければPrimary）に作られるので、ファイルグループ管理は要注意。  

[[SQLServer]テーブルをまるっとコピーする方法](https://ameblo.jp/nature3298type-s/entry-10313449987.html)
