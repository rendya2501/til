# SQLServer関係メモ

## SQL SERVER のトランザクション命令

BEGIN TRANSACTION  
COMMIT TRANSACTION  
ROLLBACK TRANSACTION  

---

## null許可のフィールドを追加→変更の保存が許可されていません

[変更の保存は、エラー メッセージで許可SSMS](https://docs.microsoft.com/ja-jp/troubleshoot/sql/ssms/error-when-you-save-table)  

科目大区分を新規作成するに当たり、科目区分テーブルにnull許可の科目大区分CDフィールドを追加しようとしたら発生した。  
フィールドを追加する際に結構発生するイメージがある。  
オプション一つで解決可能であるが、備忘録として残しておく。  

1.[ツール] メニューの [オプション] をクリックします。  
2.[オプション] ウィンドウのナビゲーション ウィンドウ で 、[デザイナー] をクリックします。  
3.[テーブルの再作成を必要 とする 変更の保存を防止する] チェック ボックスをオンまたはオフにし 、[OK] をクリックします。  

[SQL Server カラム定義を変更すると「変更の保存が許可されていません」が表示された場合の対処法](https://nasunoblog.blogspot.com/2013/10/sql-server-column-edit-error.html)  
このサイトのほうが読みやすい。  
因みにこの現象が発生する原因としてはテーブルの監視履歴が削除されてしまうからだそうで。  

---

## テーブルデザイナーにコメント列を追加する方法

あると便利といわれたのでまとめ。  
レジストリをいじらないと駄目です。  

[SSMS のテーブルデザイナの列をカスタマイズした](https://qiita.com/d01tsumath/items/906043d69f86a6a53cef)  
[SQL Server Management Studio のテーブルデザイナの列をカスタマイズする](https://blog.xin9le.net/entry/2018/06/17/165526)  

---

## SQL SERVER のバックアップの仕方

・バックアップしたいテーブルを右クリックする。
・タスク∟バックアップ　を選択する。
・全般のバックアップ先に保存したい先と保存名.bakを設定する。
・オプションのメディアに上書きのオプションボタンを
　既存のすべてのバックアップ　セットを上書きする　を選択する。
・OKを押してバックアップを実行する。

---

## バックアップファイルの復元の仕方

●DBを作成する
・接続先：SQLSV2008R2
・適当なデータベース右クリックする。
・新しいデータベースの作成を選択する。
・RaundDat○○を作成。
・特に何も設定しないでOKボタンを押す。

●データ移行
・作成したDB右クリック
・タスク→復元→データベース

	●ページの選択：全般
・ソース欄のチェックボタンをデータソースからデバイスに変更。
・デバイス入力欄右にあるメニューを開く。
・追加ボタンを押す。
・バックアップする.bakファイルを選択する。
　研修では移動用\RoundDatTaxText.bakを選択する。
・OKボタンを押して復元するファイルを確定する。
・転送先をRaundDat○○に変更する。(この変更先を間違えてはいけない)

	●ページの選択：ファイル
・すべてのファイルをフォルダーに移動するにはチェックしなくていい。
・論理ファイル名、ファイルの種類、元のファイル名、復元先と並んでいるリスト部分において
　復元先に書いてあるパスの最後のほうにあるデータベース名をRaundDat○○に変更する。(ここも間違えてはいけない)
・2つリストに登録されているが、どちらのデータベース名も変更する。


	●ページの選択：オプション
・既存のデータベースを上書きするにチェックを入れる。
・ログ末尾のバックアップにチェックが入っていることがあるのでそのチェックは外す。

---

## Insert Go Insert Go文の作り方

・Eco3Sys_Otaru等のデータベース名を右クリック
・タスク→スクリプトの生成
・次へボタンを押す
・特定のデータベースオブジェクトの選択
・データベースの中から取り出したいテーブルを選択して次へ
・スクリプトを指定した場所に保存
・詳細設定ボタン
　・全般の中のUSE DATABASEのスクリプトを作成をFalseに
	サーバーのバーション互換のスクリプトをSQLServer2008R2に
	スクリプトを作成するデータの種類をデータのみに設定
・クリップボードにコピーか新しいクエリウィンドウに保存
・次へを押していけば完了
