# データベース

---

## レプリケーション

レプリケーション : 複製

[わかりそうレプリケーション (replication)](https://wa3.i-3-i.info/word12869.html)  

平成30年春午後のネットワークでレプリケーションサーバーってのが出てきて、単語だけ調べるつもりだったけど、DBにまで範囲が及んだのでまとめることにした。  
レプリケーションは複製という意味になる。  
オリジナルDBに書き込みつつ、同じ内容をレプリカDBにも書き込む事をレプリケーションというらしい。  
つまり、リアルタイムに複製を生成する技術ということになるか。  

話だけ聞くとバックアップと同じように感じるが、バックアップはある時点のデータをメディアに記録して別の場所に保管することを指すので、全然違う。  
後、障害が発生した場合、環境から用意しないといけないが、レプリケーションは同じ環境で動作しているものを切り替えるだけで済むので対応力も違う。  
一応その記事も置いておきますね。  
[レプリケーションとは？バックアップと何が違う？](https://bcblog.sios.jp/what-is-replication/)  

---

## サロゲートキー

<https://amg-solution.jp/blog/8980>  

surrogate : 代理  

代理キー。  
ウチで言う一番左のid列のこと。ソートの為にあるようなやつ。  
それ単体では意味を持たないが、一意であるキー。  
主キーを設定すること。  

---

## PRIMARY KEY (主キー) と UNIQUE の違い

[PostgreSQL - PRIMARY KEY (主キー) と UNIQUE の違い](https://esthersoftware.hatenablog.com/entry/deference-between-primarykey-and-unique-postgresql)  

### PRIMARY KEY と UNIQUE の違いとは？

Primary Key（主キー）とUniqueはどちらも「データが一意である」制約を設定するものです。それならこの2つに違いはあるの？と気になったので調べてみました。

### PRYMARY KEY(主キー)

・「テーブル内の行データを識別するために設定でき、重複した値を許さないカラム」のこと
・複数のカラムに対して設定可能
・NULLは許可されない
・UNIQUE制約と非NULL制約を組み合わせたもの
・この制約は一つのテーブルに対して一つしか設定できない

[主キー（primary key）を複数のカラムに、その名は複合主キー（composite primary key ）](https://ts0818.hatenablog.com/entry/2017/02/04/162513)  

主キーが1つだけしか許可されないなら、複数のカラムに主キーを設定してるあれはなんなの？  
→  
複数のカラムをまとめて複合キーとして、その複合キーに対して主キーを設定している。  
なので主キーを実質1つしか設定していないことになるので、問題がないということ。  

### UNIQUE制約

・「カラムまたはカラムのグループに含まれるデータが、テーブル内の全ての行で一意であることを確実にする」ということ  
・つまり行データを識別する必要は無いけれど、あるカラムに対して重複した値が入るのを禁止したいときに使う  

・重複した値の入力が不可能になる。  
・NULLは許可されている。  
・この制約は一つのテーブルに対して複数設定することができる。  

### まとめ

・PRIMARY KEYもUNIQUEもデータに一意性を持たせる点は同じ  
・目的によって使い分けができる  

PRIMARY KEY : テーブル内の行データを特定するために一意性を持たせる。  
UNIQUE制約 :  重複した値を格納したくないカラム（またはカラムのグループ）に一意性を持たせる。  

というわけなので、このカラムとこのカラムを主キーにするってことは出来なくて、  
このカラムとこのカラムを合わせて複合キーとして、その複合キーに対して主キーを設定するのはOK。  
UNIQUEキーなら、このカラムとこのカラムにユニーク制約を課すってのはOK。  
この違いが主キーとユニークキーの違いってところじゃないですかね。  

---

## CASCADE

削除するテーブルに依存しているオブジェクト（ビューなど）を自動的に削除します。  

DROP TABLEは、削除対象のテーブル内に存在するインデックス、ルール、トリガ、制約を全て削除します。  
しかし、ビューや他のテーブルから外部キー制約によって参照されているテーブルを削除するにはCASCADEを指定する必要があります  
（CASCADEを指定すると、テーブルに依存するビューは完全に削除されます。  
しかし、外部キー制約によって参照されている場合は、外部キー制約のみが削除され、その外部キーを持つテーブルそのものは削除されません）。  
