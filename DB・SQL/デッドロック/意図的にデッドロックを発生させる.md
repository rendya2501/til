# 意図的にデッドロックを発生させるサンプル

[Oracle DBでDEAD LOCKをさくっと発生させる](https://tomoima525.hatenablog.com/entry/2013/12/19/201157)  
[デッドロックについて説明してみる - その 2 ( C# で deadlock を例外処理でキャッチしてみる ) -][https://ryuchan.hatenablog.com/entry/2016/10/16/173225]  

``` sql
DROP TABLE IF EXISTS [TEST_TBL1];
DROP TABLE IF EXISTS [TEST_TBL2];
CREATE TABLE [TEST_TBL1] ( 
    ID INT NOT NULL PRIMARY KEY, 
    Name NVARCHAR(50) 
); 
CREATE TABLE [TEST_TBL2] ( 
    ID INT NOT NULL PRIMARY KEY, 
    Name NVARCHAR(50) 
); 


INSERT [TEST_TBL1] (ID, Name) 
VALUES
    (1,'test001'),
    (2,'test002');
INSERT [TEST_TBL2] (ID, Name) 
VALUES
    (1,'test001'),
    (2,'test002');

-- 別々のタブを開いて別々に実行する
-- まずこっちを実行してから
BEGIN TRAN
UPDATE [TEST_TBL1]
SET [Name] = 'aaaaa'
WHERE ID = 2;

WAITFOR DELAY '00:00:05';

UPDATE [TEST_TBL2]
SET [Name] = 'bbbbb'
WHERE ID = 2;
COMMIT TRAN

-- こっちを実行する
BEGIN TRAN
UPDATE [TEST_TBL2]
SET [Name] = 'ccccc'
WHERE ID = 2;

WAITFOR DELAY '00:00:03';

UPDATE [TEST_TBL1]
SET [Name] = 'dddd'
WHERE ID = 2;
COMMIT TRAN
```
