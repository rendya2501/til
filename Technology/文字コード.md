# 文字コード

## ASCII (American Standard Code for Information Interchange)

「ASCII（American Standard Code for Information Interchange）」は、コンピュータ上でテキストを扱うために使用される7ビットの文字コード。  
ASCIIは、文字に対して一意に割り当てられた7ビットのコードを使用しているため、128個の文字を表現することができる。  

ASCIIに含まれる文字には、大文字アルファベット（A～Z）、小文字アルファベット（a～z）、数字（0～9）、句読点（カンマ、ピリオド、クォート）、制御文字（改行、タブ、エンターなど）などがある。  

ASCIIは、初めて1963年にアメリカ合衆国で標準化され、以降世界中で広く使用されてきました。  
ASCIIは、英語圏でのコンピュータの普及に大きく貢献した一方で、非英語圏の文字を扱うことができないため、国際的な利用には不向きであるという欠点がありました。  
そのため、Unicodeの登場により、より多くの言語をサポートすることができるようになりました。  

---

## Unicode

「Unicode」とは、世界中のあらゆる言語の文字を統一して扱えるように設計された文字コードの一つです。  
Unicodeは、ASCII文字を含め、世界中のあらゆる言語で使用される文字を表現できるように設計されています。  

Unicodeは、文字に対して一意に割り当てられるコードポイントを使用しています。  
Unicodeのコードポイントは16進数(65535)で表現され、U+の後に4桁または6桁の16進数で表されます。  
たとえば、「あ」のUnicodeコードポイントは`U+3042`です。  

Unicodeは、UTF-8、UTF-16、UTF-32などのエンコーディング方式を持ち、それぞれ異なるバイト数で文字を表現します。  
UTF-8は1バイトから最大4バイトまでの可変長エンコーディング方式で、UTF-16は2バイトまたは4バイトの固定長エンコーディング方式で、UTF-32は4バイトの固定長エンコーディング方式です。  
Unicodeは、現在では広く使われている標準の文字コードの一つであり、多言語対応のアプリケーションやWebページ、データベースなどで広く利用されています。  

---

## Shift_JIS

「Shift_JIS」とは、主に日本語のテキストを表現するための文字コードの一つであり、日本のマイクロソフトが開発した文字コードです。  
Shift_JISは、2バイト文字として日本語の漢字やカタカナを表現する方法を採用しています。  

Shift_JISは、ASCIIコード（1バイト文字）に対応する部分では、ASCIIコードと同じ値を使用します。  
2バイト文字の場合、先頭バイトが0x81から0x9F、0xE0から0xFCのいずれか、および0x80から0xFFまでの範囲の中間バイトを使用します。先頭バイトに続く2番目のバイトは、0x40から0x7E、0x80から0xFCのいずれかの値を使用します。  

Shift_JISは、Windowsなどの日本語環境のコンピューターで広く使われており、日本語のテキストファイルやWebページなどでよく利用されています。  
しかし、Shift_JISは日本語以外の言語を表現するのには向いておらず、Unicodeに比べて表現できる文字種が限られているため、国際化に対応するためにはUnicodeなどの多言語対応文字コードの使用が推奨されています。  

---

## ANSI(American National Standards Institute)

ANSI とは、American National Standards Institute（アメリカ国立規格協会）の略称で、アメリカ合衆国における規格制定の中心的な組織の一つです。  

一般的に「ANSI」という用語は、この組織が制定した規格を指す場合が多いです。  
コンピュータ分野においては、例えば文字コードの ANSI シリーズ（Windows-1252 など）や、POSIX に準拠した機能の ANSI C などが有名です。  
ただし、ANSI が制定した規格は必ずしも世界的な標準ではないため、注意が必要です。  

### Shift_JISがANSIと表記される理由

Shift_JIS が ANSI と表記されることがあるのは、Windows オペレーティングシステムにおいて日本語を扱うために、Microsoft 社が開発した文字コード表現の一つが「Windows-31J」という名称で、Windows の API においてはこの名称で参照されることが多いためです。  

Windows-31J は、Shift_JIS の拡張版で、Windows 上での日本語表示に最適化されているため、日本語環境においては一般的には Shift_JIS として認知されています。  
しかし、Windows 上での API の仕様としては Windows-31J という名称が用いられており、API における Windows-31J は ANSI という扱いを受けるため、Shift_JIS が ANSI と表記されることがあります。  

>歴史的な経緯等は原典を見つけられなかったのですが、『ANSI』はそのロケールの既定の文字コードを表す単語らしく日本語だとShift_JIS（CP932）を表します。  
>[Shift_JISと死の文字化け](https://jyuch.hatenablog.com/entry/2018/12/21/000000)  

<!--  -->
>日本語 Windows では、Shift_JIS の事を、なぜか ANSI と呼んでいます。  
>（参考 <http://www.webword.jp/xhtml/basic/index11.html>）  
>
>ところが、「日本語 Windows で ANSI と呼ばれている Shift_JIS」は、実は Shift_JIS に Microsoft が独自拡張を加えたもので、本来は CP932（コードページ932）という文字コードです。  
>
>ただし、この CP932 は Shift_JIS を単純に拡張したものではなく、文字によってはコードに互換性がありません。  
>
>ですから、「日本語 Windows で ANSI と呼ばれているのは CP932 であり、これは Shift_JIS が拡張されたもの」という解釈が、おそらく正しいものです。  
>
>普段の認識としては、「日本語 Windows では Shift_JIS を ANSI と言っている」程度の認識で良いかと思います。  
>
>[ANSIコードってなんですか？Shift-JISの別名？ - 日本語... - Yahoo!知恵袋](https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q1490895514)  

---

## Windows-31J(MS932)

[Shift_JIS と Windows-31J (MS932) の違いを整理してみよう |](https://weblabo.oscasierra.net/shift_jis-windows31j/)  

---

## UTF-8 (Unicode Transformation Format 8-bit)

Unicode用の符号化方式の1つ。  
ASCIIで定義している文字をUnicodeでそのまま使用する事を目的として制定している。  
Unicodeを使った文字コードで、1文字を1バイトから6バイトで表す。

ASCIIと同じ部分は1バイトで表現し、そのほかの部分を2~6バイトで表現する可変長の符号化方式。  
漢字、かな文字は3~4で表現するため、UTF-16を比較するとデータサイズが大きくなる。  

UTF-8は、Unicode 文字セットをエンコードするための文字エンコーディング方式です。
UTF-8 は、可変長エンコーディング方式を使用しているため、1 文字に必要なバイト数が変わることがあります。
これにより、日本語や中国語などの文字を含む文書でも、英語などの文字を含む文書でも、同じように圧縮することができます。

UTF-8 は、拡張 ASCII 形式を採用しているため、ASCII 文字には特別な処理が必要なく、ASCII 文字を扱うために使用される既存のエンコーディング方式との互換性が高いというメリットがあります。

UTF-8 は、Web ページやエレクトロニックメール、XML 文書など多様な分野で使用されており、世界的に普及している文字エンコーディング方式の一つです。

### Unicodeの「あ」をUTF-8で表現した場合

UTF-8 では、文字をエンコードする際に、文字の Unicode コードポイントに応じて 1〜4 バイト必要になります。  
Unicode の「あ」 (U+3042) のコードポイントは、U+3042 (12354) であり、UTF-8 でエンコードされると、3バイトのコードポイントとなります。  

`0xE3 0x81 0x82`

ここで、各バイトを 8 ビットずつ分解すると、以下のようになります。  

`11100011 10000001 10000010`  

このように、各バイトを分解することで、3バイト必要となっていることがわかります。  

UTF-8 では、1バイトから 4バイトまで必要なバイト数が異なります。  
このような方式により、ASCII 文字 (7ビット) 以外の文字をエンコードする際にも効率的に表現することができます。  
UTF-8 のエンコード方式は、より多くのメモリを必要とすることに対して、エンコード・デコードのスピードを高めることができるメリットがあります。  
また、ASCII 文字を含むテキストデータも効率的にエンコードすることができます。  

---

## UTF-16 (Unicode Transformation Format 16-bit)

UTF-16は、Unicode 文字セットをエンコードするための文字エンコーディング方式。  
UTF-16 は、2 バイトまたは 4 バイトを使用して文字をエンコードすることができる。  

UTF-16 では、基本的な文字（例えば英数字や記号）は 2 バイトでエンコードされるが、常に 4 バイトを使用する必要のある文字（例えば中国語など）もサポートしている。  
このため、UTF-16 は、Unicode 文字セットのすべての文字を表現するために必要な空間を提供する。  

UTF-16 は、Windows オペレーティングシステムや Java 言語など、多くのプラットフォームで使用されています。
また、UTF-16LE（Little Endian）や UTF-16BE（Big Endian）など、エンディアンのバリエーションも存在します。

一方で、UTF-16 は、可変長エンコーディング方式ではないため、文字数に応じて常に 2 倍の空間が必要となるというデメリットがあります。
このため、UTF-8 などの可変長エンコーディング方式と比較して、ストレージや通信において効率が悪いという問題があります。

### なぜutf16は開発されたのか？

UTF-16 は、Unicode 文字セットをエンコードするために開発されました。
当時、ASCII 等の既存のエンコーディング方式では、多言語環境に対応することが困難であったため、より多言語に対応する文字エンコーディング方式が必要とされました。

UTF-16 は、全ての Unicode 文字を固定長で表現することができるというメリットがありました。
このため、UTF-16 は Windows オペレーティングシステムや Java 言語などで採用されるようになりました。

ただし、UTF-16 の場合、ASCII 文字を扱うために使用される既存のエンコーディング方式との互換性が低いため、圧縮効率が低いという問題があります。
また、1 文字に必要なバイト数が 2 バイトまたは 4 バイトとなるため、メモリを多く使用するという問題もあります。

そのため、UTF-16 は今でも普及している UTF-8 に対して比較的特定のプラットフォームやアプリケーションで使用されるにとどまっています。

一方、UTF-8 は、ASCII 文字を扱うために使用される既存のエンコーディング方式との互換性が高いため、Web ページやエレクトロニックメールなど多様な分野で採用されるようになりました。
また、可変長エンコーディング方式を採用するため、メモリを少なく使用するというメリットもあります。

とはいえ、UTF-16 は、特定のプラットフォームやアプリケーションに対して必要な文字エンコーディング方式として重要な役割を果たしています。

### Unicodeの「あ」をUTF-16で表現した場合

Unicode "あ" のコードポイントは `U+3042`  

UTF-16 では、コードポイントを 16 ビットの符号単位に変換し、それを2バイトで表現する。  

`U+3042 -> 0x3042`

この値を UTF-16 でエンコードすると、先頭バイトと後続バイトの区別がなく、2バイトで表現される。  

`0x3042 -> 0x30 0x42`  

上位バイトが先頭バイトであり、下位バイトが後続バイトになる。  
ここで、各バイトを ビットに分解すると、以下のようになります。

0x30 0x42
`0000 0000 0011 0000`  `0000 0000 0100 0010`  

それぞれの 16 進数表記の数値は 4 ビットで表現されるため、合わせて 16 ビットで表現されます。  
つまり、UTF-16 において 1 文字を表現するためには 16 ビットの符号単位が必要であり、この例の場合は先頭バイトと後続バイトが合わさって 16 ビットで 1 文字が表現されていることになります。  

---

## UTF-8とUTF-16の違い

>文字を表現する単位が違う。  
>UTF-8は8ビット、UTF-16は16ビットの可変長マルチバイトで文字を表現する。  
>
>UTF-16は、2バイトで表現できる文字はそのまま2バイトで表現し、それ以降の文字は4バイトで表す。  
>そのため、英数も日本語も全て2バイトで表現される。  
>対して、UTF-8は英数は1バイトで表現し、日本語は3バイトで表現するようになっている。  
>
>つまり、英数の割合が多い場合はUTF-8のほうが効率がいいが、日本語が多い場合はUTF-16のほうが効率が良いと言える。  
>
>[UTF-8とUTF16の違いは？](https://atmarkit.itmedia.co.jp/fxml/askxmlexpert/024utf/24utf.html)  

utf8とutf16の違いを説明してください。
UTF-8 と UTF-16 は、Unicode 文字セットをエンコードするための文字エンコーディング方式ですが、それぞれ異なる特徴があります。

エンコード方式:  
UTF-8 は可変長エンコーディング方式を採用しています。  
このため、1 文字に必要なバイト数が変わります。  
一方、UTF-16 は固定長エンコーディング方式で、1 文字に必要なバイト数は 2 バイトまたは 4 バイトです。  

圧縮効率:  
UTF-8 では、ASCII 文字には特別な処理が必要なく、ASCII 文字を扱うために使用される既存のエンコーディング方式との互換性が高いため、英語などの文字を含む文書を圧縮する場合に優れた圧縮効率を発揮します。  
一方、UTF-16 では文字数に応じて常に 2 倍の空間が必要となるため、圧縮効率が低いという問題があります。  

使用範囲:
UTF-8 は Web ページやエレクトロニックメール、XML 文書など多様な分野で使用されており、世界的に普及している文字エンコーディング方式です。  
一方、UTF-16 は Windows オペレーティングシステムや Java 言語など、特定のプラットフォームやアプリケーションで使用されています。  

これらの違いから、使用するシーンや要件に応じて、UTF-8 または UTF-16 のどちらを使用するかを決定する必要があります。  

---

## utf16をutf8で置き換えても問題がない？

はい、UTF-16 を UTF-8 に置き換えても問題がないこともあります。
特に、Web 上のコンテンツやエレクトロニックメールなど、ASCII 文字を多く扱う場合は、UTF-8 の方が圧縮効率が高く、メモリ使用量も少ないため、優位な選択肢になります。

しかし、UTF-16 に特化したプラットフォームやアプリケーションがあり、これらに対して UTF-8 に置き換えると問題が発生する場合もあります。
また、UTF-16 が使用されている環境下では、UTF-16 が採用された理由（多言語対応や固定長エンコーディング）を考慮することで、UTF-16 の使用が有効な選択肢であることもあります。

とはいえ、UTF-8 は、多言語対応を要求される環境下で広く使用されているエンコーディング方式となっており、将来的には UTF-16 の使用が減少することも予想されます。  

---

## サロゲートペア

1つの文字に対して 2つの文字コードを使って表される文字のこと。  

>ユニコードにおいて標準化された文字符号化方式、UTF-16で用いられる符号化の拡張方法。  
>2バイトで定義された基本多言語面に含まれない拡張領域の文字を、2バイトのバイト列二つを組み合わせて、計4バイトで表す。  
>追加漢字面の漢字をはじめ、約100万字の文字の符号化が可能となる。  
>[サロゲートペアとは？ 意味や使い方 - コトバンク](https://kotobank.jp/word/%E3%82%B5%E3%83%AD%E3%82%B2%E3%83%BC%E3%83%88%E3%83%9A%E3%82%A2-1825148>)  

コンピューターで文字を表すために世界中が頑張った。  
様々な符号化文字集合と文字符号化方式が乱立した。  
Unicode「全世界のあらゆる文字を1つの符号化文字集合のもとに統一しよう!!!」  
Unicode「16bit,65536種分の領域があれば、あらゆる文字を格納できるはず!!!!!!」  
Unicode「あかん、これ65536文字じゃたらんくね？でももう世界中で実装されてるし、今更なかったことにはできん!!!!」  
Unicode「しゃーない!!!使われてない2つの領域があるから、そいつら組み合わせて1文字ってことにしたろ!!!!組み合わせ増えたら事足りるやろ!!!!」  
→サロゲートペア  

弊害は1文字だと思ったら0.5文字だったみたいな事が出てくること。  

[サロゲートペアってなんでコワイの](https://qiita.com/wingsys/items/81d46451d8b93ab065de)  

---

## 全角文字は何バイト？

>【全角文字は何バイト？】  
>知らない ... 論外  
>2バイト ... 老害  
>3バイト ... 及第点  
>3～4バイト ... 合格  
>KI/KO ... 引退勧告  
><https://twitter.com/ito_yusaku/status/1605410137245569024>  

<!--  -->
>エンコーディングが Shift_JIS であれば半角文字を1バイト、全角文字を2バイトで符号化します。  
>3バイト以上の文字は一つもありません。  
>
>エンコーディングが UTF-8 の場合は1文字を1〜6バイトで符号化します。  
>半角文字は1バイトですが、全角文字は2〜6バイトとなります。  
>
>HTML文書やプログラムを記述する際、エンコーディングに UTF-8 を使う場面は少なくありません。  
>ですから、一律に半角文字は1バイト、全角文字は2バイトと考えることはできません。  
>
>純粋に文字列のバイト数を知りたい場合、PHP では strlen を使用し、全角も1文字として文字数を数えたい場合は mb_strlen を使用します。  
>UTF-8 でも Shift_JIS のように全角を2バイトとして文字を数えたい場合には、mb_convert_encoding を併用すると良いです。  
>[全角文字が3バイト?! PHP で文字を数えるときの注意点](https://www.webmagazine.kakisiti.co.jp/?p=449)  

---

## 外字

[1] wiki:  
外字とは特定の文字集合（文字コードなど）に含まれない文字のことをいう。  
日本で一般には、JIS規格の文字コード（通常はJIS X 0208、稀にJIS X 0213やJIS X 0221）に含まれない文字のことをさし、「表外字」、「拡張漢字(ベンダ選定拡張漢字)」とも呼ばれる。  
常用漢字に含まれない文字のことを外字ということもある。  

[2]  
一般的に外字とは、IMEなどの文字入力ソフトに登録されていない文字で、テキスト入力の際に変換しても表示できない文字を意味します。  
外字に分類されている多くは人名・地名に該当しますが、その他にも枠付き文字・単位記号・省略文字・シンボルマークなどを含んでいます。  
