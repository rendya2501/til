# 平成27年春季

---

## ネットワーク DHCPを利用したサーバの冗長化

なんか釈然としない問題だったな。  
本当にこれでいいのかって感じがすごかった。  
事実それでよかったっぽいんだけど、それがなんというかって感じなんだよな。  
DHCPのやり取りはTCPじゃなくてUDP見たいです。  
これは割と知らなかったのでしっかり復習したいです。  

普通に行けば8問は正解出来た問題だった。  
そこを詰められるかが勝負といったところか。  
1問のミス位だったら許容範囲というか、かなり儲けたほうと言っていいのでは無かろうか。  

``` txt : 30分 6/9
イ
キ
エ × オ

ウ、イ

ブロードキャスト
使用される予定のIPアドレス 0%
→自身の提案が受け入れられたかどうか

192.168.20.2
192.168.20.3
192.168.0.1~192.168.0.254,192.168.20.3,192.168.20.13 × 192.168.20.3,192.168.20.13

---

[1][3]
DHCPは、クライアント→サーバの通信には67/UDP、サーバ→クライアントの通信には68/UDPを使用します。
したがってcには「UDP」が入ります。

「なぜUDPが使用されるのか」というと、DHCPのシーケンス中でブロードキャストが使用されるためです。
TCPはコネクション型で相手との接続を確立してから通信を行う特性があり、不特定多数の相手を宛先とするブロードキャストやマルチキャストができません。
このためDHCPではUDPが使用されているという訳です。


[2][2]
同じネットワークにDHCPサーバが複数存在する場合はクライアントが送信したDHCP DISCOVERに対して複数のDHCP OFFERが返されます。
クライアントはこのうち先に受信したものを優先し、受け入れを表明するために、そのDHCP OFFERに含まれる「送信元DHCPサーバのIPアドレス」と「提案されたIPアドレス」を格納したDHCP REQUESTをブロードキャストします。
DHCP REQUESTを受信したDHCPサーバはパケット内容を確認し、自身の提案が受けれられたならばDHCP ACKで構成情報をクライアントに通知します。
そうでなければ自身の提案が破棄されたと判断しDHCP REQUESTを無視します。
要するにDHCPサーバがDHCP REQUESTの内容から判断できることは、自身のDHCP OFFERがクライアントで受理されたかどうかという点です。


[3][2]
ローカルDNSサーバはプロキシサーバ3,4の名前解決を行うためだけに設置され外部ドメインの名前解決を行いません。
このためWebアクセスを行う際は社内DNSに名前解決を要求する必要があります。

P社ではインターネットの利用を全てプロキシサーバ経由で行っています。
プロキシサーバを介したWebアクセスでは、代理アクセスを行う際にプロキシサーバがDNSに名前解決要求を行います。

<https://www.ap-siken.com/kakomon/27_haru/img/pm05_9.gif>

図3中でPCからのHTTPリクエストを一旦受け取り、実際にWebアクセスを行うのはプロキシサーバ3および4なので、社内DNSを利用するのはこの2つのサーバになります。

→
あー・・。あ？
プロキシサーバーのIPアドレスを取得するのと、プロキシサーバーがWebにアクセスするときに使う2つの意味で答えたのだが、そこまで考える必要はなかったっぽい？
「PCのWebブラウザでインターネットを利用する際に」
はい。もうプロキシサーバーの問い合わせは終わった後の話っぽいですね。
ならプロキシのIPしかないですわ。
おわり。
```

---

## データベース アクセスログ監視システムの構築

特にむずかしさは感じなかったが、細かいところでわからないところはあったのでしっかり詰める。  

・参照制約はどちら側に設定するものなのか  
→マスターを参照する側に付ける  

・クエリの否定は `!=` か `<>`か  
→  
>試験で使用するデータベース言語は，次の仕様に従う。  
>SQL ：JIS X 3005 規格群  
>
>JIS X 3005-2:2015を見ると、不等号演算子としては「<>」のみ定義されていますので、厳密に言えば不正解となります。  
>ただ、DBMS製品では「!=」を許容しているものが多いようですので採点上正解にしている可能性もあります。試験では「<>」と記述した方が無難です。  

``` txt : 29分 8/8
→
絶対パス名 × フォルダパス名

EXISTS
NS.非営業年月日 = AC.操作年月日

AC.操作結果 = 'F'
US.部署ID != SV.部署ID × US.部署ID <> SV.部署ID (※順不同)

ウ
利用者、アクセスログテーブル間の利用者ID列の参照制約を解除する 100%
他)アクセスログ表の利用者ID列に定義された参照制約を削除する (29文字)


[b]
文面に明確な答えがなかったので、パスって言葉を入れたけど、惜しかった。
着眼点問題無かった。
部分点くらいはもらえるだろう。

→
本文中のファイルサーバの運用の箇条書きには「ファイルサーバのフォルダごとに社外秘や部外秘などの機密レベルが設定されている」とあります。機密管理エンティティは、サーバごとフォルダごとに存在することになりますが、属性としてはサーバを特定するサーバIDしかありません。よって、フォルダに関する情報を属性に含める必要があります。

ここで「フォルダ名」とする解答案が考えられますが、単なる「フォルダ名」では、"/aaa/bbb"と"/ccc/bbb"などのように別の階層に存在する同一名称のフォルダの区別がつかないため、フォルダを正確に示すには（絶対）フォルダパスでなければなりません。問題文中には、アクセスログには「操作対象のファイルの絶対パス名」が記録されると説明されています。アクセスログとフォルダの機密レベルを紐付けるには、やはりフォルダのパス名が必要です。したがって、[b]には「フォルダパス名」などが当てはまります。

[f]
やることはわかったけど、!=か<>か度忘れした。
SQLの標準的には <> らしいので、覚えていこう。
というか、日常的に <> 使ってなかったっけ？
それすら思い出せない。明日試そう。

[4,2]
参照制約だろうなーとは思っていたが、どっちに設定されているものなのかわからなかった。
マスター側ではないほうに設定する模様。
というか、冷静に考えたらそうなるよな。
疲れてるのかな。

→

テーブル定義の変更は(1)の問題を解消するための対応です。
整合性維持の観点から考えると、通常は参照制約違反となる値を許すことはありませんが、今回はアクセスログという特性上、不正な操作を含め全ての操作を記録しなくてはならないので、利用者表の利用者ID列に存在しない値をも受け入れるような設計が求められます。

行の挿入に失敗するのは参照制約が原因なのですから、アクセスログ表の利用者ID列の参照制約（REFERENCES制約）を削除すれば、この問題を解消できます。
ちなみに、参照制約を削除するにはALTER TABLE文＋DROP文を使います。

∴アクセスログ表の利用者ID列に定義された参照制約を削除する
```

---

## 組み込みシステム 自動車用衝突被害軽減ブレーキシステム

うーん・・・半分か。  
これも計算問題が出てきた。  
距離の計算なのだが、それだけでも結構怪しかった。  
中学校からやり直さないといけない。  

ウォッチドッグタイマーの問題を外したのは痛かった。  
多分ほとんどの人間も15を選んだのではなかろうか。  
後は、条件式の問題だ。  
ありゃ？よく見れば思いっきり答えっぽいものがあるな・・・。  
マイナスの事も考えれば当然0以上でなければいけないわけで、なぜこの選択肢が目に入らなかったのか理解できない・・・。  

最初は簡単だと思っていたが、段々点数が取れなくなってきた。  
でも、書いてあること自体は理解できるので、俺の基礎的な知識不足が脚を引っ張っているだけか。  

・分周の意味  
・ウォッチドッグタイマー  
・距離の計算  

``` txt : 回答 30分 5/10
## メモ

衝突までの予測時間・・。
今の速度と相手までの距離
み　は
じ
やべ。簡単な計算が・・・。

10メートル離れている。
次は9メートル。
相対速度は 1m / 0.02s = 50m/秒
今回測定した距離と速度から時間を算出すると？
9m / 50m/s = 0.18s
= 9m * s / 50m
= 9s / 50
= 0.18s

18km/h
18km / 3600s = 0.005km/s = 5m/s

1.5 * 5 = 6.5
1.48 * 5 = 6.4
↑
よく見ると計算間違っているのだが？7.5じゃね？
なんだよ自分で答えの一歩手前まで計算できるてるじゃねーか!!

0.02 = x / 8 * 10^6
0.16 * 10^6
160000



## 1
[1]
a：0.02
b：d2
c：s

[2]
車間距離が開いている状態 ○
他 : 車間距離が広がっている(道場)

[3]
0.4 × 1.5


## 2
[1]
160000 × 20000

[2]
d エ × イ
e ア

[3]
常に警告が表示されてしまう ×
衝突を回避しても警告が止まらない


## 3
イ × ウ
```

``` txt 解説
## 1
きほん : 速度 = 距離 ÷ 時間

(2)
衝突までの予測時間とは、現在の相対速度が継続したときに前の車両と衝突するまでの時間のことで、以下の式で求めることができます。
予測時間 = 現在の車間距離 ÷ 相対速度
現在の車間距離は、前の車両との距離を今回測定した値である d2 です。相対速度には s が入ります。

ここ「み は じ」のあれで行けば時間は道のりと早さの掛け算だから、中々この思考にたどり着かなかった。
ホント、頭悪いなって思う。

(3)
問題文の〔自動ブレーキの構成と動作〕⑤より、緊急ブレーキが作動するのは予測時間が1.5秒未満になったときとわかります。
ブレーキが作動したときの前の車両との距離は以下の式で求めます。
速度(m/s)＝18×1,000m÷3,600秒＝5(m/s)
車間距離＝5(m/s)×1.5秒＝7.5m
これより、前の車両との距離が7.5mの時点でブレーキが作動します。
ブレーキが作動してから停止するまでの走行距離は6mであるため、停止した時の前方車両との距離は「7.5－6＝1.5m」になります。

∴1.5

え、あ、それだけか・・・。
こういう単純なロジックを組み上げるのも割と苦手かもなぁ・・・。
でも、言われてみればこれしかないんだよなぁ・・・。
解いているときは、ここで0.02秒のロジックの事を考えてしまった。
後は1.5秒未満ってところ。
小数点第2位を切り上げって表現も何かしら面倒くさい計算をするんだろうなーって思った。

「1.5未満」ということを厳密にとらえずに、1.5秒の時と考えればいいってitecは書いてあるな・・・。
いや、ならそういってくれよって思うけど・・・。



## 2
[1]
図３の制御部のMCUブロック図よりクロック入力は8MHzであることがわかります。また、分周器は8分周であると説明されています。
クロック入力を8分周した場合のクロック周波数は以下になります。
 8MHz÷8分周＝1MHz
周波数(Hz)とは、1秒間に存在する波の数で、1MHzは1秒間に1,000,000回の波が生じることを表しています。
1,000,000回／秒の波を使って20ミリ秒（1／50秒）をカウントしたいので、タイマのカウント値に設定すべき値は、
 1,000,000回×1／50＝20,000回
∴20,000

あー・・・やっちまったな。
分周は周波数を割るって認識でよかった。
でもって、問題文中に8MHzってかかれてますね。
これを8で割ったら1MHzになりますね。
1Mって100万ですよね？
1秒間に100万回カウントダウンするわけで、0.02になるためには20000をセットしないといけないというわけです。

[2]
問題文の〔制御部の構成とタイマ割込みソフトウェア〕に、タイマ割込みは20ミリ秒間隔で発生すると説明されています。
よって、図４のフローが20ミリ秒間隔で実行されることになります。
処理B「警告信号の出力を停止」を行わない場合、単純に警告信号が消えない不具合が発生します。
具体的には、警告信号が出力された後、予測時間が0秒未満または3秒以上（警告対象外）になっても警告信号が表示されたままになってしまいます。
警告信号は衝突しそうなときに出力されるので、「衝突を回避しても警告が止まらない」などの言葉が適切となります。
∴衝突を回避しても警告が止まらない

パッと見、通常状態でも警告が表示されるように見えたのでその通りに応えたが、考えてみれば、そうだよなって思う。
警告が表示されて、原則したとしても、確かにこの条件なら表示され続けてしまう。
もう一つ必要だったというわけか。
この考えに至るためにはユースケースを考えないといけない。
それも常識的な範囲でだ。



## 3
20msの中での話だと思い込んだ結果。
全体は20msで応答に10ms。
間をとって15msがもっともらしいと感じる。
まぁ、感じるだけで、25という選択肢がある地点で疑うべきではあった。
しっかり解説を読み込むことにする。

あー・・・。なんか色々勘違いしてたな。
問題文を読めば、割り込みを発生させる間隔とある。
20ms以内に発生させてしまったら意味ないじゃないか。
20ms超えてリセットされないってことは異常なわけだから、普通に考えて20ms以上の選択肢を選べばいいだけの話か・・・はぁ。


●解説
※ウォッチドッグタイマ
システムに異常が発生したことを検知し、それを通知する目的で設定されるタイマです。
ウォッチドッグタイマには適切な時間がセットされていて、システムが正常なときは一定時間ごとにカウントをリセットしています。
しかし、システムに異常が起こるとリセットが行われなくなり、ウォッチドッグタイマのカウントが増加し続けることになります。
リセットがされないまま所定の時間を経過した場合には、システムに何らかの異常が発生していると判断し、
ウォッチドッグタイマがノンマスカブル割込みによってシステムに異常を通知するという仕組みになっています。

タイマ割込みソフトウェアにおけるタイマ割込みは20ミリ秒周期で実行され、タイマ割込みのフロー中でウォッチドッグタイマの初期化が行われています。
タイマ割込みが20ミリ秒周期なので、ウォッチドッグタイマに20ミリ秒よりも短い時間を設定すると、（タイマ割込みが正常に動作していたとしても）次のタイマ割込みの前に異常通知が行われてしまいます。このため、ウォッチドッグタイマの割込み時間には20ミリ秒よりも長い時間を設定する必要があります。

選択肢の中で20ミリ秒よりも長い時間は「ウ」だけです。
```

---

## 情報システム開発 チケット販売システムの在庫調整機能の開発

いや、久しぶりに敗北した。
専門用語や知識等は関係なく、時系列を追って理論的に求めるタイプの問題だった。  
全体的に言いたいことはわかったのだが、どうにも辻褄が合わなくてうんうん悩んでいたら30分を超えてしまった。  
解説を一通り読んだ後だと、問題文中にヒントが散りばめられているのがわかりましたが、試験中に気が付くのは難しいと思います。  

数字のマジックとロールバック処理をうまく組み合わせた問題だと思いました。  
気が付かないと解けなかったり、混乱の渦に飲まれてしまうので、難易度は高めだなって思いました。  

``` txt : 30分オーバー 1/7 実質2
タグ × 要素

D社が販売を再開できない 0%
→対象公園が販売停止のままになる
C社ファイル送信エラー 0%
→C社ファイル受信回答未実施
D社ファイル送信エラー 0%
→C社ファイル受信回答済み

閾値以上 × 販売可能
閾値以下 × 販売不可
ウ、エ、ア、イ
---

メモ

在庫の整合性が合わなくなる
いや、違うな。
処理中は販売停止にするって話だったから、ずっと販売停止になったままになっちゃうのでは。
D社のサイトが販売停止になったままになる

---

[1]
〔aについて〕
本文の〔ファイル形式の検討〕に登場します。在庫調整処理で使用するI/F（インタフェース）ファイルの形式としてCSV形式とXML形式を比べ、「[a]の追加によってデータ項目を追加できる」という特徴を備えたXML形式を採用しています。

→
タグってのはあくまで<>で定義している部分であって、要素ってのは<>と</>の間の事をいうらしい。
自信満々にタグって答えたけど、正確には違う見たいね。
職場だといっつもタグタグって言ってたからいつの間にか混同しちゃったみたいだ。


[2][1]
問題文には、"C社ファイル送信がエラーとなった場合にD社Webサイトで不具合が発生する"問題の解消のためにタイムアウト処理を追加したとあります。したがって、ここでは図1のタイムアウト処理がなかったときに発生する問題を考えることになります。

〔システム処理方式の検討〕では「通信の異常などで，C社からのI/Fファイル送信のエラーを検出した場合，又はD社側でI/Fファイル受信タイムアウトを検出した場合は，その時点でC社，D社とも在庫調整処理前のDBの状態で販売を再開する。」という記載がありますが、図1のシーケンス図でタイムアウト処理がない場合には、D社在庫調整処理オブジェクトがC社ファイルを受け取って正常応答しない限り、D社の販売は再開されないことがわかります。つまり、C社ファイル送信がエラーとなった場合、チケット移動対象となった公演がD社Webサイトで販売停止のままとなる問題が発生します。

∴対象公演が販売停止のままとなる

→
最初は販売停止って書いたけど、少しひねって回答してしまった。
いずれにしても、お客さんがチケットを入手できない状況であり続けるのに代わりはないから部分点はもらえるだろう。


[2][2]
〔b，cについて〕
シーケンス図における複合フラグメント「alt」はAlternativeの略で、複数の条件分岐を表します。altの中を点線で区切り、各区画に記入されたゲート条件が成立するとその区画内のシーケンスを実行します。

図1ではゲート条件[b]が成立したときにC社在庫調整処理オブジェクトに処理中止のメッセージ、D社販売処理オブジェクトに販売再開のメッセージを送っていることから、[b]は「通信がうまくいかなかった」ことを表す条件である必要があります。問題文に「図1中のメッセージ名称を用いた適切な字句を答えよ」という条件が付いていることに注意すると、[b]には「C社ファイル受信応答未実施」「C社ファイル受信応答未完了」といった字句が入ります。

ここで「C社ファイル送信の未受信」という旨の条件にしてしまうと、C社から受信したI/Fファイルにエラーがあり、C社ファイル受信応答を返さないケースで販売再開がされなくなってしまうので不適切です。問題文内で、受信タイムアウトだけでなく、I/Fファイルのエラー検出時も在庫調整処理前のDBの状態で再開すると記述されていることに注意しましょう。

一方、タイマイベント時点までに「通信がうまくいった」ときは特に何もする必要がありません。一般的なC言語などのプログラム言語では「else」を使って、先の条件式が成立しないときの処理を書くことができますが、やはり「図1中のメッセージ名称を用いた適切な字句を答えよ」という条件がついているため、ゲート条件[c]にうっかり「else」と書いてしまうと不正解になります（一般的にシーケンス図では「else」で済まさず、きちんとすべてのゲート条件を書きます）。したがって、[c]には[b]とは逆の記述、すなわち「C社ファイル受信回答済み」「C社ファイル受信回答完了」といった旨の字句が入ります。

∴b＝C社ファイル受信回答未実施
　c＝C社ファイル受信回答済み

→
タイムアウト処理は止めるわけではない。受信回答をした後にも動いている。
受信回答後は、適切な処理が実行された後にタイムアウトになるわけだ。
だから何もしなくていいのか。
わかってみればあっけないが、何か異常がないか探している状態では、そういった可能性に気が付く事が出来ない。

逆にC社からファイルが届かないって事は、ﾏｼﾞな障害なわけだから、そこは適切な回復処理を実行するってわけね。はいはい。


[3]
dについて〕
表2の項番3は、D社の未販売チケットをC社に移動させる処理です。これをC社ファイル送信がエラーになる状態で実行すると、次の流れになります。
1.C社側でD社のチケットをC社に移動する（C社増、D社減）
2.C社のDBに反映させ、販売再開する
3.C社ファイル送信エラー
4.タイムアウト処理によりD社販売再開
C社は在庫調整処理を実施してデータベース上の在庫を増やした後に販売を再開するのに対し、D社は更新情報を受け取ることができないため、在庫調整前のデータのまま販売を再開します。
その結果、D社からC社に移動したはずの在庫情報がD社のデータベースに反映されず、移動対象となった公演のチケットがC社・D社の両方で「販売可能」状態となります。

∴d＝販売可能

〔eについて〕
表2の項番4は、C社の未販売チケットをD社に移動させる処理です。これをC社ファイル送信がエラーになる状態で実行すると、次の流れになります。
1.C社側でC社のチケットをD社に移動する（C社減、D社増）
2.C社のDBに反映させ、販売再開する
3.C社ファイル送信エラー
4.タイムアウト処理によりD社販売再開
C社は在庫調整処理を実施してデータベース上の在庫を減らした後に販売を再開するのに対し、D社は更新情報を受け取ることができないため、在庫調整前のデータのまま販売を再開します。
その結果、C社からD社に移動したはずの在庫情報がD社のデータベースに反映されず、移動対象となった公演のチケットがC社・D社の両方で「販売不可」状態となります。

→
ロールバック処理が記述されていなかったので、在庫数がおかしくなることばかりに目が行ったが、当てはめる日本語がそれっぽくなかったので、うんうん悩んだのはここの部分。
答えを見てみれば、在庫は関係なくて、販売可能か不可という答えだった。
販売可否の視点は全く出てこなかったな。
あー、そういうことか。
数が合わなくなるのはそうだとしてその先か。
販売会社が被るチケットが出てくるので、そのチケットがどちらのサイトでも販売される事態になるってことを言ってるのか。
そりゃ気付かんわ。
てか、問題文をよく見ると、「一部チケット在庫が」って言ってるので、ちゃんとヒントは出してるっぽいですね。
これはやられましたわ。

```
