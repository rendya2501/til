# 平成27年秋期

---

## セキュリティ

---

## データベース 人事情報のデータ構造

いやー、久しぶりに敗北した。  
全体的に話は分かったけど、納得の行く答えに絞れなかった。  
再帰の問題は難しい。  
itecの問題にあったからやったけど、やっておいてよかった。  

### 第1正規形

各属性の繰り返し項目を排除し、単一値を属性とする複数の行に分解した状態。

### 第2正規形

第1正規形であり、かつ、主キーの一部だけで一意に決まる属性を別表に分離した状態（主キーに部分関数従属する属性がない状態）。

### 第3正規形

第2正規形であり、かつ、主キー以外の属性によって一意に決まる属性を別表に分離した状態（主キーからの推移的関数従属が存在しない状態）。

``` txt : 30分 3/9
→
部署ID
上位部署ID

第2正規形 × 第1正規形
年月日の情報は所属部署IDに紐づく情報で分離できるから ×
例)・主キーの一部に関数従属している属性があるから
   ・主キーに部分従属している属性があるから
   ・社員IDだけに従属している属性があるから
{社員ID}、{所属部署ID}、(適用開始年月日)、適用終了年月日
→{社員ID}、{適用開始年月日}、適用終了年月日、所属部署ID

= 部署.部署ID × IS NULL
2014-04-01 × 2012-10-01
9999-12-31 × 2014-03-31


[2][1]
まず、社員エンティティが第1正規形かどうかを検討します。明らかにレコード1行の中に複数の繰り返し項目を値とする属性はありません。
よって、少なくとも社員エンティティは第1正規形です。

次に社員エンティティが第2正規形かどうかを検討します。
〔新システムでの履歴管理〕の要件(4)には「所属情報以外の社員の情報は履歴管理する必要はなく，最新の情報だけを管理すればよい。」とあり、
複合主キーの一部である"社員ID"がわかれば、属性"氏名"・"性別"・"電話番号"・"自宅住所"・"自宅電話番号"は一意に特定できます。
複合主キーの一部に関数従属する属性がある（主キーに部分従属する属性がある）ことから、社員エンティティは第2正規形ではありません。

よって、社員エンティティは「第1正規形」、理由は「主キーの一部である関数従属する属性があるから」「主キーに部分従属している属性があるから」「社員IDだけに従属している属性があるから」などです。
厳密には、第1正規形を充足し第2正規形でないことを説明する必要があるので、「すべての属性が単一値であること」「主キーの一部である"社員ID"に関数従属する属性があること」の2つを含める必要があるのですが、文字数制限の関係もあり解答例では後者の理由のみに留めています。

∴主キーの一部に関数従属している属性があるから
　主キーに部分従属している属性があるから
　社員IDだけに従属している属性があるから


主キーが2つって事は
社員ID 時間
1      2012
1      2013
みたいな事ができる。
でも、住所とかってそこまで変わらないでしょ。
そういうのって別のテーブルにまとめればいいじゃんって話。
社員IDだけで決まる要素ってたくさんあるよね。それって複合キーの中で関数従属してる証拠だよね。って事だろ。
これこそ、主キーの一部だけで一意に決まる要素が分離されていない→第2正規形を満たしていないと言っていることか。


[2][2]
本文中に「エンティティ"所属"を新たに追加し，エンティティ"社員"を第3正規形とした。」とあるので、図3の社員エンティティを第3正規形にすることを考えます。

図3の社員エンティティは第1正規形ですので、第3正規形にするためには、まず第2正規形にする必要があります。そのために、複合主キーへの部分関数従属を排除します。
(1)より、属性"氏名"・"性別"・"電話番号"・"自宅住所"・"自宅電話番号"は複合主キーの一部である"社員ID"に関数従属しているため、
"社員ID"を主キーとする新たなエンティティを作り、"社員ID"に関数従属する属性を移動します。図4より、このエンティティを改めて社員エンティティ、元のエンティティを所属エンティティとしていることがわかります。
関係スキーマ：エンティティ名（属性名1，属性名2，...）を記述すると、
社員（社員ID，氏名、性別、電話番号、自宅住所、自宅電話番号）
所属（社員ID，適用開始年月日，適用終了年月日，所属部署ID）
となり、第2正規形です。次に所属エンティティが第3正規形かどうかを検討します。
第3正規形では主キーではない属性への関数従属を排除します。属性"適用終了年月日"と"所属部署ID"の間に関数従属性がないことは明らかですので、推移適関数従属はありません。
よって、第3正規形の条件を満たしています。

したがって、所属エンティティの属性は以下の4つです。

∴社員ID
　適用開始年月日
　適用終了年月日
　所属部署ID

※図4より、第2正規形の段階からエンティティの個数が増えていないので、同時に第3正規形であったことは（裏技的に）一応わかります。


あくまで、社員IDと適用開始年月日が主キーなので、これは別表として抜き出せる。
後は、適用終了年月日はマストとして部署がいつからいつまでって事を表したいので、所属部署IDも属性として抜き出せばおｋ。
そういうこと。



[3][1]
〔dについて〕
図5のSQL文は、図2で例示されているSQL文に日付指定の条件を追加した以外は基本的に違いはありません。ただし、UNION ALL句直前のWHERE句で指定している列が部署ID列から上位部署ID列に変わっています。UNION ALL句直後のSELECT文では、WITH RECURSIVE句で導出した関連部署表のレコードを順番に呼び出します。

図2のSQL文は、指定した部署とその配下の全ての部署を表示するものでしたから、会社全体の部署構造を表示するには木構造の最上位である"会社"を起点として指定することになります。本文中には「最上位である会社の上位部署IDにはNULLを設定する。」とあるので、最初の関連部署表となる1行としては上位部署IDがNULLのレコードが適切です。したがって、[d]には「IS NULL」が当てはまります。

```

---

## 組込みシステム
