# ネットワーク用語

---

## レイテンシ

latency : 潜伏、潜在  

潜伏時間、潜時、待ち時間、反応時間とは、デバイスに対してデータ転送などを要求してから、その結果が返送されるまでの不顕性の高い遅延時間のこと。  
データ転送における指標のひとつで、転送要求を出してから実際にデータが送られてくるまでに生じる、通信の遅延時間のことをいいます。  
この遅延時間が短いことをレイテンシが小さい（低い）、遅延時間が長いことをレイテンシが大きい（高い）と表現しています。  

パッと思いつく事として、伝送遅延があるけど、それだけがレイテンシではない模様。
あくまで、要求を出してから送られてくるまでの時間なので、複数の要因が存在する。

### ネットワークにおける遅延（レイテンシ）

[ネットワークにおける遅延（レイテンシ）](https://gist.github.com/hatappo/224c8160c72c1f7649f947caf7fe615a)  

#### 参考

- [ネットワークの世界における遅延とは](https://www.apposite-tech.com/blog/%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e3%81%ae%e4%b8%96%e7%95%8c%e3%81%ab%e3%81%8a%e3%81%91%e3%82%8b%e9%81%85%e5%bb%b6%e3%81%a8%e3%81%af/)
- [ネットワークでなぜ遅延が生じるのか](https://www.slideshare.net/junkato1272/ss-70431661)

#### ネットワークにおける遅延の種類

##### １．アプリケーション遅延 Processing Delay

通信機器の入力IFから出力IFのキューへ到達するまでにかかる時間。

``` txt
`（通信機器の）入力IF`
    から
`（通信機器の）出力IFキュー`
    に入るまでにかかる時間
```

比較的単純なPing/ICMPエコーリクエストなどのアプリケーションでは、このアプリケーションによる遅延は、マイクロ秒単位。 一秒間で数万件の株式の取引が行われる、コンピュータによる「高頻度取引(HFT)」の世界でも無い限り（ナノ秒単位の遅延が問題になるそうです）、アプリケーション遅延は無視されることが多い。

アプリケーションが複雑になってくれば、アプリケーション遅延も大きくなる。

##### ２．輻輳遅延 Queueing Delay

通信機器の出力IFキューに入ってから出力処理を行うまでにかかる時間。 通信機器がデータを転送するためにパケットをバッファに保持している時間。

``` txt
`（通信機器の）出力IFキュー`
    に入ってから
`（通信機器の）出力IFキュー`
    を出るまでにかかる時間
```

ある回線上に、その回線の帯域幅以上のパケットが到達してしまった場合、ネットワーク上のルータ(またはスイッチ)は、超過したパケットをバッファに溜め込みます。そのバッファを更に超過した場合、パケットは破棄されます。

広帯域回線から狭帯域回線への転送、一時的な輻輳などのためにこのバッファが存在する。

##### ３．伝送遅延 Serialization Delay

通信機器の出力IFからパケットを電気信号や光信号に変換して送信完了するまでにかかる時間。

``` txt
`（通信機器の）出力IFのデータ`
    を
`電気信号や光信号`
    に変換するのにかかる時間
```

・広帯域回線では短く、狭帯域回線では長い。 ・パケットのサイズが大きいと長く、サイズが小さいと短い。

1,500バイトのパケットの送出にかかる時間は ・10GE では 1.2 マイクロ秒 ・64Kbps(ISDN) では 187.5 ミリ秒（約１９万マイクロ秒）

##### ４．伝搬遅延 Propagation Delay

パケットが通信経路上を伝わるのにかかる時間。 （通信機器上で発生する遅延ではない）
光ファイバの伝搬速度は約２０万km/秒。（真空中だと光の速度は約３０万km/秒。）

- 東京〜⼤阪間 500km 往復 5ミリ秒
- ⽇本〜アメリカ⻄海岸 海底ケーブル 9,000km 往復 90ミリ秒
- ⼈⼯衛星 静⽌軌道 上空36,000km 2往復 500ミリ秒

---

## ルーティング

宛先までの経路において複数のルーターをまたぐ場合、それぞれの経路における送信元IPアドレスと宛先IPアドレスの状態はどのようになるのかわからなかった。  

[【CCNA講座】「ルーティング」これさえ見れば完全理解！【インフラエンジニア基礎入門 #9】](https://www.youtube.com/watch?v=_sWIKXnWNmU&t=1045s)  

動画を見た感じでは、送信元IPと宛先IPは変わらず、MACアドレスが変わる模様。  
IPはエンドツーエンドなので、始めと終わりは一貫している。  
ルーティング先の特定はMACアドレスで行い、IPアドレスは終始変えない模様。  

IPアドレスが変わるのはNAPTされた時の可能性。  
NAPTで変換テーブルがある場合に関しては、その区間の送信元、送信先が変わるのかもしれない。  
で、その通信が帰ってきたらNAPTの情報をもとに、アドレスの書き換えを行って、送信元に返す。  

ここの認識がごっちゃになっていたから、複数のルーターを跨いだ場合にIPアドレスが変わってしまうのでは？という疑問に至ったと思われる。  
そういうことかもしれない。  
少しすっきりした。  
応用情報の問題はよく考えられていますね。  

---

## プロキシサーバーへのアクセス

プロキシサーバーを介したアクセス場合のIPアドレスはどうなるのかわからなかったのでまとめ。  
直近の試験でいい感じの例題があったのでそのまま拝借。  

プロキシサーバーを介したアクセスの場合、宛先IPをプロキシにするのは分かったけど、そうした場合、プロキシは何を判断して宛先を特定するのだろうか。  
その依頼の中にさらに何か情報が渡されるのだろうか。  

### 応用情報技術者過去問題 令和3年春期 午後問5  

![a](https://www.ap-siken.com/kakomon/03_haru/img/pm05_1.gif)

問題  
販売代理会社の販売店のPCから旅行販売システムヘアクセスする場合，PCからFW#4に送信されるIPパケットの宛先IPアドレスは[b]となり，代理会社接続ルータからFW#1に送信されるIPパケットの送信元IPアドレスは[c]となる。  

解説  
[bについて]  
販売代理会社の販売店のPCから旅行販売システムへアクセスする場合、プロキシサーバを経由することになります。  
プロキシサーバを経由するWebアクセスでは、クライアントはプロキシサーバに対してHTTP(S)リクエストを送り、プロキシサーバはクライアントから受け取ったHTTP(S)リクエストの内容（GETメソッドのURL）を使って外部の宛先サーバに代理アクセスします。  

![a](https://www.ap-siken.com/kakomon/03_haru/img/pm05_3.gif)  

**IPはエンドツーエンドの通信を実現するプロトコルなので、宛先IPアドレスには最終的にパケットを届けたい相手を指定します。**  
最終的な宛先というと"旅行販売システム"や"負荷分散装置"のIPアドレスを考えてしまいますが、プロキシサーバを経由する場合は、パケットを届けたい相手がプロキシサーバになるので、宛先IPアドレスにはプロキシサーバのIPアドレスを指定します。  
経路途中の"FW#4"や"店舗接続ルータ"は最終的な宛先ではないので、宛先IPアドレスとするのは不適切です。  

したがって、販売代理会社の販売店のPCがWebアクセスする際の宛先IPアドレスは、プロキシサーバの販売店側のIPアドレスである「192.168.0.3」になります。  

[cについて]  
前述のとおり、販売代理会社の販売店のPCからHTTP(S)リクエストを受け取ったプロキシサーバは、旅行販売システムに代理アクセスをします。  
このときプロキシサーバから送出されるIPパケットは、宛先IPアドレスが 10.10.0.10、送信元IPアドレスが 192.168.0.2 になっています。  

プロキシサーバが旅行販売システムにアクセスする際には"FW#3"を経由しますが、"FW#3"ではNAPTが動作しています。  
NAPTでは、送信元IPアドレスについてプライベートIPアドレスとグローバルIPアドレスの変換を行うので、"FW#3"を経由する際に、送信元IPアドレスが"FW#3"の外部側のIPアドレスである「10.1.1.2」に書き換えられます。  
"代理会社接続ルータ"に届くのはこの書き換えられたIPパケットなので、"代理会社接続ルータ"から"FW#1"に送信されるIPパケットの送信元IPアドレスは「10.1.1.2」になっています。  

---

## 輻輳(ふくそう)

>輻輳とは、さまざまな物が1箇所に集中する状態を指します。  
通信分野では、インターネット回線や電話回線にアクセスが集中することを輻輳と呼びます。  
>
>インターネット回線や電話回線で輻輳が発生すると、通信速度が低下する、あるいは通信システムそのものがダウンするといった弊害が生じます。  
>
>たとえば電話回線の場合、コンサートチケットの予約開始などで特定の電話番号にアクセスが集中することで輻輳が発生し、つながりにくい状態になることがあります。  
また特定の電話番号宛でなくても、たとえば災害発生時の安否確認などによって電話回線が混雑し、輻輳が発生することがあります。  
>
>インターネット回線においても、一時的に大量のトラフィック（一定時間内に転送されるデータ量）が発生すると輻輳が発生し、通信速度の低下や、サービスへの接続が不可能になるといった事態が発生します。  
動画配信サービスや動画共有サービスの普及、クラウドサービスの浸透などがインターネット回線における輻輳の原因として挙げられています。  
>
>[意外と知らない？ITトレンド用語](https://www.ntt.com/bizon/glossary/j-h/fukuso.html)  

---

## ペイロード(Payload)

レスポンスのデータ部分をペイロードとはよく言うが、つまり何？という事を知らなかったのでまとめ。  
簡単に言えば、データ本体そのものを指す言葉だった。  

>有料荷重、有効搭載量、積載物等の意味を持つ英単語。  
通信・ネットワークの分野に置いては、送受信されるデータに伝送単位(パケットやデータグラムなど)のうち、宛先などの制御情報を除いた、相手に送り届けようとしている正味のデータ本体のことをペイロードという。  
>
>パケットやデータグラムの多くは、先頭部分に制御情報を記したヘッダ部。
続けてペイロード(ボディ)。  
必要に応じて末尾にパディング(特定の長さに合わせるための「詰め物」となる無意味なデータ)という構成になっている。  
[ペイロード 【payload】](https://e-words.jp/w/%E3%83%9A%E3%82%A4%E3%83%AD%E3%83%BC%E3%83%89.html)  

---

## C10K問題(クライアント1万台問題)

>C10K問題（英語: C10K problem）とは、Apache HTTP ServerなどのWebサーバソフトウェアとクライアントの通信において、クライアントが約1万台に達すると、Webサーバーのハードウェア性能に余裕があるにも関わらず、レスポンス性能が大きく下がる問題である。  
>[Wiki]  

>この考え方は、スターバックスの接客方式をイメージすると分かりやすい。  
>客はレジで注文と支払いを済ませると、配膳口近くで注文した飲み物ができるのを待つ。  
>飲み物ができたかどうかに関係なく、レジでは次々と注文を受け付ける。配膳口では、できた順に商品を客に渡す。  
>このため昼時に多数の来客があっても、レジ前の行列はできにくい。  
>Node.jsのメカニズムもこれに近い。時間がかかっている処理の完了を待つことなく、次の処理を実行する。  
通信相手との同期をとらず、処理完了も待たず、一つのプロセスで次々と処理をこなす。  
>そのため「非同期処理」とも呼ばれる。  
[スタバ方式で「C10K問題」を解消](https://xtech.nikkei.com/it/article/COLUMN/20120725/411441/)  

いや微妙に違うな。
確かアパッチは店員が1人1人に対して出てくるって話だった気がする。  
でも、エンジンエックスはスタバ方式でって話だよな。  

[NginxがどのようにしてC10K問題に対応しているのか？](https://qiita.com/uma002/items/9a365a46b8e6d1d18271)  

C(クライアント)10K(1万)問題  
読み方 「シーテンケー・モンダイ」  

---

## NginxとApatchの違い

[](https://openstandia.jp/pdf/140228_osc_seminar_ssof8.pdf)  
