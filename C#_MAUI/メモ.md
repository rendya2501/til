# MAUIメモ

## System.ArgumentException: 'Ambiguous routes matched for...'

3階層あるようなページ構成において、3ページ目で`Shell.Current.GoToAsync('..')`したら発生した。  

AppShell.xamlでxaml上とコードビハインドでそれぞれRoutingを定義していると発生する模様。  
XAML側の定義を削除したら解決した。  

>これは、XAML（appshellファイル）でルートを登録し、C#のコードビハインドでルートを登録しようとしたときに発生します。  
>XAMLまたはC#のどちらかを使用して、一度だけルートを登録するようにしてください（両方は使用しないでください）。  
>[forms - Xamarin Shell Raise Ambiguous Routes matched Exception - Stack Overflow](https://stackoverflow.com/questions/58352925/xamarin-shell-raise-ambiguous-routes-matched-exception)  

---

## Page

親ページを作って使いまわす時に参考になりそうな動画。  
[Master Content Page ( Master Page, Partial View ) In .NET MAUI / Xamarin - YouTube](https://www.youtube.com/watch?v=ufMlk8k4Wq4)  

---

## Publisher/Subscriber Pattern ・ Prism EventAggregator

``` cs
protected override void OnNavigating(ShellNavigatingEventArgs args)
{
    base.OnNavigating(args);

    if (args.Target.Location.OriginalString.Contains("VariantPage1"))
    {

        MessagingCenter.Send<AppShell, string>(this, "Hi", "Test1");
    }

    if (args.Target.Location.OriginalString.Contains("VariantPage2"))
    {
        MessagingCenter.Send<AppShell, string>(this, "Hi", "Test2");
    }
}
```

``` cs
[ObservableProperty]
private string side = "Left";

public VariantViewModel(ConfigurationService service)
{
    this.configService = service;
    LoadWidgets();
    MessagingCenter.Subscribe<AppShell, string>(this, "Hi", (sender, arg) =>
    {
        Side = arg;
    });
}
```

[c# - C# - クエリプロパティを使用した.NET MAUIシェルナビゲーションが常にページをロードするとは限りません](https://stackoverflow-com.translate.goog/questions/76095594/net-maui-shell-navigation-with-query-property-not-always-loading-pages?_x_tr_sl=en&_x_tr_tl=ja&_x_tr_hl=ja&_x_tr_pto=sc)  

---

## Preferrence

[.NET MAUI で設定を保存する(Preferences) | 開発者のごみ箱](https://developers-trash.com/archives/1249)  

---

## MAUIでappsettings.jsonを使う

``` cs : MauiProgram.cs
public static class MauiProgram
{
    public static MauiApp CreateMauiApp()
    {
        var builder = MauiApp.CreateBuilder();
        builder
            .UseMauiApp<App>()
            .ConfigureFonts(fonts =>
            {
                fonts.AddFont("OpenSans-Regular.ttf", "OpenSansRegular");
            });

        builder.Services.AddTransient<MainPage>();

        using var stream = Assembly.GetExecutingAssembly().GetManifestResourceStream("projectname.appsettings.json");
        var config = new ConfigurationBuilder()
            .AddJsonStream(stream)
            .Build();
        builder.Configuration.AddConfiguration(config);
        return builder.Build();
    }
}

public class Settings
{
    public int KeyOne { get; set; }
    public bool KeyTwo { get; set; }
    public NestedSettings KeyThree { get; set; } = null!;
}

public class NestedSettings
{
    public string Message { get; set; } = null!;
}
```

``` cs
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;

public partial class MainPage : ContentPage
{
    int count = 0;
    IConfiguration configuration;
    public MainPage(IConfiguration config, ILogger<MainPage> logger)
    {
        InitializeComponent();

        configuration = config;
        logger.LogInformation("Test");
        //configuration = MauiProgram.Services.GetService<IConfiguration>();
    }

    private async void OnCounterClicked(object sender, EventArgs e)
    {
        count++;
        CounterLabel.Text = $"Current count: {count}";

        SemanticScreenReader.Announce(CounterLabel.Text);

        var settings = configuration.GetRequiredSection("Settings").Get<Settings>();
        await DisplayAlert("Config", $"{nameof(settings.KeyOne)}: {settings.KeyOne}" +
            $"{nameof(settings.KeyTwo)}: {settings.KeyTwo}" +
            $"{nameof(settings.KeyThree.Message)}: {settings.KeyThree.Message}", "OK");
    }
}
```

[App Configuration Settings in .NET MAUI (appsettings.json) - James Montemagno](https://montemagno.com/dotnet-maui-appsettings-json-configuration/)  
[GitHub - jamesmontemagno/dotnet-maui-configuration: How to use appsettings.json in .NET MAUI](https://github.com/jamesmontemagno/dotnet-maui-configuration)  
