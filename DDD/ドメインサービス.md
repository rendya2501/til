# ドメインサービス

>エンティティが負うべきでないドメインにおけるプロセスを記述したもの。  
>[ドメイン駆動設計(DDD) 初心者がドメインサービスについて分かった気になるまでの道のり - RAKUS Developers Blog | ラクス エンジニアブログ](https://tech-blog.rakus.co.jp/entry/20200511/ddd)  

---

## サンプル1

AよりはBがいいよねというサンプル。

■ **A**  

``` cs : A
public interface ICalculateTaxPolicy {
    decimal PriceIncludingTax(decimal priceExcludingTax);
}

// 標準税率（10%）で計算する CalculateTaxPolicy の実装クラス.
public class CalculateStandardTaxPolicy : ICalculateTaxPolicy {
    public BigDecimal priceIncludingTax(BigDecimal priceExcludingTax) {
        BigDecimal taxRate = BigDecimal.valueOf(10); // 標準税率（10%）

        BigDecimal coefficient = BigDecimal.valueOf(100).add(taxRate)
                .scaleByPowerOfTen(-2);
        BigDecimal priceIncludingTax = priceExcludingTax.multiply(coefficient);
        priceIncludingTax = priceIncludingTax.setScale(0, RoundingMode.HALF_UP); // 四捨五入する
        return priceIncludingTax;
    }
}

// 軽減税率（8%）で計算する CalculateTaxPolicy の実装クラス.
public class CalculateReducedTaxPolicy : ICalculateTaxPolicy {
    public BigDecimal priceIncludingTax(BigDecimal priceExcludingTax) {
        BigDecimal taxRate = BigDecimal.valueOf(8); // 軽減税率（8%）
        
        // 以降は標準税率の場合と同じなので省略
    }
}
```

■ **B**

``` cs
public interface ITaxPolicy {
    // 税率を返す.
    int rate();
}

// 標準税率（10%）を返す TaxPolicy の実装クラス.
public class StandardTaxPolicy : ITaxPolicy {
    public int rate() {
        return 10;
    }
}

// 軽減税率（8%）を返す TaxPolicy の実装クラス.
public class ReducedTaxPolicy : ITaxPolicy {
    public int rate() {
        return 8;
    }
}

public class CalculateTaxService {
    // 税込価格を計算する
    public BigDecimal priceIncludingTax(BigDecimal priceExcludingTax, TaxPolicy policy) {
        BigDecimal taxRate = BigDecimal.valueOf(policy.rate());
        BigDecimal coefficient = BigDecimal.valueOf(100).add(taxRate)
                .scaleByPowerOfTen(-2);
        BigDecimal priceIncludingTax = priceExcludingTax.multiply(coefficient);
        priceIncludingTax = priceIncludingTax.setScale(0, RoundingMode.HALF_UP); // 四捨五入する
        return priceIncludingTax;
    }
}
```

[ドメイン駆動設計(DDD) 初心者がドメインサービスについて分かった気になるまでの道のり - RAKUS Developers Blog | ラクス エンジニアブログ](https://tech-blog.rakus.co.jp/entry/20200511/ddd)  

---
