# 一時テーブル

## 概要

ユーザーが接続している間だけ有効な(一時的な)テーブル。  
テーブル名の先頭に`#`を付けるだけで作成することができる。  
DROP TABLEステートメントによる明示的な削除も可能。  
インデックスを作成することも可能。  

``` sql
CREATE TABLE #一時テーブル名
(
    列名1 データ型,
    列名2 データ型,
    …
)
```

SELECT INTO ステートメントを利用して、SELECTステートメントの検索結果をもとに作成することもできる。  

``` sql
SELECT * INTO #一時テーブル名 FROM テーブル名 …
```

---

## インラインビューとCTE、一時テーブルの使い分け

単純なクエリの場合は、インラインビュー/CTEのほうがパフォーマンスがよい場合が多いが、複雑なクエリ(サブクエリが5,6階層以上の何段階も入れ子になって利用されるようなケース)の場合には、一時テーブルを利用したほうがパフォーマンスが良い場合が多くなる。  

インラインビュー/CTEは、内部的には一時的な作業テーブルを作成しているので、一時テーブルと同じような内部処理になるが、サブクエリが何段階もの入れ子になっているような場合は、「クエリオプティマイザー」が最適ではない遅い実行プランを選択してしまうことがある。  
これはSQLServerに限った話ではなく、OracleやDB2でも同様。  
複雑なクエリになった場合には、クエリオプティマイザーの動作に限界があるため。  
