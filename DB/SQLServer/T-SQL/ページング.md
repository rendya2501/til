# ページング

## ページングとは？

「n件目からm件目を取得する」といった機能。  
インターネットの検索エンジンサイトの検索結果等でおなじみの10件ずつデータを表示する機能。  

---

## OFFSET ~ FETCH

SQLServer 2012から `OFFSET ~ FETCH` によるページング機能がサポートされるようになった。  
ROW_NUMBERやサブクエリを利用しなくても、n件目 ~ m件目のデータを取得できるようになった。  

``` sql
SELECT * FROM Table
OFFSET n ROWS
FETCH NEXT m ROWS ONLY
```

- OFFSET : スキップしたい件数を指定する。  
- FETCH NEXT : 取得したい件数を指定する。  

以下、4~6件目のデータを取得する例  

``` sql
SELECT * FROM 社員 ORDER BY 入社日 DESC
OFFSET 3 ROWS
FETCH NEXT 3 ROWS ONLY
```

[SQL Server - OFFSET 句と FETCH 句 - いちろぐ](https://ichiroku11.hatenablog.jp/entry/2014/03/03/003411)  

---

## ROW_NUMBERによるページング

サブクエリでROW_NUMBER関数を利用して入社日の新しい順に行番号を取得し、その結果に対してBETWEEN演算子を利用することでn件目からm件目を取得する事ができる。  
下記例では`1 AND 3`で1件目から3件目を意味するので、n件目からm件目を取得した場合はそのまま`n AND m`と記述すれば良い。  

``` sql
SELECT *
FROM 
(
    SELECT
        ROW_NUMBER() OVER (ORDER BY 入社日 DESC) AS rownum,
        *
    FROM 社員
) t
WHERE rownum BETWEEN 1 AND 3
```
