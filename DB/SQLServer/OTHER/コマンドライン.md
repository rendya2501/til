# SQLServer_コマンドラインまとめ

## SQLServerのコマンドラインツール

sqlcmd : 従来のツール。古い。使い勝手が悪い。  
mssql-cli : 新しいツール。python製。cliで使うならこれ一択。  

---

## コマンドラインからSqlServerを使う

MySQLのようなグリッド表示の結果が欲しくて色々探した。  
とりあえずcliから実行する方法を探したら色々あったので、備忘録として残す。  

pythonをインストールしてpipからmssql-cliをインストールする。  
最新版をインストールするとバグるのでpyhonのバージョンは3.9のを使うこと。  

で、結局grid表示はできなかったので、使えなかった。  

[新しいコマンドラインツールの mssql-cli のクエリ実行方法のメモ](https://blog.engineer-memo.com/2017/12/24/%E6%96%B0%E3%81%97%E3%81%84%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE-mssql-cli-%E3%81%AE%E3%82%AF%E3%82%A8%E3%83%AA%E5%AE%9F%E8%A1%8C%E6%96%B9/)  
[コマンドラインでSQL Serverを使う最低限のメモ](https://qiita.com/zaburo/items/6edf7c05c5d4f5e039eb)  

インストールはここを参考にする。  
[MSSQL-CLI: An Interactive Command Line SQL Server Query Tool](https://www.mytecbits.com/microsoft/sql-server/mssql-cli)  

`ImportError: cannot import name 'Iterable' from 'collections' in Python`というエラーが発生した。  
pythonのバージョンを3.9にしろという記事。  
[ImportError: cannot import name 'Iterable' from 'collections' in Python](https://stackoverflow.com/questions/72032032/importerror-cannot-import-name-iterable-from-collections-in-python)  

---

## 外部ファイルをコマンドラインで実行する

``` txt
sqlcmd -S <server_name> -U <user_id> -P <passwd> -d <dbname> -i <input_path> -u -o <output_path>
```

仮に`PRINT 'aaa'`だけを実行するsqlファイルをinputとして、結果をresult.txtで受け取るようにすると、メモ帳に`aaa`って出力されるので、実行されることを確認できるはず。  

[SQL Serverで外部ファイルをコマンドライン実行する - ハロの外部記憶インターフェイス](https://haronoid.hatenablog.com/entry/2018/02/09/141843)  
