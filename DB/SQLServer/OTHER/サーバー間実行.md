# サーバー間実行

GPT4の出力内容をまとめ

## ssmsでサーバーを跨いでsqlを実行することはできるか？

できる。  

SQL Server Management Studio（SSMS）を使用して、リンクされたサーバーを通じて別のSQL Serverインスタンス上でSQLクエリを実行することができます。  
リンクされたサーバーは、異なるSQL Serverインスタンスやその他のデータベースシステムとの接続を作成する機能です。  
これにより、クエリを実行する際に、複数のサーバー間でデータを取得できます。  

リンクされたサーバーを使用してクエリを実行するには、次の手順に従ってください。  

1. SQL Server Management Studioを開き、接続したいサーバーに接続します。  
2. リンクされたサーバーを作成する必要があります。Object Explorerで、サーバー名を右クリックし、「新しいクエリ」を選択します。  
3. 新しいクエリウィンドウで、次のようなステートメントを実行してリンクされたサーバーを作成します。  

    ``` sql
    EXEC sp_addlinkedserver
        @server = 'リンクサーバー名',
        @srvproduct = '',
        @provider = 'SQLNCLI', -- SQL Server Native Client
        @datasrc = '実際のサーバー名';
    ```

4. リンクされたサーバーへのログイン資格情報を設定します。  

    ``` sql
    EXEC sp_addlinkedsrvlogin
        @rmtsrvname = 'リンクサーバー名',
        @useself = 'FALSE',
        @locallogin = NULL,
        @rmtuser = 'リモートサーバーユーザー名',
        @rmtpassword = 'リモートサーバーパスワード';
    ```

5. リンクされたサーバー上でクエリを実行するには、次のような形式でクエリを記述します。  

    ``` sql
    SELECT *
    FROM [リンクサーバー名].[データベース名].[スキーマ名].[テーブル名];
    ```

---

## SQL Server Native Client

SQL Server Native Client（SQLNCLI）は、Microsoft SQL Serverと通信するために使用されるプロバイダです。  
これは、SQL Serverのデータベース接続およびデータ操作機能をクライアントアプリケーションに提供するためのライブラリで、OLE DBとODBCの両方のAPIをサポートしています。  
SQLNCLIは、パフォーマンスの向上や新機能へのアクセスを提供するために、SQL Serverのバージョンとともに進化してきました。  

SQL Server Native Clientは、クライアントアプリケーションやデータベースツールが、SQL Serverとの通信やデータ操作を行う際に使用します。  
リンクされたサーバーを設定する際に、SQLNCLIプロバイダを指定することで、SQL Serverインスタンス間でクエリを実行する能力が提供されます。  

ただし、SQL Server 2012以降では、MicrosoftはSQL Server Native Clientの代わりにOLE DB Driver for SQL ServerやODBC Driver for SQL Serverを推奨しています。  
これらのドライバは、最新の機能とセキュリティ更新を提供するため、新しい開発プロジェクトではこれらのドライバの使用が推奨されます。  

---

## OLE DB Driver for SQL Server での設定方法

``` sql
EXEC sp_addlinkedserver
    @server = 'リンクサーバー名',
    @srvproduct = '',
    @provider = 'MSOLEDBSQL', -- OLE DB Driver for SQL Server
    @datasrc = '実際のサーバー名';
```

---

## ODBC Driver for SQL Server での設定方法

ODBC Driver for SQL Serverを使用して接続するには、まずODBCデータソース（DSN）を設定する必要があります。  
以下の手順に従って設定します。  

1. Windowsの「コントロールパネル」を開き、「システムとセキュリティ」>「管理ツール」の順に選択し、「ODBCデータソース（64ビット）」または「ODBCデータソース（32ビット）」をクリックします。
2. 「ODBCデータソース管理者」ダイアログボックスが表示されます。「システムDSN」タブをクリックし、「追加」ボタンをクリックします。
3. 「新しいデータソースの作成」ダイアログボックスが表示されます。「ODBC Driver for SQL Server」を選択し、「完了」をクリックします。
4. 「ODBCデータソースの作成」ダイアログボックスが表示されます。各フィールドに必要な情報を入力し、「完了」をクリックしてDSNを作成します。

DSNが設定されたら、リンクサーバーを作成する際にsp_addlinkedserverとsp_addlinkedsrvloginを次のように変更します。

``` sql
EXEC sp_addlinkedserver
    @server = 'リンクサーバー名',
    @srvproduct = '',
    @provider = 'MSDASQL', -- ODBC Provider
    @datasrc = 'DSN名';
```
