# SQLServerの概要

---

## インスタンス

SQL Serverは1台のコンピューターに複数インストールすることができる。  
これらは「インスタンス」と呼ばれ、インスタンス名で識別している。  
1台のコンピューターには、最大で50台のインスタンスをインストールすることができる。  

インスタンスの設定はSQLServerのインストール時に行う。  
[インスタンスの構成]画面において、SQLServerのインスタンス名(SQLServerの名前)を設定する。  

[既定のインスタンス]をチェックしている場合は、Windowsの「コンピューター名」がSQLServerの名前となる。  
[名前付きインスタンス]をチェックして、インスタンス名を入力した場合は、「コンピューター名\インスタンス名」がSQLServerの名前になる。  

---

## SQLServerの名前はアプリからの接続時に利用される

SQLServerの名前は、アプリケーションからSQLServerへ接続するときに指定する名前となるので、確実に覚えておく必要がある。  
特に名前付きインスタンスの場合は、コンピューター名とインスタンス名の間に[￥]マークを追加したものになることに注意する。  

---

## サービスアカウントの設定

インストール時における[サーバーの構成]画面において行う。  

[サービスアカウント]タブでは、SQLServerのサービスアカウント(内部的な実行アカウント)を指定するが、ActiveDirectoryドメイン環境ではドメインユーザーを、ワークグループ環境ではWindowsのローカルユーザーを指定する事を勧める。  

---

## サービスアカウントとは？

[サービス]はWindowsのバックグラウンドで動作するプログラムの事で、SQLServerはサービスとしてインストールされる。  
サービスの(内部的な)実行ユーザーは「サービスアカウント」と呼ばれているので、サービスアカウントの設定において指定したアカウントは、SQLServerを内部的に実行するユーザーになる。  

---

## セキュリティモードと管理者の設定

[データベースエンジンの構成]画面の[サーバーの構成]タブではSQLServerのセキュリティモードや管理者を設定する。  

デフォルトの[Windows認証モード]がチェックされている事を確認して、[SQLServerの管理者の指定]で[現在のユーザーの追加]ボタンをクリックする。  
これにより、インストール作業を行っているアカウントをSQLServerの管理者として追加することができる。  

Windows認証モードはWindowsにログオンしたユーザーでSQLServerに接続するモード。  

---

## システム データベース

Manegement Studioのオブジェクトエクスプローラーから[データベース]フォルダの[システムデータベース]フォルダーを展開すると、[master] [model] [msdb] [tempdb]という4つのデータベースを確認できる。  
これらのシステム データベースには、SQLServerの内部的な情報が格納され、インストール時に自動的に作成される。  
それぞれの主な役割は以下の通り。  

### master データベース

masterはSQLServerが動作するために必要な情報が格納されている重要なデータベース。  
SQLServerの環境設定や、ログインアカウント、ユーザー定義のエラーメッセージ等が格納される。  

### model データベース

modelは作成する全てのデータベースのテンプレートとして利用される。  

### msdb データベース

msdbはSQLServerのエージェントサービスによって利用されるデータベース。  
定期バックアップのスケジューリング情報(ジョブ)などが格納される。  

### tempdb データベース

tempdbは一時的な作業領域として利用される。  
[一時テーブル]や[READ_COMMITTED_SNAPSHOT],[スナップショット分離レベル]において必要なテーブルはここに作成される。  

---

## Resourceデータベース

ResourceデータベースはManagementStudioには表示されないが、これもシステムのデータベースの1つ。  
Resourceデータべースはmasterデータベースと似ていて、SQLServerが動作するために必要なシステム情報が格納されている。  
SQLServer2000の時は、Resourceデータベースの情報はmasterデータベース内に格納されていたが、2005以降からはResourceとmasterの2つに分かれるようになった。  

Resourceデータベースは、読み取り専用のデータ(ユーザーが書き込みできないデータ)が格納され、masterデータベースにはユーザーが書き込んだり、変更したりできる情報が格納される。  
例えば、SQLServer2016のエラーメッセージのうち、"組み込みのシステムエラーメッセージ"はResourceデータベースへ格納され、ユーザーが作成するエラーの"ユーザー定義エラーメッセージ"はmasterデータベースに格納される。  

なお、ServicePack等の修正プログラムをインストールすると、Resourceデータベースのシステム情報も更新される。  

---

## SQLServerの古いバージョンとの共存

それぞれのインスタンス名を分ければ共存可能。  
しかし、最新版をインストールした後に、古いバージョンのSQLServerをインストールする場合には、いくつかのファイルが古いバージョンによって置換されてしまうため、最新版の修正セットアップを行うか、最新版をインストールする前に古いバージョンのSQLServerをインストールしておくようにする。  
色々なバージョンを共存させたい場合には、製品の登場順にインストールするのが基本となる。  

---

## SQLServerとOracleデータベースの違い

SQLServerとOracleでは、データベースの概念が異なる。  
SQLServerでは、複数のデータベースを作成することができるが、Oracleでは、1つのデータベースしか作成することができない。  

``` mermaid
stateDiagram-v2
    direction LR

    SQLServer --> Database1
    SQLServer --> Database2

    state SQLServer {
        [*]
    }

    state Database1 {
        state Table1{
            [*]
        }
    }
    state Database2 {
        state Table2{
            [*]
        }
    }
```

``` mermaid
stateDiagram-v2
    direction LR

    Oracle --> Database

    state Oracle {
        [*]
    }

    state Database{
        direction LR

        state 表領域1 {
            state Table1{
                [*]
            }
        }
        state 表領域2 {
            state Table2{
                [*]
            }
        }
    }
```

強いて言うと、Oracleでの「表領域」が、SQLServerでのデータベースに近い概念となる。  

---

## SQLの方言(ダイアレクト)

標準化されたSQLはデータベースサーバーを操作する上では足りない部分がある。  
例えば、変数宣言や流れ制御といった"プログラミング言語的な要素"や、バックアップや定期メンテナンス等の"運用管理系の操作"等。  
従って、各データベース製品は、それらを補うために独自の拡張を行っている。  
そういうわけで、拡張部分については互換性がない。  
こうした製品によるSQLの違いは、「方言」(Dialect : ダイアレクト)と呼ばれている。  

SQLServerでは、SQL標準と拡張部分を含めて「Transact-SQL」(T-SQL)、Oracleでは拡張部分のみを「PL/SQL」(Procedural Language Extensions to SQL)、PostgreSQLでは拡張部分のみを「PL/pgSQL」(PL/SQLのPostgreSQL版)と呼んでいる。  

---

## USE

データベースへ接続するためのステートメント。  
USEの跡に半角スペースを入れて、"データベース名"を記述することで、そのデータベースへ接続できるようになる。  
ステートメントの大文字と小文字は区別しないため、「use」や「Use」、「uSe」、「sampledb」、「Sampledb」のように記述しても問題ない。  
ただし、スペースも含めて**全て半角**で記述することに注意する。  

``` sql
USE SampleDB
```

---

## SQLの実行

キーボードの「F5」または「Ctrl + E」。  
