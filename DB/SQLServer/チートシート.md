# チートシート

良く調べるものだけをまとめる

---

## 列のリネーム

``` sql
-- 列のリネーム
EXEC sp_rename 'スキーマ名.テーブル名.現在のカラム名', '新しいカラム名', 'COLUMN';

-- 例:テーブル dbo.ErrorLog の ErrorTime 列名を AdventureWorksLT データベースの ErrorDateTime に変更する
EXEC sp_rename 'dbo.ErrorLog.ErrorTime', 'ErrorDateTime', 'COLUMN';
```

---

## テーブルのリネーム

``` sql
-- テーブルのリネーム
EXEC sp_rename 'スキーマ名.テーブル名', '新しいテーブル名';

-- 例:Sales スキーマの SalesTerritory テーブルの名前を SalesTerr に変更
EXEC sp_rename 'Sales.SalesTerritory', 'SalesTerr';
```

---

## 主キー名のリネーム

``` sql
-- 主キー名のリネーム
EXEC sp_rename '現在の主キー名', '新しい主キー名', 'OBJECT';

-- 例:Sales スキーマの Tamp_Table_PKC 主キー名の名前を Table_PKC に変更
EXEC sp_rename 'Sales.Tamp_Table_PKC', 'Table_PKC', 'OBJECT';
```

---

## お手軽テーブルコピー

``` sql
SELECT * INTO <コピー先テーブル名> FROM <コピー元テーブル名>
```

---

## トランザクション処理

``` sql
SET XACT_ABORT ON
BEGIN TRY
    BEGIN TRANSACTION

    -- ===========================
    -- 処理をここに記述
    -- ===========================

    COMMIT TRANSACTION
END TRY

BEGIN CATCH
    ROLLBACK TRANSACTION
    THROW
END CATCH
SET XACT_ABORT OFF
```
