# データベース

---

## レプリケーション

レプリケーション : 複製

[わかりそうレプリケーション (replication)](https://wa3.i-3-i.info/word12869.html)  

平成30年春午後のネットワークでレプリケーションサーバーってのが出てきて、単語だけ調べるつもりだったけど、DBにまで範囲が及んだのでまとめることにした。  
レプリケーションは複製という意味になる。  
オリジナルDBに書き込みつつ、同じ内容をレプリカDBにも書き込む事をレプリケーションというらしい。  
つまり、リアルタイムに複製を生成する技術ということになるか。  

話だけ聞くとバックアップと同じように感じるが、バックアップはある時点のデータをメディアに記録して別の場所に保管することを指すので、全然違う。  
後、障害が発生した場合、環境から用意しないといけないが、レプリケーションは同じ環境で動作しているものを切り替えるだけで済むので対応力も違う。  
一応その記事も置いておきますね。  
[レプリケーションとは？バックアップと何が違う？](https://bcblog.sios.jp/what-is-replication/)  

---

## サロゲートキー

それ単体では意味を持たないが、一意であるキーのこと。  
自動発番のid列みたいなやつ。  

surrogate : 代理  

<https://amg-solution.jp/blog/8980>  

---

## PRIMARY KEY (主キー) と UNIQUE の違い

[PostgreSQL - PRIMARY KEY (主キー) と UNIQUE の違い](https://esthersoftware.hatenablog.com/entry/deference-between-primarykey-and-unique-postgresql)  

### PRIMARY KEY と UNIQUE の違いとは？

Primary Key（主キー）とUniqueはどちらも「データが一意である」制約を設定するものです。それならこの2つに違いはあるの？と気になったので調べてみました。

### PRYMARY KEY(主キー)

・「テーブル内の行データを識別するために設定でき、重複した値を許さないカラム」のこと
・複数のカラムに対して設定可能
・NULLは許可されない
・UNIQUE制約と非NULL制約を組み合わせたもの
・この制約は一つのテーブルに対して一つしか設定できない

[主キー（primary key）を複数のカラムに、その名は複合主キー（composite primary key ）](https://ts0818.hatenablog.com/entry/2017/02/04/162513)  

主キーが1つだけしか許可されないなら、複数のカラムに主キーを設定してるあれはなんなの？  
→  
複数のカラムをまとめて複合キーとして、その複合キーに対して主キーを設定している。  
なので主キーを実質1つしか設定していないことになるので、問題がないということ。  

### UNIQUE制約

・「カラムまたはカラムのグループに含まれるデータが、テーブル内の全ての行で一意であることを確実にする」ということ  
・つまり行データを識別する必要は無いけれど、あるカラムに対して重複した値が入るのを禁止したいときに使う  

・重複した値の入力が不可能になる。  
・NULLは許可されている。  
・この制約は一つのテーブルに対して複数設定することができる。  

### まとめ

・PRIMARY KEYもUNIQUEもデータに一意性を持たせる点は同じ  
・目的によって使い分けができる  

PRIMARY KEY : テーブル内の行データを特定するために一意性を持たせる。  
UNIQUE制約 :  重複した値を格納したくないカラム（またはカラムのグループ）に一意性を持たせる。  

というわけなので、このカラムとこのカラムを主キーにするってことは出来なくて、  
このカラムとこのカラムを合わせて複合キーとして、その複合キーに対して主キーを設定するのはOK。  
UNIQUEキーなら、このカラムとこのカラムにユニーク制約を課すってのはOK。  
この違いが主キーとユニークキーの違いってところじゃないですかね。  

---

## CASCADE

削除するテーブルに依存しているオブジェクト（ビューなど）を自動的に削除します。  

DROP TABLEは、削除対象のテーブル内に存在するインデックス、ルール、トリガ、制約を全て削除します。  
しかし、ビューや他のテーブルから外部キー制約によって参照されているテーブルを削除するにはCASCADEを指定する必要があります  
（CASCADEを指定すると、テーブルに依存するビューは完全に削除されます。  
しかし、外部キー制約によって参照されている場合は、外部キー制約のみが削除され、その外部キーを持つテーブルそのものは削除されません）。  

---

## リレーション

[わかりそう](https://wa3.i-3-i.info/word11596.html)  
>リレーション（英：relation）とは「リレーションシップ」のこと。  
用語の中身としてはアレとコレの「関係性」のこと。  
E-R図で出てくる線のこと、とも言えます。
データベースの話で出てきたら「テーブル」のこと。  

<https://twitter.com/n_1215/status/1554268701951934465>  
>RDBではテーブルこそがリレーションだと知らずテーブル同士の関連をリレーションと呼んでしまうITエンジニアの割合 - Wikipedia  

[wiki]  
>関係（かんけい、リレーション、英: relation）とは関係モデル（リレーショナルモデル）において、一つの見出しと0以上の同じ型の組 (タプル、行) の順序づけられていない集合からなるデータ構造のことである。  
>関係データベースのデータベース言語であるSQL では、関係変数とほぼ同じ意味で表 (テーブル) という用語が使われている。  

リレーションはテーブル同士の関連だと思ってたところ、ツイートを見たので調べてみたら、どうやら本当にテーブルの事らしい。  

---

## Redis

>Redisは、ネットワーク接続された永続化可能なインメモリデータベース。  
>連想配列（キー・バリュー）、リスト、セットなどのデータ構造を扱える。  
>いわゆるNoSQLデータベースの一つ。  
>オープンソースソフトウェアプロジェクトであり、Redis Labs（英語版）がスポンサーとなって開発されている。  
>[wiki]  

## Vertica

カラム指向データベース  

>Vertica Systems (ヴァーティカシステムズ)、はアメリカ合衆国マサチューセッツ州に本拠を置く、分析データプラットフォームを提供するソフトウェア会社である。  
グリッドベースかつ列指向のVertica Analytic Databaseは大規模かつ急増するデータを管理し、データウェアハウス等の多クエリアプリケーションに使用するため、高速のクエリ性能を提供するために設計されている。  

[wiki](https://ja.wikipedia.org/wiki/Vertica)  

---

## オンプレミス

>オンプレミスとは、システムを運用する上で必要なソフトウェア・ハードウェアを自社で保有・管理する運用形態です。  
自社でハードウェアなどを保有しない運用形態であるクラウドとは、対になるあり方として、よく比較されます。  

- メリット  
  - セキュリティ管理を自社で行える  
  - カスタマイズや他システムとの連携がしやすい  

- デメリット  
  - 運用開始までにコストや時間がかかる  
  - 保守やトラブル対応など運用の負担が大きい  

[クラソル](https://business.ntt-east.co.jp/content/cloudsolution/column-251.html#:~:text=%E3%82%AA%E3%83%B3%E3%83%97%E3%83%AC%E3%83%9F%E3%82%B9%E3%81%A8%E3%81%AF%E3%80%81%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%82%92,%E3%81%A8%E3%81%97%E3%81%A6%E3%80%81%E3%82%88%E3%81%8F%E6%AF%94%E8%BC%83%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%E3%80%82)  

---

## カーディナリティ

>SQL (Structured Query Language) では、カーディナリティという用語は、データベーステーブルの特定の列 (属性) に含まれるデータ値の一意性を指します。  
カーディナリティが低いほど、列内の要素の重複が多くなります。  
したがって、カーディナリティが最も低い列は、すべての行で同じ値になります。SQL データベースはカーディナリティを使用して、特定のクエリに最適なクエリ プランを決定します。  
[wiki]

cardinality:<<数学>>濃度  

男女は2なのでカーディナリーは低い。  
1年は365日なのでカーディナリーは365となり、2より高いと言える。  
インデックスはカーディナリーが高いものに張るべし。  

[カーディナリティについてまとめてみた](https://qiita.com/soyanchu/items/034be19a2e3cb87b2efb)  
[カーディナリティが高い低いとは](https://dolphinpg.net/program/sql/cardinality/)  

---

## フルテキストインデックス

>インデックス（索引）は、データベースの性能を向上させる方法の一つです。  
しかし、通常のIndex では text ベースのカラム(CHAR型、VARCHAR型、TEXT型) から特定の文字列を検索する全文検索には向いていません。  
それは、通常のIndex はカラムの値の一部ではなく、値全体に対する検索に最適化されているからです。  
そのため、全文検索 (カラムの値の一部が一致している結果を取得) するには、別のインデックス FULLTEXT INDEX が必要です。  
[世界一わかりやすい FULLTEXT INDEX の説明と気を付けるべきポイント](https://zenn.dev/hiroakey/articles/9f68ad249af20c)  

---

## プリペアードステートメント

SQL文で値がいつでも変更できるように、変更する箇所だけ変数のようにした命令文を作る仕組みのこと。  
パラメータクエリともいうらしい。  
Dapperにおいて`@変数`として動的にSQL文を組み立てるあの部分がそういうことになる。  

[プリペアドステートメントを利用してデータを取得する方法について解説！](https://qiita.com/wakahara3/items/d7a3674eecd3b021a21e)  
[C# .NET パラメータクエリでSQLインクジェクション対策](https://greentown.tokyo/dotnet-sqlinjection/)  

---

## トランザクションの肥大化

[トランザクションログ肥大化の対処方法 (log_reuse_wait_desc : LOG_BACKUP) [SQL Server]](https://www.nobtak.com/entry/tlogs2)  
[【INDEX】SQL Server トランザクションログ肥大化 (原因／対処方法)](https://www.nobtak.com/tlogidx#2-%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%AD%E3%82%B0%E3%82%92%E8%82%A5%E5%A4%A7%E5%8C%96%E3%81%95%E3%81%9B%E3%81%A6%E3%81%84%E3%82%8B%E3%82%AF%E3%82%A8%E3%83%AA%E3%81%AE%E7%89%B9%E5%AE%9A%E6%96%B9%E6%B3%95)  
[トランザクションログを肥大化させているクエリの特定方法 [SQL Server]](https://www.nobtak.com/entry/tlogs0)  
