# コンピューター構成要素

---

## プロセッサー


一般に命令の実行は、次の5つのステージに分かれています。フェッチ（fetch）とは「取ってくる」をいう意味をもつ言葉です。
### 命令フェッチ
プログラムカウンタが示すアドレスから命令語を命令レジスタに取り出す。

### 命令デコード
命令デコーダが取り出した命令を解読する。

### 実効(有効)アドレス計算
命令語のオペランド部の値を用いて、演算対象のデータを保持する主記憶のアドレスを計算する。

### オペランドフェッチ
計算されたアドレス値を用いて主記憶からデータを汎用レジスタに取り出す。

### 実行
解読された命令と演算対象のデータで命令を用いて演算を行う。


### プログラムカウンター(プログラムレジスタ)
次に実行するべき命令が格納されている主記憶上のアドレスを保持するレジスタです。
命令自体はメモリ上にある。そのアドレスを保持するレジスタでしかない。

### 命令レジスタ
主記憶から取り出された命令が格納される場所です。

### ALU(Arithmetic Logic Unit)
演算装置。論理演算と加算、減算を行う。記号はめっちゃ太字のVみたいなやつ。

### アキュムレータ
演算途中の結果を一時的に保持しておくためのレジスタです。
演算データを保管するレジスタが1つしかない場合、このレジスタを「アキュムレータ」と呼ぶ。

### 汎用レジスタ
データの一時的な保持や演算結果の格納など、使い方を自由に決められる。
CPUの中にあって、演算データを一時的に保管するレジスタを複数持つ場合、この複数のレジスタ群を「汎用レジスタ」と呼ぶ。

### スタックポインタ
スタックの先頭アドレスを保持する。

### レジスタファイル
レジスタを複数集めたプロセッサ内のモジュール


コンピュータは、次のようなサイクルを繰り返して命令を処理していきます。
①プログラムカウンタを参照して、次に実行すべき命令が格納されている位置を知る。
②主記憶から命令レジスタに命令を読込む。(命令フェッチ)
③その次に実行する命令の主記憶上のアドレスをプログラムカウンタに格納する。
④命令レジスタの命令を命令デコーダで解読(解釈)する。(命令デコード)
⑤演算で必要となる値(オペランド)を主記憶やレジスタから読込む。(オペランド読出し)
⑥命令を実行する。
⑦実行結果を主記憶やレジスタに書込む。



### プログラム格納方式(プログラム内蔵方式)
主記憶に記憶されたプログラムを，CPUが順に読み出しながら実行する方式はどれか。
処理するプログラムを外部から主記憶装置に格納しておいて、CPUがそれを読込みながら処理を行うコンピュータアーキテクチャの方式の1つです。
ジョン・フォン・ノイマンによって考案、1945年に提唱されたので「ノイマン型アーキテクチャ」とも呼ばれ、現在に至るまでのコンピュータに採用されています。

### DMA(Direct Memory Access)制御方式
入出力装置がCPUを介さずにメモリとの間で直接データを転送する方式です。


### アドレス指定方式
コンピュータの命令は、命令部とアドレス部(オペランド)から構成されています。(ただし命令の種類によってはアドレス部がないものもあります)
命令の処理対象となるデータのメモリ上の位置がアドレス部で指定されますが、
このとき各種レジスタおよび主記憶上のアドレスを関連付けて有効アドレスを指定する場合があります。
このようなアドレス部の情報による有効アドレスの指定方式をアドレス指定方式といいます。

### 直接アドレス指定
アドレス部の値をそのまま有効アドレスとする。

### 間接アドレス指定
アドレス部の値で主記憶上のアドレスを指定し、そのアドレスに格納されている値を有効アドレスとする。
アドレス部に20って入ってて、メモリの20番地に行ったら25番地ってアドレスが入ってて、25番地に行ったらデータが入ってたみたいな、そんな感じのたらい回し。

### 指標アドレス指定
アドレス部の値にインデックスレジスタの値を加えたものを有効アドレスとする。

### 基底アドレス指定
アドレス部の値にベースレジスタの値を加えたものを有効アドレスとする。

### 相対アドレス指定
アドレス部の値にプログラムカウンタの値を加えたものを有効アドレスとする。
### 即値アドレス指定
アドレス部の値を有効アドレスではなく、そのまま演算対象データとする。



### 割込み(Interrupt)
すぐに対処しなくてはならない問題などがシステムに生じたときに、実行中のプログラムの処理をいったん停止し、優先的に事象の解決を図ることを可能にする仕組みです。
割込みは、実行中のプログラムが原因でCPU内部で発生する内部割込みと、それ以外の(CPU外部で発生する)外部割込みに分類することができます。

### 内部割込み
実行中のプログラムが原因で起こる割込み
・ページフォールト
・ゼロ除算
・存在しない命令コード

### 外部割込み
内部割込み以外の原因で起こる割込み
・タイマー割り込み

---

## メモリ

### DRAM(Dynamic Random Access Memory)
コンデンサに電荷を蓄えることにより情報を記憶し、電源供給が無くなると記憶情報も失われる揮発性メモリです。
集積度を上げることが比較的簡単にできるためコンピュータの主記憶装置として使用されています。
コンデンサに蓄えられた電荷は時間が経つと失われてしまうので、DRAMでは記憶内容を保持するための「リフレッシュ操作」を随時行う必要があります。
・読み書きが遅い
・消費電力が大きい
・容量を大きくしやすい
・安い
・リフレッシュ動作が必要


### SRAM(Static Random Access Memory)
メモリセルはフリップフロップで構成され，キャッシュメモリに用いられる。
・フリップフロップ
・読み書きが速い
・消費電力が小さい
・容量を大きくしにくい
・高い

### EEPROM(electrically erasable and programmable read-only memory)
1バイト単位でデータの消去及び書込みが可能な不揮発性のメモリであり，電源遮断時もデータ保持が必要な用途に用いられる。

### ROM(Read Only Memory)
読み出し専用で、電源の供給が切れても内容を保持しておくことのできる不揮発性のメモリです。
内容の書き換えができないという特徴を利用して、変更する必要のないシステムプログラムなどを格納しておく用途に使用されることが多いです。
一般的にはコンピュータに電源を投入すると、マザーボード上のROMに格納されている「IPL」(Initial Program Loader)というプログラムが起動し、
その後ハードディスク内のブートプログラム、続いてOSという順で起動して操作可能な状態になります。



### ライトスルー方式(write through)
CPUから書き込む命令が出たときにキャッシュメモリと同時に主記憶にも書き込む方式。データの整合性は得られるが処理速度は低下する。
キャッシュミスが発生すると、キャッシュ内の必要のないデータを主記憶に移動し、要求されたデータを主記憶からキャッシュにコピーします。
→常に主記憶とキャッシュの内容が一致するため一貫性の確保は容易だが、主記憶への書き込みが頻繁に行われるので遅い

### ライトバック方式(write back)
CPUから書き込む命令が出たときにキャッシュメモリだけに書き込む方式。主記憶への書き込みはキャッシュメモリからデータが追い出されるときに行われる。
該当データがキャッシュから追い出されたタイミングで主記憶に書き出すので、一貫性を保つために書き戻し処理が必要となります。
→主記憶とキャッシュの内容が一致しないため一貫性を保つための制御が複雑になるが、主記憶への書き込み回数が少ないため速い


### 平均メモリアクセス時間
キャッシュメモリと主記憶が存在する場合、実際の1アクセスに要する平均時間を平均(実効)アクセス時間といい、以下の公式で計算することができます。
$(キャッシュメモリのアクセス時間×ヒット率)＋主記憶のアクセス時間×(1－ヒット率)$
キャッシュメモリと主記憶では、キャッシュメモリのほうが圧倒的に高速にアクセスできるため、
平均アクセス時間は「ヒット率が高いほど短く、ヒット率が低いほど長くなる」関係にあります。

・平均メモリアクセス時間が増加する原因は「ヒット率の低下」


---

## 入出力デバイス

### デイジーチェーン接続
パラレル転送規格のSCSI(スカジー)などで用いられる接続方法で、「PC－周辺機器－周辺機器」というように、PCを起点として複数の周辺機器を直列で(数珠つなぎのように)接続する方法です。
周辺機器同士が直接繋がるということがポイント。
例:Thunderbolt接続コネクタが2口ある4kディスプレイ2台を，PCのThunderbolt接続ポートから1台目のディスプレイにケーブルで接続し，さらに，1台目のディスプレイと2台目のディスプレイとの間をケーブルで接続する。


### USB3.0
現在最も普及している周辺機器接続のためのシリアルインターフェイスのバージョン3に当たる規格です。
USB2.0から3.0への進化で最も特徴的なのが最大転送速度の大幅な向上です。
2.0では"ハイスピードモード"の480Mbpsが最大でしたが、3.0では5Gbpsの"スーパースピード"が加わっています。さらに2013年8月に策定されたバージョン3.1では、
3.0の2倍となる10Gbpsの転送を可能にする"スーパースピードプラス"が登場しています。

### IEEE1394
音声，映像などに適したアイソクロナス転送を採用しており，ブロードキャスト転送モードをもつシリアルインタフェースである。

### SATA(Serial ATA)
PCと周辺機器とを接続するATA仕様をシリアル化したものである。

### 1000BASE-T
1クロックで2ビットの情報を伝送する4対の信号線を使用し，最大1Gビット／秒のスループットをもつインタフェースである。


USB-A、USB-B、USB-Cがあります。さらにAとBにはMiniおよびMicroタイプが存在します。

USB-Aがいつも上下間違う奴。
USB-Bは四角い奴。正直あんまり見たことない。
USB-Cは上下左右が対称。
MiniとMicroは言葉で説明するの難しいな。


---

## 1回目に間違えた問題

平成29年春期　問9
キャッシュの書込み方式には，ライトスルー方式とライトバック方式がある。ライトバック方式を使用する目的として，適切なものはどれか。

→
おいおいって感じ。
ライトスルーはそのままメモリーに書き込むってのは覚えてた。
ライトバックがあいまいだったので今回で覚えましょう。
あれこれ考えてくれるので、メモリの書き込み頻度を減らすことができるのがライトバックです。
エラー起こったときに書き戻しもしてくれますよ。



平成26年春期　問9
主記憶に記憶されたプログラムを，CPUが順に読み出しながら実行する方式はどれか。

→
そのまんま東。



平成30年春期　問9
図はプロセッサによってフェッチされた命令の格納順序を表している。a に当てはまるものはどれか。
         |   プロセッサー
主記憶→ | a → 命令デコーダー

→
実はCPUの構造を覚えていない。
そういえば、スレッドとかコアの関係も勉強したいですね。
命令なのでプログラムカウンタかと思ったら命令レジスタ見たい。命令レジスタって何？
