# バッチまとめ

## for文内で変数を利用する場合の注意

forブロック内では基本的に変数は使えない。  
使いたい場合は**遅延環境変数**という仕組みを利用する。  
変数を使用する場合 `%` で囲うのではなく、 `!` で囲う。  

例 :  
× `%arg%`  
○ `!arg!`  

[batファイルでfor文内に変数を利用する場合の罠 | なたで日記](https://blog.natade.net/2018/10/06/windows-bat-%E9%81%85%E5%BB%B6%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0-for-if/)  

---

## 新しいターミナルを開いて、コンソールアプリを実行する

バッチをダブルクリックしたらコンソールアプリをターミナルを開いた状態で実行したい。  

コンソールアプリのexeはダブルクリックで起動した場合、すぐに閉じてしまうので、コマンドプロンプトからexe名を指定して実行した時のように実行させたい。  
exeの発行先が別にあるので、exeを発行するバッチの隣に実行バッチを置いて実行したかった。  

``` bat
@echo off

cd .\Bundle\win\
call cmd /k "Bundle.exe"
```

[コマンドプロンプト cmd - [新しいインスタンスを開始する]](https://www.k-tanaka.net/cmd/cmd.php)  

---

## フォルダを削除する方法

`rmdir` コマンド（別名 `rd` コマンド）を使用して行うことができます。  
`rmdir` コマンドは、指定したディレクトリを削除します。  

``` batch
rmdir /s /q フォルダのパス
```

- /s は、指定されたディレクトリとそのサブディレクトリを削除するオプションです。  
- /q は、確認プロンプトを表示せずに削除を行うオプションです。  
- フォルダのパス は、削除するフォルダのパスを指定します。  

例えば、C:\example_folder という名前のフォルダを削除する場合、次のように記述します。  

``` batch
rmdir /s /q C:\example_folder
```

---

## バッチファイルでのカレントディレクトリ変更

``` batch
SET RUNPATH=%~dp0
CD %RUNPATH%
```

このバッチファイルの命令は、スクリプト自体のディレクトリにカレントディレクトリを変更しています。  

1. `SET RUNPATH=%~dp0`  
   `%~dp0`は、バッチファイル自体のフルパスを表します。  
   ここでは、`RUNPATH`という環境変数にバッチファイルのディレクトリパス（ドライブレターとパス）を代入しています。  

2. `CD %RUNPATH%`  
   この行は、カレントディレクトリをRUNPATHで指定されたディレクトリに変更しています。  
   RUNPATHはバッチファイルのディレクトリパスを格納しているため、このコマンドによってカレントディレクトリがバッチファイルのディレクトリに変更されます。  

この2行のコマンドにより、バッチファイルがどこから実行されても、その後の処理がバッチファイルと同じディレクトリを基準に実行されるようになります。  
これは、特定のフォルダ内のファイルやサブディレクトリに依存する処理を行う場合に役立ちます。  
