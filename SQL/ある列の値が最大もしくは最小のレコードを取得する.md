# ある列の値が最大もしくは最小の値のレコードを取得する

働かない頭で「sql minれこーど」で調べたらやりたいことが出てきてくれた。  

[SQL ある列の値が最大もしくは最小の値のレコードを取得する](https://zukucode.com/2017/08/sql-row_number-technique.html)  
[特定のカラムのグループごとの最大値が格納されている行](https://dev.mysql.com/doc/refman/5.6/ja/example-maximum-column-group-row.html)  

``` SQL
SELECT
    [Header].[OfficeCD],
    [Header].[BusinessDate],
    [Header].[SlipID],
    [Player].[AccountNo],
    [Player].[Name],
    [Header].[PersonCount]
FROM (
    SELECT
        [TFr_Slip].[OfficeCD],
        [TFr_Slip].[BusinessDate],
        [TFr_Slip].[SlipID],
        [TFr_Slip].[PersonCount]
    FROM
        [TFr_Slip]
    WHERE
        [TFr_Slip].[OfficeCD] = 'ALP'
        AND [TFr_Slip].[BusinessDate] = '2020/07/25'
        AND [TFr_Slip].[SlipType] = '150'
        AND [TFr_Slip].[DetailType] = 99
) AS [Header]
JOIN (
    SELECT
        [A].[SlipID],
        [A].[AccountNo],
        [A].[Name]
    FROM(
        SELECT
            ROW_NUMBER() OVER(PARTITION BY [TFr_Slip].[SlipID] ORDER BY [TRe_ReservationPlayer].[AccountNo]) [MinAccountNo],
            [TFr_Slip].[SlipID],
            [TRe_ReservationPlayer].[AccountNo],
            [TRe_ReservationPlayer].[Name]
        FROM
            [TFr_Slip]
            LEFT OUTER JOIN [TRe_ReservationPlayer]
            ON [TFr_Slip].[OfficeCD] = [TRe_ReservationPlayer].[OfficeCD]
            AND [TFr_Slip].[BusinessDate] = [TRe_ReservationPlayer].[BusinessDate]
            AND [TFr_Slip].[PlayerNo] = [TRe_ReservationPlayer].[PlayerNo]
        WHERE
            [TFr_Slip].[OfficeCD] = 'ALP'
            AND [TFr_Slip].[BusinessDate] = '2020/07/25'
            AND [TFr_Slip].[SlipType] = '150'
            AND [TFr_Slip].[DetailType] <> 99
        ) AS [A]
    WHERE
        [A].[MinAccountNo] = 1
) AS [Player]
ON [Header].[SlipID] = [Player].[SlipID]
```
