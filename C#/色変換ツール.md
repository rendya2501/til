# 色変換ツール

[【VB.NET】【WPF】Extended WPF Toolkit ColorPicker の使い方](https://elleneast.com/?p=12894#ColorPicker_xaml)  

intを色に変換するためのお手軽な仕組みがなかったので、実務で作りたいなーと思いながら作ってたら変換までできたので、気が済むところまで作ることにした。  
そのまとめ。

[WPFでColorPickerを作った話(前編)](https://recruit.cct-inc.co.jp/tecblog/csharp/wpf-colorpicker/)  
ここの更新も楽しみである。  

---

nugetからインストールするパッケージ  

- System.Drawing.Color
- Extended WPF Toolkit

wpfには標準で[ColorPicker]に相当するコントロールは存在しない模様。(WinFormにはある見たい)  
さすがに何かあるだろうと探したらxceedで作ってた。  

---

## コード

``` C#
using RN3.Wpf.Common.Resource;
using System;
using System.Globalization;
using System.Windows.Data;

namespace RN3.Wpf.Common.Converter
{
    /// <summary>
    /// 色コンバータ
    /// </summary>
    public class BrushConverter : IValueConverter
    {
        /// <summary>
        /// デフォルトカラー
        /// </summary>
        public System.Drawing.Color DefaultColor { get; set; }

        /// <summary>
        /// IntからColorに変換する
        /// </summary>
        /// <param name="value"></param>
        /// <param name="targetType"></param>
        /// <param name="parameter"></param>
        /// <param name="culture"></param>
        /// <returns></returns>
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value == null)
            {
                if (DefaultColor != null)
                {
                    var dc = DefaultColor;
                    return new System.Windows.Media.SolidColorBrush(System.Windows.Media.Color.FromArgb(dc.A, dc.R, dc.G, dc.B));
                }
                return null;
            }
            if (!(value is int)) throw new Exception(string.Format(Message.Invalid, "型"));
            //IntからRGBに変換
            var c = System.Drawing.Color.FromArgb((int)value);

            return new System.Windows.Media.SolidColorBrush(System.Windows.Media.Color.FromRgb(c.R, c.G, c.B));
        }

        /// <summary>
        /// ColorからIntに変換する
        /// </summary>
        /// <param name="value"></param>
        /// <param name="targetType"></param>
        /// <param name="parameter"></param>
        /// <param name="culture"></param>
        /// <returns></returns>
        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value == null)
            {
                return null;
            }
            if (!(value is System.Windows.Media.SolidColorBrush)) throw new Exception(string.Format(Message.Invalid, "型"));

            var valueColor = ((System.Windows.Media.SolidColorBrush)value).Color;
            var c = System.Drawing.Color.FromArgb(valueColor.R, valueColor.G, valueColor.B);
            return c.ToArgb();
        }
    }
}
```

``` XML
<Window
    x:Class="Color.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Color"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    Title="MainWindow"
    Width="800"
    Height="450"
    mc:Ignorable="d">
    <Grid>
        <xctk:ColorPicker
            Width="126"
            Height="29"
            Margin="455,94,211,296" />
        <TextBox
            Name="_Input"
            Width="126"
            Height="29"
            Margin="96,119,0,0"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Text="TextBox"
            TextWrapping="Wrap" />
        <TextBox
            Name="_Output"
            Width="126"
            Height="29"
            Margin="96,172,0,0"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Text="TextBox"
            TextWrapping="Wrap" />
        <Button
            Name="_Execute"
            Width="126"
            Height="32"
            Margin="96,254,0,0"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Click="_Execute_Click"
            Content="Button" />
        <Border
            Name="_Border"
            Width="88"
            Height="73"
            Margin="334,148,0,0"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            BorderBrush="Black"
            BorderThickness="1" />
    </Grid>
</Window>
```

``` C#
    /// <summary>
    /// MainWindow.xaml の相互作用ロジック
    /// </summary>
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
        }


        private void _Execute_Click(object sender, RoutedEventArgs e)
        {

            {
                var aaa = new SolidColorBrush(System.Windows.Media.Color.FromRgb(0, 255, 255));
                //if (value == null)
                //{
                //    return null;
                //}
                //if (!(value is System.Windows.Media.SolidColorBrush)) throw new Exception(string.Format(Message.Invalid, "型"));

                var valueColor = aaa.Color;
                var c2 = System.Drawing.Color.FromArgb(valueColor.R, valueColor.G, valueColor.B);
                _ =  c2.ToArgb();
            }

            var value = _Input.Text;

            //if (value == null)
            //{
            //    if (DefaultColor != null)
            //    {
            //        var dc = DefaultColor;
            //        return new System.Windows.Media.SolidColorBrush(System.Windows.Media.Color.FromArgb(dc.A, dc.R, dc.G, dc.B));
            //    }
            //    return null;
            //}
            if (!int.TryParse(value, out int aaaa))
            {
                //throw new Exception("型");
                MessageBox.Show("かた");
                return;
            }
            //IntからRGBに変換
            var c = System.Drawing.Color.FromArgb(aaaa);


            var brush = new SolidColorBrush(System.Windows.Media.Color.FromRgb(c.R, c.G, c.B));
            _Border.Background = brush;
        }
    }
```
