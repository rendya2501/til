# 102で101復習

結構忘れてる。  
よく受かったな。  
今なら余裕で資格はく奪レベルだ。  
というわけで、思い出したいので、ここで復習します。  

---

## exportコマンド  

環境変数やシェル変数を設定するコマンド。  
環境変数を定義したり、シェル変数を環境変数に、環境変数をシェル変数に変更する。  

``` txt
export [オプション] [変数名[=値]…]

オプション
-f → シェル変数を参照する
-n → 指定した環境変数をシェル変数に変える
-p → 全てのエクスポートされた変数と関数を全て一覧表示する。
```

**exportコマンドの引数に指定するシェル変数の先頭には`$`は付かない**  

シェル変数DISPLAYを定義  
`DISPLAY=localpc:0`  

シェル変数DISPLAYを環境変数に設定  
`export DISPLAY`  

シェル変数定義と同時に環境変数に設定  
`export DISPLAY=localpc:0`  

環境変数DISPALYを削除  
`export -n DISPLAY`  

---

## envコマンド

環境変数が表示される。  

---

## printenvコマンド

現在設定されている環境変数を確認するコマンド  

---

## setコマンド

シェル変数と環境変数を表示する。  
環境変数確認のための問題で大体セットでついてくる奴。  
詳しくは102の範囲なのでそっちでやる。  

---

## systemd

[これからSystemd入門する](https://qiita.com/bluesDD/items/eaf14408d635ffd55a18)  
>systemdとは？  
>Linuxの起動処理やシステム管理を行う仕組み。  
>CentOS7より採用。  

起動したときに一番最初に起動されるinitプロセス。  
各種サービスの管理等を行うプログラム。  

## systemd関連の主なデーモンプロセス

systemdは複数のデーモンプロセス(常駐プロセス)が連携して動作する。

systemd :: systemdのメインプロセス  
systemd-journald :: ジャーナル(ログ)管理プロセス  
systemd-loging :: ログイン処理プロセス  
systemd-networkd :: ネットワーク管理プロセス  
systemd-timesyncd :: システムクロック同期プロセス  
systemd-resolved :: 名前解決プロセス  
systemd-udevd :: デバイス動的検知プロセス  

## Unit

systemdでは、システムの起動処理は多数のUnitと呼ばれる処理単位にわかれている。  
サービスを起動するUnit,ファイルシステムをマウントするUnit等がある。  

service :: 各種サービスを起動する。  
device :: 各種デバイスを表す。  
mount :: ファイルシステムをマウントする。  
swap :: スワップ領域を有効にする。  
target :: 複数のUnitをグループ化する。  
timer :: 指定した日時や間隔で処理を実行する。  

httpd.serviceはhttpd(Webサーバー)サービスの起動に使われるUnit。  

## systemctlコマンド  

systemdでサービスを管理するためのコマンド。  
サービス起動デーモンsystemdのコントロール用コマンド  

``` txt
systemctl サブコマンド [Unit名] [-t 種類]

サブコマンド
start :: サービス起動 
stop :: サービス停止
restart :: サービス再起動
reload :: サービスリロード
status :: サービスステータス表示
is-active :: サービスが稼働しているかどうか確認する。
enable :: サービス自動起動有効
disable :: サービス自動起動無効
is-enabled :: サービス自動起動設定確認
list-unit-files :: サービス一覧
```

設定ファイルの再読込 :: systemctl daemon-reload  

サービス起動  
`sudo systemctl start dotnetcorewebOES.service`  

サービス起動自動起動有効  
`sudo systemctl enable dotnetcorewebOES.service`  

サービス停止  
`sudo systemctl stop dotnetcorewebOES.service`  

サービス再起動  
`sudo systemctl restart dotnetcorewebOES.service`  

サービスステータス確認  
`sudo systemctl status dotnetcorewebOES.service`  

---

## ナイス値

プロセスの優先度を表す値。  
-20から19まであり、-20が一番高い。  
デフォルトは0。  

[プロセス優先度(NICE値)を変更する方法](https://qiita.com/hana_shin/items/438dfe93a765ffa337ae)

---

## findコマンド

ファイルやディレクトリを検索するコマンド  

``` txt
find [ディレクトリ] [検索式]
ディレクトリを省略した場合、カレントディレクトリ以下が対象となる。

検索式
-name → ワイルドカードを使用してファイルやディレクトリの一部のみ指定した検索ができる
-atime → 最終アクセス時刻で検索
-mtime → 最終更新時刻で検索
-perm → アクセス権で検索
-size → ファイルサイズ(ブロック単位)で検索
-type → ファイルの種類で検索。 d:ディレクトリ l:シンボリックリンク f:ファイル
-user ユーザー名 : ファイルの所有者で検索
-uid → ユーザーIDで作成したファイルを検索
-print → マッチしたファイルの表示(省略可能)
-print0 → 検索結果をnull文字で区切る
-exec コマンド || \; → マッチしたファイルに対してコマンドを実行する
-ok コマンド || \; → マッチしたファイルに対してコマンドを実行する(確認あり)
-mindepth → 指定した階層より下を検索
-maxdepth → 指定した階層まで検索
```

/homeディレクトリ以下から、ファイル名の末尾が「.rpm」のファイルを検索する。  
`find /home -name "*.rmp"`  

/dataディレクトリ以下から過去1日以内に更新されたファイルを検索する。  
`find /data -type f -mtime -1`  

/usr/binディレクトリ以下からSUIDが設定されたファイルを検索する。  
`find /usr/bin -type f -perm -u+s`  

/tmpディレクトリ以下から所有者がstudentであるファイルやディレクトリを検索する。  
`find /tmp -user student`  

カレントディレクトリ以下から30日を超える日数の間アクセスされていないファイルを検索し、削除する。  
`find -atime +30 -exec rm {} \`  

現在のディレクトリ以下にあるシンボリックリンクファイルを探す  
`find -type l`  

/binディレクトリ内で、一般ユーザーが実行してもroot権限で実行されるファイルを検索する。  
`find /bin -uid 0 -perm /4000`  
uid 0はrootユーザーを表す。0は固定値。  
`/4000`の構文はSUID,SGIDのいずれか片方でも設定されているファイルを検索する場合の構文な模様。  

[【Linux】 findコマンドとパーミッション](https://www.ricecake24book.com/linux-find-perm/)  

SUIDとSGIDが両方設定されているファイルを検索する  
`find /usr -perm -6000`  

SUIDとSGIDのいずれか片方でも設定されているファイルを検索する。  
`find /usr -perm /6000`  

`+`の場合も`/`と同じ動作ではあるが、指定の仕方が古く警告が表示されるらしい。`/`を使って検索すべしとのこと。  
`find /usr -perm +6000`  

``` txt : <https://atmarkit.itmedia.co.jp/ait/articles/1809/13/news037.html>  
実行時の権限を指定するSUID（Set User ID）とSGID（Set Goup ID）というパーミッションがLinuxには用意されています。  
SUIDが設定されているファイルを探したい場合は「u」を付けて「-perm -u+s」と指定するか、パーミッションに「4000」を足して「-perm -4000」のように指定します。  
同様に、SGIDが設定されているファイルを探したい場合は「g」を付けて「-perm -g+s」とするか、「2000」を足して「-perm -2000」のように指定します。  
```

---

## touchコマンド

ファイルのタイムスタンプを変更するコマンド。  
存在しないファイル名を指定することで、内容の入っていないファイルを新規作成する機能も持っている。  
なので、本来の使い方はされず、もっぱらファイルを作るコマンドと化している。  

---

## catコマンド

ファイルを連結するためのコマンド。  
conCATenate(繋ぐ、連結する)  
ファイルの内容をサクッと確認するためにも使われる。  

``` txt
car [オプション] ファイル1 ファイル2 ...

オプション
-n → 行番号を付ける。
-b → 行番号を付ける。但し空白行には付けない。
-s → 連続した空行を1行にする。

他にも色々。101で出たのは-nだけ。
```

---

## ヒアドキュメント  

第3章、GNUとUNIXコマンドの内容。  

`コマンド << 終了文字` :: 終了文字が現れるまで標準入力へ送る  

``` bash
echo 'hoge'
echo 'fuga'
echo 'piyo'
```

``` bash
cat << EOS
hoge
fuga
piyo
EOS
```

---

## ブロックデバイスファイル  

前提としてデバイスファイルである事。  
アクセス時に文字単位ではなく、ブロック単位でデータを転送するものを「ブロックデバイス」と呼ぶ。  
ハードディスクドライブやUSB,CR-ROM,メモリ領域などのデバイスファイルはこのように呼ばれるらしい。  

---

## bash

多くのUNIX系OSで標準的に用いられるシェルプログラムの1つ。  
shをパワーアップしたシェル。  
正式名称は`Bourne Again Shell`  
Bourne AgainはBorn Again(新生)と作成者のBourneとを掛け合わせた物らしい。  

シェルは利用者からOSへの操作の受付や操作の実行結果の表示等を担うプログラム。  

## sh

Bourneシェル。  
bashの前身。  
Stephen Bourne（スティーブ・ボーン）氏が1977年に開発した。  
ゆえにBourneシェル  

---

## tarコマンド

.tar形式に圧縮したり展開したりするコマンド。  
複数ファイルを1つのファイルにまとめることをアーカイブと言う。  
tarコマンドは[-]を省略できる。  

``` txt
tar [オプション] ファイル名

-c :: アーカイブの作成
-x :: アーカイブからファイルの取り出し
-t :: アーカイブの内容の確認
-f ファイル名 :: アーカイブファイル名の指定
-z :: gzipによる圧縮・展開
-j :: bzip2による圧縮・展開
-J :: 7zipによる圧縮・展開
-v :: 詳細な情報の表示
-u :: アーカイブ内にある同じ名前のファイルより新しいものだけを追加
-r :: アーカイブにファイルの追加
-N :: 指定した日付より新しいデータのみを対象とする
-M :: 複数デバイス得の分割
-- delete :: アーカイブからファイルの削除
```

「aa」「bb」「cc」の3ファイルを1つにまとめて「hoge.tar」というアーカイブにしたい。
`tar cf hoge.tar aa bb cc`

---

## lnコマンド

ディレクトリやファイルへのリンクを登録するコマンド。  
オプションなしで実行した場合、ハードリングが作成される。  
[シンボリックリンクの作成、更新、削除、権限変更をしました。](https://qiita.com/pugiemonn/items/e5fb508df690a323ee14)  

``` txt
ln [オプション] リンク元 リンクファイル

-s :: シンボリックリンクを作成する。
-f :: 既に登録名が登録されているものであった場合、登録内容を上書きする。
-i :: 既に登録名が登録されているものであった場合、登録内容を上書き登録するか確認する問い合わせがある。
-n :: リンクの作成場所として指定したディレクトリがシンボリックリンクだった場合、参照先にリンクを作るのではなく、シンボリックリンクそのものを置き換える。(-fと組み合わせて使用する。)
```

testディレクトリの中のdata01.datのリンクをd01という名前で作成する。  
`ln test/data01.dat d01`  

testディレクトリの中のdata01.datのシンボリックリンクをd02symbolという名前で作成する。  
`ln -s test/data01.dat d02symbol`  

ディレクトリへシンボリックリンクを貼る  
`ln -nfs ディレクトリのパス シンボリックリンクを貼るディレクトリのパス`  

currentディレクトリへシンボリックリンクを更新する。  
`ln -nfs /var/www/pugiemonn.com/releases/20150510043839 current`  
やっぱり強制上書きになるよな。  

---

### UID

UIDとは、複数の利用者（user）を一意に識別するための識別子（identifier）。  
または、一意（unique）の識別子。 具体的な仕様や規約はシステムの種類によって異なる。  

### SUID(Set User ID)

実行権のあるファイルに設定される特殊なアクセス権です。  
通常、実行ファイルを実行すると、そのファイルを実行したユーザーの権限で実行されますが、SUID（Set User ID）が設定されたファイルでは、  
その実行ファイルの所有者のアカウント権限で実行されます。  

### SGID(Set Group ID)

SUIDのグループバージョン。  
そのファイルを所有しているグループの権限で実行される。  

### スティッキービット（Sticky Bit)

スティッキービット（Sticky Bit）とは、ディレクトリに設定される特殊なアクセス権の事です。  
スティッキービットが設定されたディレクトリは、すべてのユーザがファイルおよびディレクトリを作成書き込みを行えるようになる。  
しかし、作成したファイルやディレクトリを削除出来るのは所有者だけとなるというパーミッション。  

