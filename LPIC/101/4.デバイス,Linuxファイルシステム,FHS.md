# デバイス、Linuxファイルシステム、FHS (主題104)

## パーティションとファイルシステムの作成

パーティション作成
・fdisk
・gdisk
・parted
→
ファイルシステム作成
・mkfs
・mke2fs : ext2,3,4のみファイスシステム作成
・mkswap
・fsck
・e2fsck : ext2,3,4のみファイルシステムチェック
・tune2fs : ext2,3,4 パラメータ設定
→
マウント
・mount
・unmount


  2番目のIDEハードディスクの2番目のパーティションを表すデバイスファイルは？
  （カーネル2.6.18より前の表記とする）
/dev/hdb2


  以下の特徴を持つファイルシステムは?
  ・マイクロソフトが開発したプロプライエタリなファイルシステム
  ・フラッシュドライブ向けのファイルシステム
  ・4GiB以上の大容量のファイルを扱える
exFAT


1番目のSCSIハードディスクの、最初の論理パーティションを表すデバイスファイルは？
/dev/sda5


「/dev/sda」デバイスのパーティションを操作したい。適切なコマンドは？
fdisk /dev/sda


 3番目のSCSIハードディスクの2番目のパーティションを表すデバイスファイルは？
/dev/sdc2


 IBMが開発した動的inodeの機能を持つファイルシステムは？
JFS


 シリコングラフィクス社が開発した動的inodeの機能を持つファイルシステムは？
XFS


  fdiskコマンドで作成したパーティションにext系のファイルシステムを作成できるコマンドは？
  (短い方から先に2つ)
  mkfs
  mke2fs
  

  「/dev/sda」デバイスのパーティションテーブルを確認したい。適切なコマンドは？
fdisk -l /dev/sda

---

## ファイルシステムの整合性の維持

  カレントディレクトリとそのサブディレクトリが占めている容量を
  メガバイト単位で表示したい。適切なコマンドは？
  du -m


e2fsckコマンドで「/dev/sda4」をチェックする際、全ての問題を
  自動的に修復したい。適切なコマンドは？
e2fsck -p /dev/sda4


 fsckコマンドのオプションのうち、問題を自動的に修復する
  オプションは？
  -a


   XFSファイルシステムをチェックするコマンドは？
  (オプション無しでチェック可能なコマンドとする）
xfs_check


 XFSファイルシステムの情報を表示するコマンドは？
 xfs_info


XFSファイルシステムのデバッグを行うコマンドは？
xfs_db


 XFSファイルシステムのデフラグを行うコマンドは？
xfs_fsr


 XFSファイルシステムの検査・修復を行うコマンドは？
xfs_repair


  fsckコマンドのオプションのうち、実際には実行せず
  実行する内容を表示オプションは？
-N


  ファイルシステムをチェックせずに「/dev/sda2」がマウント出来る回数を
  10回に変更したい。適切なコマンドは？
tune2fs -c 10 /dev/sda2


duコマンドのオプションのうち、分り易い単位を付加して表示するオプションは？
-h


  duコマンドのオプションのうち、指定したファイルやディレクトリの
  合計容量のみを表示するオプションは？
-s


  fsckコマンドのオプションのうち、ファイルシステムの種類を指定する
  オプションは？
-t



fsckコマンドのオプションのうち、「/etc/fstab」に記載されている
  全ファイルシステムに対して実行するオプションは？
-A

 e2fsckコマンドでファイルシステムの整合性をチェックする際、
  全ての問題を自動的に修復したい。
  適切なオプションは？
-p


 tune2fsコマンドのオプションのうち、ファイルシステムのチェックを行うまでの
  最大時間間隔を指定するオプションは？
-i


**a**
  デバイス「/dev/sda1」の利用状況を、分かりやすい単位を付加して確認したい。
  適切なコマンドは？
df -h /dev/sda1


**a**
 「dir」ディレクトリの合計容量のみを分かりやすい単位を付加して表示したい。
  適切なコマンドは？(オプションはアルファベット順に、まとめて指定すること)
du -hs dir


**a**
  「dir」ディレクトリと、その配下にあるディレクトリおよびファイルが占めている容量を、
  分かりやすい単位を付加して表示したい。適切なコマンドは？
  (オプションはアルファベット順に、まとめて指定すること)
du -ah dir


  ext2ファイルシステムの「/dev/hda5」をext3に変換したい。適切なコマンドは？
tune2fs -j ext3 /dev/hda5


 inodeの使用状況を確認することが出来るコマンドは？
df -i


duコマンドのオプションのうち、ディレクトリの容量に
  サブディレクトリの容量を含めずに表示するオプションは？
df -S


 fsckコマンドのオプションのうち、問題を対話的に修復する
  オプションは？
-r


duコマンドのオプションのうち、ファイルの容量についても表示するオプションは？
-a


現在、「/dev/sda2」のファイルシステムチェック間隔はデフォルト値の180日となっている。
  これを、1週間に一度ファイルチェックを行えるようにしたい。適切なコマンドは？
tune2fs -i 7 /dev/sda2


  tune2fsコマンドのオプションのうち、ファイルシステムのボリューラベルを
  設定するオプションは？
-L

---

## ファイルシステムのマウントとアンマウント

 ファイルシステムをアンマウントすることが出来るコマンドは？
umount
→
unmountではない


 ext3ファイルシステムの「/dev/sda1」を「/export」に読み取り専用でマウントしたい。
  適切なコマンドは？(オプションはアルファベット順に指定)
mount -o ro -t ext3 /dev/sda1 /export
→
オプションの指定は-o


「/dev/hdc」として認識されているCD-ROMドライブを「/mnt/cdrom」にマウントしたい。
  なお、これを実現する為のエントリは既に「/etc/fstab」ファイルに追加してある。
  適切なコマンドは？(オプション、引数を省略せずに記述すること)
mount -t iso9660 /dev/hdc /mnt/cdrom
→
iso9660なんて覚えてない。


 ブロックデバイスの情報（デバイス名や、UUID、ファイルシステムのタイプ）を
  表示するコマンドは？
  blkid
  →
  存在感ない。


ブロックデバイスをツリー状に一覧表示するコマンドは？
lsblk



   mountコマンドのオプションのうち、続けてマウントオプションを指定する為の
  オプションは？
  -o


「/etc/fstab」ファイルに記述するマウントオプションで、
  SUIDとSGIDを有効化するものは？
suid
→
sgidも有効になる模様


  ディレクトリ「dir1」をディレクトリ「dir2」にマウントしたい。下線部に入るオプションは？
  mount __________ dir1 dir2
--bind
→
参考書には乗っていないが、そういう物なのだろう。


  「/etc/fstab」ファイルに記述するマウントオプションで、
  一般ユーザによるマウントを禁止するものは？
nouser


 「/etc/fstab」ファイルを編集して、ext3ファイルシステムの「/dev/sda1」を
  システム起動時から「/boot」に自動マウントするよう設定したい。
  適切な記述は？(マウントオプションのアルファベット順に2つ)
  なお、「/dev/sda1」をdumpコマンドの対象とし、fsckは優先度を2とすること。
/dev/sda1 /boot ext3 auto 1 2
/dev/sda1 /boot exr3 defaults 1 2
→
defaultsは複数形であることに注意。


現在マウントされているファイルシステムの情報が格納されているファイルは？
/etc/mtab


  現在マウントされているxfs形式のファイルシステムを全てアンマウントしたい。
  適切なコマンドは？(オプションはアルファベット順にまとめて指定）
umount -at xfs
→
-a mtabに記述されているファイルシステムをすべてアンマウントする。


  以下のコマンドを実行して「/dev/sdb2」を「/data」にマウントした。
  「/dev/sdb2」を正しく（エラーの出ないように）アンマウントできるコマンドは？
  \# mount -t xfs /dev/sdb2 /data
  (ファイルシステムを指定しない方法とする。また引数が短い方から先に)
umount /data
umount /dev/sdb2

---

## ファイルのパーミッションと所有権の管理

 ファイルとディレクトリを新規作成した際のデフォルトのパーミッションを、
  それぞれ「600」と「700」にしたい。適切なコマンドは？
umask 077


  「dir」ディレクトリおよびその配下にあるファイルの所有グループを「gp」に変更したい。
  適切なコマンドは？(コマンドが長い方から先に2つ、「:」は使用しないこと)
chown -R .gp dir
chgrp -R gp dir
→
先にオプションを指定する。


  プログラム「file」をどのユーザが実行しても、プログラムの所有者の権限で実行させたい。
  なお、「file」のパーミッションは755である。適切なコマンドは？
  (パーミッションの指定には、1つ目は数値、2つ目は記号3文字を使用すること)
chmod 4755 file
chmod u+s file


 chmodコマンドを使用して記号でパーミッションを設定する際、
  スティッキービットを表す文字は？
t


 chmodコマンドを使用して記号でパーミッションを設定する際、
  SUIDまたはSGIDを表す文字は？
s


 以下の「dir」ディレクトリ配下に新規に作成するファイルやディレクトリの
  所有グループがstaffになるようにしたい。適切なコマンドは？
  (パーミッションの指定には、1つ目は数値、2つ目は記号3文字を使用すること)
  \# ls -ld dir
  drwxrwxr-x. 2 staff staff 4096 Mar 18 14:13 dir
chmod 2775 dir
chmod g+s dir
→
所有グループの指定にもsuidを使ったっけ？


 chmodコマンドを使用して記号でパーミッションを設定する際、
  権限を一度に指定する記号は？
=


  「dir」ディレクトリ内において、自分以外のユーザが所有するファイルを削除できないようにしたい。
  なお、「dir」ディレクトリのパーミッションは755である。適切なコマンドは？
  (パーミッションの指定には、1つ目は数値、2つ目は記号3文字を使用すること)
chmod 1755 dir
chmod o+t dir


  プログラム「file」をどのユーザが実行しても、プログラムを所有するグループの権限で実行させたい。
  なお、「file」のパーミッションは755である。適切なコマンドは？
  (パーミッションの指定には、1つ目は数値、2つ目は記号3文字を使用すること)
chmod 2755 dir
chmod g+s dir


「dir」ディレクトリおよびその配下にあるファイルのパーミッションを755に設定したい。
  適切なコマンドは？(パーミッションの指定には数値を使用すること)
chmod -R 755 dir


「dir」ディレクトリのパーミッションを700から500に変更したい。適切なコマンドは？
  (パーミッションを1つ目は数値、2つ目は-記号を用いて3文字、3つ目は=記号を用いて4文字で指定)
chmod 500 dir
chmod u-w dir
chmod u=rx


 「file」の所有ユーザをtestからstaffに、所有グループをtestからgpに変更したい。
  適切なコマンドは？(「:」を使用するほうから先に2つ)
chown staff:gp file
chown staff.gp file
→
スタッフとグループの間にスペースはいらない

---

## ハードリンクとシンボリックリンクの作成・変更

 「/home/dir」ディレクトリのシンボリックリンクを「/link」という名で作成したい。
  適切なコマンドは？
ln -s /home/dir /link


file1のハードリンクをfile2として作成したい。適切なコマンドは？
ln file1 file2

---

## システムファイルの検索、適切なファイル配置

  検索用データベースを使用して高速でファイル検索を行うコマンドは？
locate


 マニュアルページが格納されているディレクトリは？
/usr/share/man/


findコマンドでファイルを検索する際、検索結果を表示するアクションは？
-print


  指定したコマンド、またそのマニュアル、ソースコードが格納されている
  場所を検索し、絶対パスで表示するコマンドは？
whereis


  指定したコマンドが格納されている場所を、環境変数PATHで設定している
  ディレクトリから検索し、その場所を絶対パスで表示するコマンドは？
which


 全てのユーザが使用できるプログラムを作成した。そのプログラムはこのホストでのみ
  使用する。プログラムの設定ファイルを格納するディレクトリとして適切なものは？
/usr/local/etc
→
「このホスト」、ならlocal


  findコマンドの検索式で、
  シンボリックリンクを検索するものは？
-type l


  システムの起動には必須ではないコマンドの共有ライブラリが格納されているディレクトリは？
/usr/lib


  updatedbコマンドの設定ファイルは？
/etc/updatedb.conf


  全てのユーザが使用できるプログラムを作成した。そのプログラムはこのホストでのみ
  使用する。プログラムを格納するディレクトリとして適切なものは？
/usr/local/bin


  cpコマンドの場所を絶対パスで表示したい。適切なコマンドは？
  (コマンド全体が短い方から先に2つ)
which cp
whereis cp


findコマンドで「/home」ディレクトリ以下から、所有者が「test」ユーザの
  ファイルやディレクトリを検索したい。適切なコマンドは？
  (アクションは省略)
find /home -user test
→
先にディレクトリの指定が来る。それから検索式。


findコマンドで「httpd.conf」ファイルを「/etc」ディレクトリ以下から検索したい。適切なコマンドは？
  適切なコマンドは（アクションは省略）？
/find /etc -name httpd.conf


  findコマンドの検索式で、
  ファイルの所有者を条件として検索するものは？
-user


 findコマンドでカレントディレクトリ以下から、アクセス権が775のディレクトリを検索したい。
  適切なコマンドは？
  (検索式はファイルの種類から先に指定する事。アクションは省略)
find . -type d -perm 755


 findコマンドの検索式で、
  アクセス権を条件として検索するものは？
-perm


Linuxの標準的なディレクトリの構造を定めた規格のことを何というか？
  (アルファベットの大文字3文字で)
FHS


  findコマンドによる検索結果をNULL文字区切りで得るアクションは？
-print0


指定したコマンドが通常のコマンドか、シェルの組み込みコマンドか、
  エイリアスかなどの情報を表示するコマンドは？
type

---

## 2週目に間違った問題


---

## メモ

ストレージデバイスに対してパーティションを作成。
各パーティションにファイルシステムを作成。
作成したパーティションをマウントする。

lsblk
blkid

fdisk,gdisk,parted
mkfs,mke2fs,Btrfs,mkswap

df ディスクの空き容量
du ディスクの専有容量

fsck
e2fsck
tune2fs

mount
umount
/etc/fstab
中身の編集
マウントオプション

find
locate
updatedb
/tec/updatedb.conf
whitch
whereis
type


whichは絶対パス。
whereisはソースコードやマニュアルも表示する。
typeはコマンドに対して使う


find [ディレクトリ] [検索式]
検索式 説明

-name
-atime
-mtime
-perm
-size
-type
-user
-print マッチしたファイルの表示(省略可能)
-exec コマンド || \;
-ok コマンド || \;

/dataディレクトリ以下から過去1日以内に更新されたファイルを検索する
find /data -type f -mtime -1

/usr/binディレクトリ以下からSUIDが設定されたファイルを検索する
find /usr/bin -type f -perm -u+s

/tmpディレクトリ以下から所有者がstudentであるファイルやディレクトリを検索する
find /tmp -user student

カレントディレクトリ以下から30日を超える日数の間アクセスされていないファイルを検索して削除する。
find -atime + 30 -exec rm {} \;
