# バッチまとめ

---

## コメント

``` batch
rem [コメント]
: [コメント]
:: [コメント]
```

[バッチファイルでコメントを使用する](https://jj-blues.com/cms/wantto-usecommentout/)  

---

## コメントがエラーとなる

文字化けする環境

- バッチファイルの文字コードがUTF-8  
- 改行コードがCRLFになっている  
- 日本語のような全角文字が含まれている  

日本語版 Windows のコマンドプロンプトは Shift-JIS の文字コードを前提として動作させるようになっている模様。  
なので、多くの場合は、文字コードを UTF-8 に明示すれば正常に動作するようになる。  

■ **対処法1 文字コードをバッチ内で指定**

バッチの先頭に以下のコマンドを追記

`chcp 65001`

`chcp`コマンドはバッチファイルの文字コードを明示するコマンド。  
文字コードを明示した上で、後続の処理を実行させる。  

|コードページ番号|文字コード|
|---|---|
|65001 | UTF-8     |
|932   | Shift-JIS |
|1200  | UTF-16    |

■ **対処法2 remの内容をダブルクォーテーションで囲う**

``` batch
@echo off
chcp 65001
rem "あ"
rem "あ"
```

[UTF-8のバッチファイルが文字化けする時の対処3選](https://nayutari.com/batch-utf8)  

---

## for文内で変数を利用する場合の注意

forブロック内では基本的に変数は使えない。  
使いたい場合は遅延環境変数という仕組みを利用する。  
変数を使用する場合 `%` で囲うのではなく、 `!` で囲う。  

例 :  
× `%arg%`  
○ `!arg!`  

[batファイルでfor文内に変数を利用する場合の罠 | なたで日記](https://blog.natade.net/2018/10/06/windows-bat-%E9%81%85%E5%BB%B6%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0-for-if/)  

---

## 新しいターミナルを開いて、コンソールアプリを実行する

バッチをダブルクリックしたらコンソールアプリをターミナルを開いた状態で実行したい。  

コンソールアプリのexeはダブルクリックで起動した場合、すぐに閉じてしまうので、コマンドプロンプトからexe名を指定して実行した時のように実行させたい。  
exeの発行先が別にあるので、exeを発行するバッチの隣に実行バッチを置いて実行したかった。  

``` bat
@echo off

cd .\Bundle\win\
call cmd /k "Bundle.exe"
```

[コマンドプロンプト cmd - [新しいインスタンスを開始する]](https://www.k-tanaka.net/cmd/cmd.php)  
