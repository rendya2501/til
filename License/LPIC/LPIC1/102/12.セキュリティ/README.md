# 12.セキュリティ

- ホストレベルのセキュリティ  
- ユーザーに対するセキュリティ管理  
- OpenSSH  
- GnuPGによる暗号化  
- その他必要なコマンド  

``` txt : ホストレベルのセキュリティ
・スーパーサーバー :: サーバープログラムを管理するプログラム。
・xinetd           :: スーパーサーバデーモン。ネットワークからのリクエストを受け付けるデーモン。  
・inetd            :: xinetdの前身。TCP Wrapper必須。
・/etc/xinetd.conf :: xintedの全体的な設定を行うファイル。  
・/etc/xinted.d/   :: xinetdのサービスごとの設定ファイルを格納するディレクトリ。  
・socketユニット   :: systemdの動作するシステムで、スーパーサーバのように特定のサービス宛のネットワーク接続を監視する事ができるユニット。
・TCP Wrapper      :: システムに常駐する、外部からのTCP/IP接続のアクセス制御を行うプログラム。ホストのセキュリティ対策の基本となる。
・tcpd             :: TCP Wrapperのデーモン。
・/etc/hosts.allow :: TCPラッパーでアクセスを許可するホストを記述するファイル。
・/etc/hosts.deny  :: TCPラッパーでアクセスを拒否するホストを記述するファイル。
※「/etc/hosts.allow」と「/etc/hosts.deny」の変更は直ちに反映される。該当サービスへの新たなアクセスから適用される。既存の接続は切断出来ない。
・lsof             :: ファイルシステムやポートなど、システムのリソースを使用しているプロセスの情報を表示できるコマンド。
・nmap             :: ポートスキャンをするコマンド。
・fuser            :: システムの特定のリソースを使用中のプロセスを検索し、強制終了することのできるコマンド。

※/etc/init.d/ :: SysVinitの動作するシステムにおいて各種サービスの起動スクリプトを置くディレクトリ。
```

``` txt : ユーザーに対するセキュリティ管理
・/etc/nologin :: rootユーザ以外のユーザのログインを禁止するファイル。
・/etc/sudoers :: sudoコマンドの設定を行うファイル。
・/etc/shadow  :: シャドウパスワードやパスワードの有効期限に関する情報が記載されるファイル。
・chage        :: パスワードの有効期限の設定に特化したコマンド。詳細な設定や表示が可能。操作は「/etc/shadow」ファイルに反映される。
・passwd       :: ユーザーのパスワードを変更するコマンド。
・usermod      :: 既存のユーザーアカウントを変更するコマンド。
・su           :: 一時的に別のユーザーになるコマンド。
・sudo         :: 別のユーザーの権限でプログラムを実行するためのコマンド。
・visudo       :: /etc/sudoersを編集するコマンド。sudoコマンドの利用設定をするコマンド。
・ulimit       :: ユーザやシェルが利用できるリソースの制限を設定したり表示できるコマンド。
```

``` txt : OpenSSH
・SSH                      :: 暗号や認証の技術を利用して、安全にリモートコンピュータと通信するためのプロトコル。
・sshd                     :: SSHサーバーの機能を提供するデーモン。

SSHサーバー側の設定ファイル。
・/etc/ssh/sshd_config     :: sshの設定ファイル。
・/etc/ssh/ssh_host_rsa_key :: サーバーの秘密鍵ファイル。
・/etc/ssh/ssh_host_rsa_key.pub :: サーバーの公開鍵ファイル。
・~/.ssh/authorized_keys   :: ユーザーの公開鍵を登録しておくファイル。

SSHクライアント側の設定ファイル。
・/etc/ssh/ssh_config      :: sshの設定ファイル。
・/etc/ssh/ssh_known_hosts :: ローカルシステムの全ユーザーが利用するsshサーバーの公開鍵を格納するファイル。
・~/.ssh/id_rsa            :: ssh-keygenコマンドで生成された秘密鍵ファイル。
・~/.ssh/id_rsa.pub        :: ssh-keygenコマンドで生成された公開鍵ファイル。
・~/.ssh/known_hosts       :: サーバの公開鍵を登録しておくファイル。
・~/.ssh/config            :: SSH接続情報を格納するファイル。

・SSH認証                  :: クライアントがSSHでサーバへログインする際に行う一連の認証。(ホスト認証の後、ユーザー認証を行う)
・ホスト認証               :: クライアントがサーバーの正当性を確認するための認証。
・ユーザー認証             :: SSHクライアントで接続してくるユーザが正当なユーザかどうかを確認するための認証。
・共通鍵暗号方式           :: 暗号化と復号に共通の鍵を用いる方式。
・公開鍵暗号方式           :: 暗号化と復号は公開鍵と秘密鍵のペアによって行う方式。
・ssh                      :: SSHを使ってリモートホストにログインするためのコマンド。
・ssh-keygen               :: 公開鍵と秘密鍵の鍵ペアを作成するコマンド。
・scp                      :: SSHの仕組みを使い、ホスト間で安全にファイルをコピーするコマンド。
・ssh-agent                :: メモリ上に秘密鍵を保管しておく認証エージェント。及びそのコマンド。
※バックグラウンドで動作する。ssh-agentによって起動されたシェルでssh-addやsshコマンドを実行する。
※環境変数SSH_AUTH_SOCKとSSH_AGENT_PIDを利用する。
※ssh-agentはSSHサーバーと通信は行わない。ローカルプロセスであるsshとssh-addコマンドと通信する。
・ssh-add                  :: 認証エージェントであるssh-agentに秘密鍵を登録するコマンド。
・ﾎﾟｰﾄﾌｫﾜｰﾃﾞｨﾝｸﾞ           :: あるポートに送られてきたTCPパケットをSSHを使った安全な通信路を経由して、リモートホストの任意のポートに転送すること。
                              SSHクライアント to SSHサーバー  
・ﾘﾊﾞｰｽﾎﾟｰﾄﾌｫﾜｰﾃﾞｨﾝｸﾞ      :: SSHサーバが転送用ポートを用意し、SSHクライアントの指定されたポートに転送すること。
                              SSHサーバー to SSHクライアント
・X11ﾎﾟｰﾄﾌｫﾜｰﾃﾞｨﾝｸﾞ        :: ポートフォワーディングの機能を使って、ネットワークを介したXサーバ・クライアントの通信を暗号化し、接続を簡略化すること。
                              SSHサーバー to SSHクライアント with X11  
```

``` txt : GnuPGによる暗号化
・GnuPG     :: 公開鍵暗号方式を使って、ファイルの暗号化や復号をしたり、電子署名をしたりすることができるオープンソースソフトウェア。
・gpg-agent :: GnuPGにおいて秘密鍵を管理し、パスフレーズによる認証状態を一定期間キャッシュするデーモンプログラム。
・gpg       :: GnuPGを使ってファイルの暗号化や復号を行うコマンド。
・~/.gnupg/ :: GnuPGに関連するファイルの置かれるディレクトリ。
```

``` txt :その必要なコマンド
・/var/log/wtmp :: ユーザのログイン/ログアウト情報が記録されているバイナリファイル。
・/var/run/utmp :: ログイン中のユーザの情報が格納されているバイナリファイル。  
・last          :: 「/var/log/wtmp」ファイルを参照し、最近ログインしたユーザの一覧を表示するコマンド。
・w             :: 現在、システムに誰がログインしていて、何を実行しているのかを表示するコマンド。
・who           :: システムに誰がログインしているかを表示するコマンド。  
```

---

## 小豆本問題

### 1 ○

TCP Wrapperを使ってアクセス制御している。  
/etc/hosts.allow「sshd : 192.168.2.」  
/etc/hosts.deny「ALL:ALL」  
このことの説明。  

→  
B : 192.168.2.5のホストからSSH接続ができる。  

ホワイトリスト→ブラックリスト  
ホワイトリストに当てはまったら即OK。  
ホワイトリストに無かったらブラックリストを見る。  
ブラックリストにあったら即OUT。  

---

### 2 ×

/etc/nologinファイルを作成するとどうなるか？  

→  
C : /etc/nologinファイルに記述されたユーザーはログインできなくなる。  

A : 全てのユーザーはログイン出来なくなる。  
まじか。覚え間違えだったかな。  
ファイルを作って、その中でユーザーを指定するものだと思っていたのだが、勘違いだったようだ。  

空のファイルで良いが、メッセージを記述すると、ログインしたときのそのメッセージが表示されるらしい。  
なるほどね。  

---

### 3 ○

パスワードの有効期限を表示、設定するコマンドは？

→  
change  

---

### 4 ○

SSHを使って、ホストa.example.netに、ユーザーstudentとしてログインしたい。  
実行するコマンドは？  

→  
`ssh student@a.example.net`  
Eかな。  

正解。  
`ssh ログインユーザー名@ホスト名`  
ユーザー名を省略した場合、ローカルホストでSSHを実行したユーザーのユーザー名が指定されたことになる。  

---

### 5 ×

SSHを使ってリモートホストへ公開鍵認証でログインできるよう設定中。  
①接続先リモートホストのホームディレクトリ内に「.ssh」ディレクトリを作成。  
②その中に___ファイルを作成。そこに公開鍵をコピーして登録した。  
ファイル名は？  

→  
`~/.ssh/authorized_keys`  
なのでファイル名は`authorized_keys`  
登録元は？  

---

### 6 ○

GPGを使って暗号化されたファイルsecret.ascが送られてきた。  
送付元の公開鍵はすでに登録済み。  
復号のコマンドは？  

→  
`gpg secret.asc`  
ということでA  

当たった。  
