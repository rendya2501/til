# ディスプレイマネージャーの設定

---

## ディスプレイマネージャー  

ディスプレイマネージャはX Window Systemのプログラムの1つで、ランレベルが5の時にユーザにグラフィカルログイン画面（GUI環境のログイン）を提供します。  
SysVinitの場合は、initが起動する「prefdm（Preferred Display Manager）」が環境変数DISPLAYMANAGERを読み取って必要なディスプレイマネージャーが起動されます。  
systemdの場合は「display-manager.service」として起動されますが、これはgdmやkdmなど、使用するディスプレイマネージャーサービスへのシンボリックリンクとなっています。  
指定したディスプレイマネージャが起動すると、ユーザ名とパスワードを入力するログインプロンプトの認証画面が表示されます。  

・initやsystemdによりディスプレイマネージャーサービスが起動される  
・ユーザにGUI環境のログインを提供し、入力されたユーザー名とパスワードによりユーザー認証を行う。  
・ユーザー認証されると、ディスプレイマネージャーはユーザーのデスクトップ環境を起動する。  

GNOMEの場合はgnome-session。  
KDEの場合はstartkde。  

``` txt : 代表的なディスプレイマネージャー
XDM :: xorgX11で開発された標準のディスプレイマネージャー  
GDM :: GNOMEの標準ディスプレイマネージャー  
KDM :: KDEの標準ディスプレイマネージャー  
SDDM(Simple Desktop Display Manager) :: kdmの後継。KDE Plasmaの標準ディスプレイマネージャー  
LightDM :: Ubuntuの標準ディスプレイマネージャー  
```

---

## グラフィカルログインを有効にする方法

・ランレベルを5に設定する。
・CUI環境でstartxコマンドを実行する。
・systemdを採用したシステムの場合、[systemctl enable ○○.service]を実行する。
※例えばGNOMEの場合、○○はgdm.serviceとなる。

---

## ウィンドウマネージャー

ウィンドウの概観、アイコンやカーソル、メニューなどを提供するXクライアントのアプリケーションです。  
Xの外観を制御しているソフトウェア  
ウィンドウの外観、メニュー、アイコンなどを提供するXクライアント。  

代表例  
Kwin,Mutter,twm  

---

## 統合デスクトップ環境  

ウィンドウマネージャも含め、アプリケーションまで揃えて統一的な操作を提供したデスクトップ環境。  
それなりのCPUパワーや多くのメモリが必要。
代表例 : GNOME,KDE Plasma  

軽快なデスクトップ環境例 : Xfce,LXDE,MATE  

XfceはいつぞやWSLで採用したやつだし、MATEは職場の開発環境のアレだ。  

---

## Xfce(エックスエフシーイー)

ネズミのやつ。  
メモリやCPUの消費量が少ない軽量のデスクトップ環境。  
GNOMEうあKDEに比べて軽快に動作し、見た目もよく、使いやすい。  
元々XFormsツールキットをベースに開発されたので、XForms Common Environmentの頭文字が名前の由来。  
現在はGTK+2ツールキットを採用しているらしい。  

---

## KED(KDE Software Compilation)

デスクトップ環境KDE Plasma、ライブラリ、アプリケーションから構成される大規模なソフトウェア群。  
Qt(キュート)というGUIツールきっとをベースとして開発された。  

OpenSUSE,Slackware,Kubuntuで標準採用  
標準ディスプレイマネージャー : KDM  
ウィンドウマネージャー : KWin  

---

## GNOME(グノーム)

代表的な統合デスクトップ環境。  
RHEL,CentOS,Fedora,Ubuntuで標準採用。  
標準ディスプレイマネージャー : GDM  
ウィンドウマネージャー : Mutter  

---

## VDI(Virtual Desktop Infrastructure)

仮想デスクトップ環境のことです。  
VDIにアクセスするためにはVNC（Virtual Network Computing）のようなリモートデスクトップソフトウェアや、  
SPICE（Simple Protocol for Independent Computing Environments）のような画面転送プロトコルが必要になります。  

---

## VNC(Virtual Network Computing)

Windows,Linux,MaxOSなどクロスプラットフォーム対応のリモードデスクトップソフトウェア。  
RFB(Remote Frame Buffer)プロトコルにより、リモートマシンのグラフィカルデスクトップをローカルマシンのデスクトップ内で共有する。  
通信路にsshを使用する事でセキュリティを強化できる。  

デスクトップを提供する側でVNCサーバーを稼働させる。  
デスクトップを操作される側のコンピュータにVNCサーバを、操作する側のコンピュータにはVNCクライアントをインストールします。
「VNCサーバは仮想マシンのゲストOSにインストールする」ともいうらしい。  

VNCは各ゲストにインストールする。  
SPICEはホストにインストールする。  
仮想マシンへのリモートデスクトップ接続において、VNCは仮想マシンのゲストOS（仮想マシン上で動作するOS）にインストールしたVNCサーバがゲストOSの画面出力をキャプチャしてクライアントに送信する。  
対して、SPICEでは仮想マシンのホスト（仮想環境の土台）にインストールしたSPICEサーバが仮想マシンの画面出力をクライアントに送信して直接操作することができます。

VNCサーバー起動コマンド :: `vncserver :1`  
VNCサーバー終了コマンド :: `vncserver -kill :1`  
→「:1」はディスプレイ番号  

VNCサーバーソフトウェア :: tigervnc-server  
VNCクライアントソフトウェア :: vinagre  

---

## リモートデスクトップ

他のコンピュータのデスクトップ画面をネットワーク経由で遠隔から操作することをリモートデスクトップといいます。  

---

## RDP(Remote Desktop Protocol)

Windows標準のリモートデスクトップ機能で使用される通信プロトコル。  
Windows側でリモートデスクトップでのアクセスを許可する設定を行い、Linux側にRemminaやFreeRDPなどのリモートデスクトップクライアントをインスト－ルすれば、  
LinuxからWindowsのデスクトップを操作できるようになります。  

---

## SPICE(Simple Protocol for Independent Computing Environment)

RDPと同様の画面転送プロトコル。  
オープンソースで開発されている。  
VNCと異なり、通信の暗号化やマルチモニタなど、多数の機能に対応している。  
SPICEは4画面までのマルチモニタやネットワーク経由でのUSB転送など、VNCがサポートしていない多くの機能をサポートしています。  

仮想マシンへのリモートデスクトップ接続においても、VNCは仮想マシンのゲストOS（仮想マシン上で動作するOS）  
にインストールしたVNCサーバがゲストOSの画面出力をキャプチャしてクライアントに送信するのに対して、  
SPICEでは仮想マシンのホスト（仮想環境の土台）にインストールしたSPICEサーバが仮想マシンの画面出力をクライアントに送信して直接操作することができます。  

仮想マシンのコンソールをローカルホストの画面に表示するプロトコルでもあるらしい。  

---

## XDMCP(X Display Manager Control Protocol)

XサーバとXクライアント間を制御するプロトコルです。  
ディスプレイマネージャーをネットワーク越しに利用できるプロトコル。  
Xサーバーとディスプレイマネージャーの間で使われる。  
通信路が暗号化されないため、SSHを介して利用する必要がある。  

XDMCPを利用するXサーバー  
Xephyr,Xnest  

---

## 全体のまとめ

・ディスプレイマネージャ  
ランレベルが5の時にユーザにグラフィカルログイン画面（GUI環境のログイン）を提供し、ログイン認証、ログイン後のデスクトップ環境の準備を行います。  
XDM,GDM,KDM  

・ウィンドウマネージャ  
ウィンドウの概観、アイコンやカーソル、メニューなどを提供するXクライアントのアプリケーションです。  

・Xサーバ  
キーボードやディスプレイなどのハードウェアを管理するソフトウェアです。  

・統合デスクトップ環境  
ウィンドウマネージャも含め、アプリケーションまで揃えて統一的な操作を提供したデスクトップ環境。  
GNOME,KDE Plasma  

ヒエラルキー  
統合デスクトップ環境 > ディスプレイマネージャー、ウィンドウマネージャー > ディスプレイマネージャーXDMの仕組み(X11)
