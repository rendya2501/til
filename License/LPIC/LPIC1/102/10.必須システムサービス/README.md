# 10.必須システムサービス

- システムクロックの設定  
- システムログの設定  
- メール管理(メールシステム)  
- プリンタ管理  

``` txt : システムクロックの設定
・date :: システムクロックの参照や設定を行うコマンド。
※date [MMDDhhmm[CC[YY]][.ss]](MMは月、DDは日、hhは時、mmは分、CCは西暦の上2桁、YYは西暦の下2桁、ssは秒)
・hwclock :: ハードウェアクロックの参照や設定を行うコマンド。
・timedatectl :: systemdの動作するシステムにおいてシステム時刻の表示や設定を行うコマンド。
・ntpd :: NTPデーモン。NTPサーバー機能を提供する。
※自身をNTPサーバとすることで、指定したNTPサーバに定期的に時刻情報を問い合わせて自身の時刻を修正し、正確なシステムクロックを維持できます。
・/etc/ntp.conf :: ntpd（NTPサーバのデーモン）の設定ファイル。
・ntpdate          :: 手動でNTPサーバから正確な時刻を取得し、システムクロックに反映させるコマンド。NTPクライアントとしてのツール。
・ntpq             :: ntpdの時刻同期状況を確認するコマンド。[*]時刻同期先、[+]同期可能、[-]参照しない事が決定。[-p :: 時刻同期状況]
・Chrony(ｸﾛｰﾆｰ)    :: ntpdに代わるNTPサーバ/クライアント。
・chronyd          :: ntpdに代わるNTPサーバ/クライアントであるChronyのデーモン。
・/etc/chrony.conf :: Chronyの設定ファイル。
・iburstオプション :: 起動直後にNTPサーバに対して短い間隔で4回問い合わせることで時刻同期を速めるオプション。
・chronyc :: chronyd（chronyデーモン）の管理を行うコマンド。
・systemdのタイマーユニット :: 
・pool.ntp.org :: 複数のNTPサーバで構成させる仮想的なNTPサーバを、DNSラウンドロビン方式で提供するプロジェクト。
```

``` txt : システムログの設定
・syslog    :: ログメッセージを送受信する規格。
・rsyslog   :: syslogの問題点を克服した次世代のsyslog。主要なディストリビューションで採用されている。
・syslog-ng :: 次世代のsyslog2。
※次世代のsyslog :: rsyslog,syslog-ng
・/etc/syslog.conf  :: syslogに関する設定ファイル。
・/etc/rsyslog.conf :: rsyslogの設定ファイル。
・systemd-journald :: systemdの動作するシステムで、ユニットが出力するログを扱うデーモンプログラム。
・journalctl :: systemdの動作するシステムでsystemd-journaldのログを表示するコマンド。ログはバイナリ形式。
※syslogdがsystemd-journaldからsyslogを読み出すように設定する必要がある。
※rsyslogやsyslog-ngは、設定せずにsystemd-journaldから読み出せます。
※デフォルトではページャによる表示を行う
※ページャを無効にするには --no-pager オプションを指定する
・/etc/systemd/journald.conf :: sytemd-journaldの設定ファイル。
※「/run」ディレクトリはメモリ上に作成されたファイルシステム上のディレクトリのため、再起動するとデータが消えてしまいます。
・/var/log/journal/ :: journaldのログの格納ディレクトリ(不揮発性)(デフォルト)
・/run/log/journal/ :: journaldのログの格納ディレクトリ(揮発性)
・/run/log/journal/system.journal :: バイナリ形式のログが保存されるジャーナルファイル。

※前回の起動からシャットダウンまでのログを出力
/var/log/journal ディレクトリが存在する
journalctl -b -1
※アーカイブジャーナルの総容量が指定したサイズを下回るまで古いエントリを削除したい。
--vacuum-size
※指定した期間より古いアーカイブジャーナルを削除したい。
--vacuum-time
※journalctlコマンドでのログ出力において、新規に追加されたログをリアルタイムに表示させたい。
-f , --follow (tail -fと同様)
※sshd.service ユニットからのログのみを出力させたい
journalctl -u sshd.service
journalctl _SYSTEMD_UNIT=sshd.service

・systemd-cat :: 指定したコマンドの実行結果をジャーナルファイルに書き込むコマンド。ログメッセージを生成できるloggerコマンドと同様。
・logger      :: システムログに記録を追加するコマンド。
・logrotate   :: ログのローテーションを実行するコマンド。通常はcronによって定期的に実行される。
・/etc/logrotate.conf :: ログローテーションの設定ファイル。

・ファシリティ
auth,authpriv :: 認証システム(loginなど)による出力
cron          :: cronによる出力
deamon        :: 各種デーモンによる出力
kern          :: カーネルによる出力
lpr           :: 印刷システムによる出力
mail          :: メールサービス関連による出力
user          :: ユーザーアプリケーションによる出力
syslog        :: syslog機能
local0~local7 :: ローカルシステムの設定

・プライオリティ
emerg   :: 緊急事態
alert   :: 早急に対処が必要な事態
crit    :: システムの処理は継続できるものの深刻な事態
err     :: 一般的なエラー
warning :: 一般的な警告
notice  :: 一般的な通知
info    :: 一般的な情報
debug   :: デバッグ情報
none    :: ログを記録しない

・出力先
ファイル名        :: ファイルへの出力
ユーザー名        :: ユーザーの端末への出力
@ホスト名         :: リモートホストのsyslogへUDPで出力
@@ホスト名        :: リモートホストのsyslogへTCPで出力
/dev/tty1         :: コンソール(rrt1)に出力
/dev/console      :: コンソールへの出力
/var/log/messages :: ログファイルに出力
*                 :: ログイン中のすべてのユーザーの端末に出力
```

``` txt : メール管理(メールシステム)
・MTA(Message Transfer Agent)
メールの転送を行うプログラム。ネットワーク経由、またはサーバ内部（ローカル）のメール転送依頼に基づき、指定された宛先へメールを転送する。
メールサーバとして使用される。
・MDA(Mail Delivery Agent)
ローカルのメールスプールへ配送するプログラム。
MTAによってローカルの宛先へのメールであると判断されたメールを受け取り、宛先ユーザのメールボックス（メールスプール）へメールを配送する。
・MUA(Mail User Agent)
ユーザーがメールを扱うプログラム。自身のメールボックスへアクセスして受信したメールを閲覧したり、メールを送信したりする。
MUAの例としては、LinuxのmailコマンドやThunderbird、WindowsやMac OS X付属のメールソフトがある。

・sendmail :: 古くから使われるMTAで、様々なメール転送方式に対応している。
              1つのプログラムで全ての処理を実行できる反面、設定は難解で専用のツールを使う必要がある。  
              セキュリティ面での問題がたびたび発生したり、処理速度が遅いなどの問題もある。
・/var/spool/mail/   :: Sendmailのローカルユーザー宛のメールが格納されるディレクトリ
・/var/spool/mqueue/ :: Sendmailの転送することが出来なかったメールを置くデフォルトのキューディレクトリ

・Postfix :: sendmailとの高い互換性を保ちながら、処理速度を上げ、セキュリティも向上させている。
             設定が平易。最近の一部のLinuxディストリビューションの標準MTAにもなっている。
・/var/mail/                   :: Postfixのローカルユーザー宛のメールが格納されるディレクトリ
・/var/spool/postfix/deferred/ :: Postfixの転送することが出来なかったメールを置くデフォルトのキューディレクトリ

・exim :: Debian系の標準MTA。設定は平易だが、日本語の情報は比較的少ない。設定ファイルの内容はバージョンによって異なる。
・/var/mail/             :: Eximのローカルユーザー宛のメールが格納されるディレクトリ
・/var/spool/exim/input/ :: Eximの転送することが出来なかったメールを置くデフォルトのキューディレクト

・/etc/aliases :: sendmailでメールアドレスの別名を設定するファイル。
・newaliases   ::「/etc/aliases」を編集後、設定を反映させるためのコマンド。
・~/.forward   :: ユーザー個別でメールの転送先を記載するファイル。即時反映。
・sendmail :: 古くからあるMTAのsendmailでは、メール送信やMTAの制御のためにsendmailコマンドが用意されていました。
※引数無しで単独で実行すると、標準入力からメールのデータを受け取り、.(ピリオド)のみの行を受け取った時点でメールの送信を行います。
・mail  :: メールの送信や受信メールの確認を行うコマンド。オプションを付けずにコマンドを実行すると、[/var/spool/mail/]に格納されている受信メールを表示する。
・mailq :: 一般的なMTAにおいて、送信待ちのメールキューを一覧表示できるコマンド。
・オープンリレー :: 
```

``` txt : プリンタ管理
・CUPS(Common Unix Printing System)
これまで使われてきた「lpd」に代わる新しいWebブラウザベースの印刷システム。
ネットワーク上のプリンタをサポートするプロトコル「IPP（Internet Printing Protocol)」を採用している。
プリンタの機種依存情報を記述する「PPD（PostScript Printer Description）」ファイルをサポートしている。
Webブラウザベースで設定できる。
従来の印刷システム「lpd」との互換性を持っている。

・cupsd      :: UNIXの印刷サービスCUPSのデーモン。
・lpd        :: Linuxでこれまで長年利用されてきた印刷用のデーモン。
・/etc/cups/ :: UNIXの印刷サービスCUPSに関する設定ファイルが置かれるディレクトリ。
・/etc/cups/cupsd.conf    :: cupsdの設定ファイル。接続要求を受けるポート番号(デフォルトは631)や、接続するクライアントのアクセス制御などの設定を行う。
・/etc/cups/printers.conf :: プリンタに関する設定ファイル。
・/etc/printcap           :: レガシー印刷システムとの互換性を確保するため自動的に作られる設定ファイル。
・/var/spool/cups/        :: プリントスプールの場所。
・IPP(Internet Printing Protocol) :: CUPSのネットワーク上のプリンタをサポートするプロトコル。
・PPD(Postscript Printer Description) :: プリンタの機種依存情報を記述するファイル。

・lp     :: CUPSの標準的な印刷コマンド。印刷ジョブを生成し、プリントキューに登録するコマンド。
・cancel :: CUPSの標準的な印刷コマンド。プリントキューにある印刷ジョブを削除するコマンド。
・lpstat :: CUPSの標準的な印刷コマンド。プリントキューにある印刷ジョブを表示するコマンド。
・lpr    :: LPDと互換性のある印刷コマンド。レガシーな印刷システムであるLPDと互換性のある印刷コマンド。
・lprm   :: LPDと互換性のある印刷コマンド。プリントキューにある印刷ジョブを削除するコマンド。
・lpq    :: LPDと互換性のある印刷コマンド。プリントキューに登録されたジョブを一覧表示させるコマンド。
```

---

## 小豆本問題

---

### 1 ○

cronを使って自動的にバックアップを取るようにしている。  
バックアップファイル名にバックアップ日時が使われるにように死体場合、書式として適切なコマンドは？  

→  
D. ``tar czf /backup/date`date "+%Y%m%d"`.tar.gz /home``  

すげー。当たった。  
書式の設定はじめは「+」からだったような？ってのは合ってたみたいだ。  
tarのコマンドは知らん。xは回答だから違うとしとvとfの違いがわからない。  

cfz → create file zip  

---

### 2 ○

認証関連のメッセージで、プライオリティがnotice以上のものは/var/log/secureに保存されるようにしたい場合、/etc/rsyslog.confの書式として適切なものを選択せよ。  

→  
C.`authpriv.notice /var/log/secure`  

ファシリティ.プライオリティ 出力先  

---

### 3 ○

システムログファイル/var/log/messagesを常に監視して起き、新しいメッセージが書き込まれる様子を画面上でモニタリングし続けたい場合、  
どのコマンドを実行すればよいか？  

→  
B. `tail -f /var/log/messages`  

普通に考えて後に追加されたものを表示するからtailかなって思うけどね。  
tailコマンドの-fオプションはファイルの末尾を表示し続け、新たに書き込みがあればリアルタイムに画面に表示する。  

---

### 4 ○

Postfixを利用している。  
root宛のメールをユーザーuser01で受け取れるように設定するため、/etc/aliasesファイルを編集しましたが、メールが届きません。  
実行すべき操作は？  

→  
C.newaliasesコマンドを実行する。  

意外と覚えているものである。  

---

### 5 ○

jupitor.example.net上でstudentユーザーとして作業をしている。  
student@jupitor.example.netに届いたメールを、student@lpic.jpに転送するには~/___に「student@lpic.jp」と記述します。  
下線部のファイル名は？  

→  
.forward  

覚えているものである。  

---

### 6 ○

メールがメールキューに残っていないかを確認するためにあるコマンドを実行した。  
`$____`
mail queue is empty  

コマンドは？  

→  
mailq  

すげー。まじで覚えてるもんだな。  

---

### 7 ○

lprコマンドを使い、プリンタlaser01で、/etc/hpstsファイルを5部印刷したい場合、どのコマンドを実行すればよいか？  

→  
`lpr -# 5 -P laser01 /etc/hosts`  
なのでCですね。  
親切なことに#が入ってるのが1つしかないので、実質正解みたいなものだ。  

---

### 8 ○

プリントキューにある自分の印刷ジョブを全て削除したい場合、実行すべきコマンドは？  

→  
lprm -  

[-]は自分のジョブを消すオプションだったっけか。  
昨日の今日とは言え、全問正解はすごくないか？  
