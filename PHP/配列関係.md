# 配列関係メモ

---

## 連想配列をforeachするときにインデックスも欲しい

```php
$array = array( 
    'cat' => 'meow', 
    'dog' => 'woof', 
    'cow' => 'moo', 
    'computer' => 'beep' 
);

foreach( array_keys( $array ) as $index => $key ) {
    // display the current index + key + value
    echo 'index:' . $index . ' key:' . $key . ' value:' . $array[$key] . "\n";
}
// 結果
// index:0 key:cat value:meow
// index:1 key:dog value:woof
// index:2 key:cow value:moo
// index:3 key:computer value:beep
```

---

## 多重配列への追加

```php
$params['plans'][] = ['cat' => 'meow', 'dog' => 'woof'];
$params['plans'][] = ['cow' => 'moo','computer' => 'beep' ];
print_r($params);
print(json_encode($params));
// 結果
// {"plans":[{"cat":"meow","dog":"woof"},{"cow":"moo","computer":"beep"}]}
```

---

## 多次元配列をimplode()する最も簡単な方法

全部結果は同じ。でも案3が一番おすすめ。短くてわかりやすい。  

```php
$params = array (
  'plans' => 
  array (
    0 => 
    array (
      'linkage_plan_id' => '05539999950000020001',
      'is_searchable' => false,
    ),
    1 => 
    array (
      'linkage_plan_id' => '05539999950000020002',
      'is_searchable' => false,
    ),
  ),
);
// 案1
print(
    implode(
        ",",
        array_map(
            fn($el) => $el['linkage_plan_id'], 
            $params['plans']
        )
    )
);
// 案2
print(
    implode(
        ',',
        array_map(
            'implode',
            $params['plans'],
            array_fill(0, count($params['plans']),
            '')
        )
    )
);
// 案3
print(
    implode(
        ',',
        array_column($params['plans'], 'linkage_plan_id')
    )
);
```

---

## 多次元配列中の特定のキーを全て削除する方法

```php
$plan_params = array (
  'plans' => 
  array (
    0 => 
    array (
      'type' => 'regular',
      'linkage_plan_id' => '05539999950000020001',
      'basis_content' => 
      array (
        'name' => '4_伊藤テスト_連携改善_固定_1',
        'base_price' => 18400.0,
      )
    ),
    1 => 
    array (
      'type' => 'regular',
      'linkage_plan_id' => '05539999950000020002',
      'basis_content' => 
      array (
        'name' => '4_伊藤テスト_連携改善_固定_1',
        'base_price' => 18500.0,
      )
    ),
    2 => 
    array (
      'type' => 'regular',
      'linkage_plan_id' => '05539999950000020003',
      'basis_content' => 
      array (
        'name' => '4_伊藤テスト_連携改善_固定_1',
        'base_price' => 18600.0,
      )
    )
  ),
);

array_walk(
    $plan_params['plans'],
    function(&$v){
        unset($v['type']);
        unset($v['linkage_plan_id']);
        unset($v['basis_content']['name']);
    }
);
print_r($plan_params);
```

---

## 連想配列への追加の仕方

```php
 $plan_params = ['type' => 'regular'];
 $plan_params += ['type2' => 'regular'];
 
 print_r($plan_params);
// 結果:
//  Array
// (
//     [type] => regular
//     [type2] => regular
// )
```

---

## 4つの連想配列を4つの引き数を取る関数に渡したい(連想配列を分解せずに関数に渡して、渡した先で分解されてほしい)

<https://stackoverflow.com/questions/40663687/cannot-unpack-array-with-string-keys>  
[...]キーワードによる引数のアンパックなる仕組みを使う事で実現できる。  

GORAの開発中、idを4つの要素に分解して連想配列にしたとき、連想配列を分解しないで関数に渡す方法はないか調べた結果である。  
関数として4つも戻り値があるのはどうかという話もあったので連想配列にして1つとして返したってわけ。  

``` PHP
// 4つの引き数を受け取る関数
function getOpenPlanPrice($golf_code, $plan_code, $open_plan_code, $seq) {
    var_dump($golf_code);
    var_dump($plan_code);
    var_dump($open_plan_code);
    var_dump($seq);
}
// 4つの連想配列を返す関数
function rebateMainKeyFromLinkagePlanID($linkage_plan_id) {
    return [
        'golf_code' => (int)substr($linkage_plan_id, 0, 4),
        'plan_code' => (int)substr($linkage_plan_id, 4, 6),
        'open_plan_code' => (int)substr($linkage_plan_id, 10, 6),
        'seq' => (int)substr($linkage_plan_id, -4)
    ];
}
$linkage_plan_id = '05539999950000020005';

// [...]キーワードを引数の先頭に付ける
getOpenPlanPrice(...rebateMainKeyFromLinkagePlanID($linkage_plan_id));
// Ver7.0まではarray_valuesを挟む必要がある模様。
getOpenPlanPrice(...array_values(rebateMainKeyFromLinkagePlanID($linkage_plan_id)));
// call_user_func_arrayを使ってもいけるが、関数名を文字列指定するのは嫌だし、長いので使うことはないだろう。
// call_user_func_array(
//     'getOpenPlanPrice',
//     rebateMainKeyFromLinkagePlanID($linkage_plan_id)
// );
```

---

## array_null

後でちゃんとまとめる。  
多分Teelaやり始めたあたりで、連想配列のIndexにNullを指定したらどうなるかわからなかったので、試してみた内容だと思う。  
まぁ、普通にnullになるわなって感じ。  

``` php
<?php
// Your code here!
$te = array (
  '2020-08-01' => 
  array (
    1 => 
    array (
      0 => 
      array (
        'reception_start_at' => '2020-06-01 00:00:00',
        'reception_end_at' => '2020-06-30 00:50:00',
        'play_date_start' => '2020-08-01',
        'play_date_end' => '2020-08-01',
        'course_index' => '1',
        'start_time_start' => '07:00',
        'start_time_end' => '10:30',
        'content' => 
        array (
          'name' => '早割☆平日セルフ',
          'is_limited_period' => false,
          'is_auto_link' => true,
          'base_price' => 8900,
          'sales_tax' => 890.0,
          'golf_usage_tax' => 950,
          'other_tax' => 60,
          '2b_additional_fee' => 1500,
          '3b_additional_fee' => 0,
        ),
      ),
      1 => 
      array (
          'reception_start_at' => '2020-06-01 00:00:00',
          'reception_end_at' => '2020-06-30 00:50:00',
          'play_date_start' => '2020-08-01',
          'play_date_end' => '2020-08-01',
          'course_index' => '1',
          'start_time_start' => '10:00',
          'start_time_end' => '12:30',
          'content' => 
          array (
            'name' => '早割☆平日セルフ',
            'is_limited_period' => false,
            'is_auto_link' => true,
            'base_price' => 8900,
            'sales_tax' => 890.0,
            'golf_usage_tax' => 950,
            'other_tax' => 60,
            '2b_additional_fee' => 1500,
            '3b_additional_fee' => 0,
          ),
      ),
    ),
    2 => 
    array (
      0 => 
      array (
        'reception_start_at' => '2020-06-01 00:00:00',
        'reception_end_at' => '2020-06-30 00:50:00',
        'play_date_start' => '2020-08-01',
        'play_date_end' => '2020-08-01',
        'course_index' => '2',
        'start_time_start' => '07:00',
        'start_time_end' => '10:30',
        'content' => 
        array (
          'name' => '早割☆平日セルフ',
          'is_limited_period' => false,
          'is_auto_link' => true,
          'base_price' => 8900,
          'sales_tax' => 890.0,
          'golf_usage_tax' => 950,
          'other_tax' => 60,
          '2b_additional_fee' => 1500,
          '3b_additional_fee' => 0,
        ),
      ),
    ),
    'FeeInfo' => 
    array (
      '4BPrice' => 8900,
      'GolfUseTax' => 950,
      'OtherTax' => 60,
      'Tax' => 890.0,
    ),
  ),
  '2020-08-02' => 
  array (
    1 => 
    array (
      0 => 
      array (
        'reception_start_at' => '2020-06-01 00:00:00',
        'reception_end_at' => '2020-06-30 00:50:00',
        'play_date_start' => '2020-08-02',
        'play_date_end' => '2020-08-02',
        'course_index' => '1',
        'start_time_start' => '07:00',
        'start_time_end' => '10:30',
        'content' => 
        array (
          'name' => '早割☆平日セルフ',
          'is_limited_period' => false,
          'is_auto_link' => true,
          'base_price' => 8900,
          'sales_tax' => 890.0,
          'golf_usage_tax' => 950,
          'other_tax' => 60,
          '2b_additional_fee' => 1500,
          '3b_additional_fee' => 0,
        ),
      ),
    ),
    2 => 
    array (
      0 => 
      array (
        'reception_start_at' => '2020-06-01 00:00:00',
        'reception_end_at' => '2020-06-30 00:50:00',
        'play_date_start' => '2020-08-02',
        'play_date_end' => '2020-08-02',
        'course_index' => '2',
        'start_time_start' => '07:00',
        'start_time_end' => '10:30',
        'content' => 
        array (
          'name' => '早割☆平日セルフ',
          'is_limited_period' => false,
          'is_auto_link' => true,
          'base_price' => 8900,
          'sales_tax' => 890.0,
          'golf_usage_tax' => 950,
          'other_tax' => 60,
          '2b_additional_fee' => 1500,
          '3b_additional_fee' => 0,
        ),
      ),
    ),
    'FeeInfo' => 
    array (
      '4BPrice' => 8900,
      'GolfUseTax' => 950,
      'OtherTax' => 60,
      'Tax' => 890.0,
    ),
  ),
  );
  $te['2020-08-01'][1] = null;
  $te['2020-08-01'][2] = null;
  var_dump($te);
?>

array(2) {
  ["2020-08-01"]=>
  array(3) {
    [1]=>
    NULL
    [2]=>
    NULL
    ["FeeInfo"]=>
    array(4) {
      ["4BPrice"]=>
      int(8900)
      ["GolfUseTax"]=>
      int(950)
      ["OtherTax"]=>
      int(60)
      ["Tax"]=>
      float(890)
    }
  }
  ["2020-08-02"]=>
  array(3) {
    [1]=>
    array(1) {
      [0]=>
      array(8) {
        ["reception_start_at"]=>
        string(19) "2020-06-01 00:00:00"
        ["reception_end_at"]=>
        string(19) "2020-06-30 00:50:00"
        ["play_date_start"]=>
        string(10) "2020-08-02"
        ["play_date_end"]=>
        string(10) "2020-08-02"
        ["course_index"]=>
        string(1) "1"
        ["start_time_start"]=>
        string(5) "07:00"
        ["start_time_end"]=>
        string(5) "10:30"
        ["content"]=>
        array(9) {
          ["name"]=>
          string(24) "早割☆平日セルフ"
          ["is_limited_period"]=>
          bool(false)
          ["is_auto_link"]=>
          bool(true)
          ["base_price"]=>
          int(8900)
          ["sales_tax"]=>
          float(890)
          ["golf_usage_tax"]=>
          int(950)
          ["other_tax"]=>
          int(60)
          ["2b_additional_fee"]=>
          int(1500)
          ["3b_additional_fee"]=>
          int(0)
        }
      }
    }
    [2]=>
    array(1) {
      [0]=>
      array(8) {
        ["reception_start_at"]=>
        string(19) "2020-06-01 00:00:00"
        ["reception_end_at"]=>
        string(19) "2020-06-30 00:50:00"
        ["play_date_start"]=>
        string(10) "2020-08-02"
        ["play_date_end"]=>
        string(10) "2020-08-02"
        ["course_index"]=>
        string(1) "2"
        ["start_time_start"]=>
        string(5) "07:00"
        ["start_time_end"]=>
        string(5) "10:30"
        ["content"]=>
        array(9) {
          ["name"]=>
          string(24) "早割☆平日セルフ"
          ["is_limited_period"]=>
          bool(false)
          ["is_auto_link"]=>
          bool(true)
          ["base_price"]=>
          int(8900)
          ["sales_tax"]=>
          float(890)
          ["golf_usage_tax"]=>
          int(950)
          ["other_tax"]=>
          int(60)
          ["2b_additional_fee"]=>
          int(1500)
          ["3b_additional_fee"]=>
          int(0)
        }
      }
    }
    ["FeeInfo"]=>
    array(4) {
      ["4BPrice"]=>
      int(8900)
      ["GolfUseTax"]=>
      int(950)
      ["OtherTax"]=>
      int(60)
      ["Tax"]=>
      float(890)
    }
  }
}
```
