# じゃんけんプログラム

なぜあなたはJavaでオブジェクト指向開発ができないのか？のサンプル。  
コーディング試験対策として標準入力からのじゃんけんプログラムを作成する課題をやりたかったので、これを参考にした。  

自分が一番最初に作った形は、どちらかというと構造化プログラムみたいな形だった。  
思っているほどオブジェクト指向的なプログラミングができていないことが分かった。  
サンプルを頼りに実装していったら、最終的に細かいオブジェクトへの分割とインターフェースによる戦略の分割によって標準入力にまで対応できるようになった。  
これには目から鱗であった。  

## 共通域の定義

``` C# : HandEnum
    public enum HandEnum
    {
        STONE = 0,
        SCISSORS = 1,
        PAPER = 2
    }
```

``` C# : HandDictionary
    public static class HandDictionary
    {
        public static readonly Dictionary<HandEnum, string> HandDict = new Dictionary<HandEnum, string>()
        {
            { HandEnum.STONE,  "グー" },
            { HandEnum.SCISSORS, "チョキ" },
            { HandEnum.PAPER,  "パー" }
        };
    }
```

## 構造化プログラミング版

1つのクラス(モジュール)の中で完結した形。  
他のオブジェクトと連携するのではなく、内部の変数と関数だけで完結している。  
VB6でも組めるような感じがする。  
自分が一番最初に考えた形であり、機能を実現するだけならこれで十分だが、プレーヤーの名前を変えられないとか、プレーヤーを増やせないとか、拡張性がなさ過ぎて実務では使えないし、世の中から評価もされないだろう。  

``` C#
using System;
using System.Linq;

namespace janken
{
    /// <summary>
    /// 構造化プログラミング版じゃんけん
    /// </summary>
    public class StructuredJanken
    {
        private int Player1WonCount { get; set; }
        private int Player2WonCount { get; set; }
        private static readonly Random Random = new Random();

        public void Execute()
        {
            Console.WriteLine("【じゃんけん開始】" + Environment.NewLine);

            for (int i = 0; i < 3; i++)
            {
                Console.WriteLine($"【{i + 1:D} 回戦目】");
                // 手を決める
                HandEnum player1Hand = GetHand();
                HandEnum player2Hand = GetHand();
                Console.WriteLine($"{HandDictionary.HandDict.FirstOrDefault(f => f.Key == player1Hand).Value} vs. {HandDictionary.HandDict.FirstOrDefault(f => f.Key == player2Hand).Value}");
                // 判定
                JudgAndCount(player1Hand, player2Hand);
            }

            Console.WriteLine("【じゃんけん終了】" + Environment.NewLine);

            // 最終判定
            LastJudg();
        }

        public HandEnum GetHand()
        {
            int randNum = new Random(Random.Next()).Next(3);
            switch (randNum)
            {
                case 0:
                    return HandEnum.STONE;
                case 1:
                    return HandEnum.SCISSORS;
                case 2:
                    return HandEnum.PAPER;
            }
            return HandEnum.STONE;
        }

        private void JudgAndCount(HandEnum player1, HandEnum player2)
        {
            // P1が勝つ手
            if ((player1 == HandEnum.STONE && player2 == HandEnum.SCISSORS)
                || (player1 == HandEnum.SCISSORS && player2 == HandEnum.PAPER)
                || (player1 == HandEnum.PAPER && player2 == HandEnum.STONE))
            {
                Player1WonCount++;
                Console.WriteLine("プレイヤー1が勝ちました。" + Environment.NewLine);
            }
            // P2が勝つ手
            else if ((player2 == HandEnum.STONE && player1 == HandEnum.SCISSORS)
                || (player2 == HandEnum.SCISSORS && player1 == HandEnum.PAPER)
                || (player2 == HandEnum.PAPER && player1 == HandEnum.STONE))
            {
                Player2WonCount++;
                Console.WriteLine("プレイヤー2が勝ちました。" + Environment.NewLine);
            }
            else
            {
                Console.WriteLine("引き分けです。" + Environment.NewLine);
            }
        }

        private void LastJudg()
        {
            // P1の勝ち
            if (Player1WonCount > Player2WonCount)
            {
                Console.WriteLine($"{Player1WonCount}対{Player2WonCount}でプレイヤー1の勝ちです。");
            }
            // P2の勝ち
            else if (Player1WonCount < Player2WonCount)
            {
                Console.WriteLine($"{Player1WonCount}対{Player2WonCount}でプレイヤー2の勝ちです。");
            }
            else
            {
                Console.WriteLine($"{Player1WonCount}対{Player2WonCount}で引き分けです。" + Environment.NewLine);
            }
        }
    }
}
```

---

## オブジェクト指向プログラミング版

じゃんけんは判定する人と手を出す人に分けることができるので、それぞれをクラスとして抽出して実装した形。  
最低限のオブジェクト指向の実現と行ったところ。  
最低でもここまで考えられるようにしたいところ。  

``` C#
using System;
using System.Linq;

namespace janken
{
    /// <summary>
    /// オブジェクト指向プログラミング版じゃんけん
    /// </summary>
    public class ObjectiveJanken
    {
        public void Execute()
        {
            // 審判もプレーヤーも知っている事ならさらに上に出さないといけないのでやっぱりEnum参照が正解だ。
            // プレーヤーだけに定義すべきモノではない。
            Judge judge = new Judge();
            Player player1 = new Player("村田さん");
            Player player2 = new Player("山田さん");
            judge.StartJanken(player1, player2);
            Console.ReadLine();
        }

        /// <summary>
        /// じゃんけんの判定を表すクラス
        /// </summary>
        private class Judge
        {
            private static Random random = new Random();

            /// <summary>
            /// じゃんけんを開始する
            /// </summary>
            /// <param name="player1"></param>
            /// <param name="player2"></param>
            public void StartJanken(Player player1, Player player2)
            {
                Console.WriteLine("【じゃんけん開始】" + Environment.NewLine);

                for (int i = 0; i < 3; i++)
                {
                    Console.WriteLine($"【{i + 1:D} 回戦目】");
                    Player winner = JudgeJanken(player1, player2);
                    if (winner != null)
                    {
                        Console.WriteLine($"{winner.Name}が勝ちました。" + Environment.NewLine);
                        winner.NotifyResult(true);
                    }
                    else
                    {
                        Console.WriteLine("引き分けです。" + Environment.NewLine);
                    }
                }

                Console.WriteLine("【じゃんけん終了】" + Environment.NewLine);

                Player finalWinner = JudgeFinalWinner(player1, player2);
                if (finalWinner != null)
                {
                    Console.WriteLine($"{finalWinner.Name}の勝ちです。" + Environment.NewLine);
                }
                else
                {
                    Console.WriteLine("引き分けです。" + Environment.NewLine);
                }
            }

            /// <summary>
            /// 「じゃんけんポン」と声をかけ、プレイヤーの手を見て、どちらが勝ちかを判定する。
            /// </summary>
            /// <param name="player1"></param>
            /// <param name="player2"></param>
            /// <returns></returns>
            private Player JudgeJanken(Player player1, Player player2)
            {
                HandEnum player1hand = player1.ShowHand(new Random(random.Next()));
                HandEnum player2hand = player2.ShowHand(new Random(random.Next()));
                Console.WriteLine($"{HandDictionary.HandDict.FirstOrDefault(f => f.Key == player1hand).Value} vs. {HandDictionary.HandDict.FirstOrDefault(f => f.Key == player2hand).Value}");

                Player winner = null;
                if ((player1hand == HandEnum.STONE && player2hand == HandEnum.SCISSORS)
                    || (player1hand == HandEnum.SCISSORS && player2hand == HandEnum.PAPER)
                    || (player1hand == HandEnum.PAPER && player2hand == HandEnum.STONE))
                {
                    winner = player1;
                }
                else if ((player1hand == HandEnum.STONE && player2hand == HandEnum.PAPER)
                    || (player1hand == HandEnum.SCISSORS && player2hand == HandEnum.STONE)
                    || (player1hand == HandEnum.PAPER && player2hand == HandEnum.SCISSORS))
                {
                    winner = player2;
                }

                return winner;
            }

            /// <summary>
            /// 
            /// </summary>
            /// <param name="player1"></param>
            /// <param name="player2"></param>
            /// <returns></returns>
            private Player JudgeFinalWinner(Player player1, Player player2)
            {
                Player winner = null;
                if (player1.WinCount > player2.WinCount)
                {
                    winner = player1;
                }
                else if (player1.WinCount < player2.WinCount)
                {
                    winner = player2;
                }
                return winner;
            }
        }

        /// <summary>
        /// じゃんけんプレーヤークラス
        /// </summary>
        private class Player
        {
            public string Name { get; private set; }
            public int WinCount { get; private set; } = 0;

            /// <summary>
            /// コンストラクタ
            /// </summary>
            /// <param name="Name"></param>
            public Player(string Name)
            {
                this.Name = Name;
            }

            /// <summary>
            /// じゃんけんの手を出す
            /// </summary>
            /// <returns></returns>
            public HandEnum ShowHand(Random rand)
            {
                HandEnum hand = HandEnum.STONE;
                switch (rand.Next(3))
                {
                    case 0:
                        hand = HandEnum.STONE;
                        break;
                    case 1:
                        hand = HandEnum.SCISSORS;
                        break;
                    case 2:
                        hand = HandEnum.PAPER;
                        break;
                }
                return hand;
            }

            /// <summary>
            /// 審判から勝敗を聞く
            /// </summary>
            /// <param name="result"></param>
            public void NotifyResult(bool result)
            {
                if (result)
                {
                    WinCount++;
                }
            }
        }
    }
}
```

---

## オブジェクト指向 + 戦略の切り出し

ずっとグーを出すとか、バランスよく出すといった、戦略をインターフェースとして切り出したサンプル。  
何気にいいDIサンプルでもある。  
当初の目標である標準入力もクリアできる。  
これこそオブジェクト指向と行った感じである。  

``` C#
using System;
using System.Linq;

namespace janken
{
    /// <summary>
    /// オブジェクト指向プログラミング版じゃんけん
    /// </summary>
    public class ObjectiveJanken
    {
        public void Execute()
        {
            Judge judge = new Judge();
            Player player1 = new Player("itou", new BasicInputTactics());
            Player player2 = new Player("山田さん", new StoneOnlyTactics());
            judge.StartJanken(player1, player2);
            Console.ReadLine();
        }

        /// <summary>
        /// じゃんけんの判定を表すクラス
        /// </summary>
        private class Judge
        {
            /// <summary>
            /// じゃんけんを開始する
            /// </summary>
            /// <param name="player1"></param>
            /// <param name="player2"></param>
            public void StartJanken(Player player1, Player player2)
            {
                Console.WriteLine("【じゃんけん開始】" + Environment.NewLine);

                for (int i = 0; i < 3; i++)
                {
                    Console.WriteLine($"【{i + 1:D} 回戦目】");
                    Player winner = JudgeJanken(player1, player2);
                    if (winner != null)
                    {
                        Console.WriteLine($"{winner.Name}が勝ちました。" + Environment.NewLine);
                        winner.NotifyResult();
                    }
                    else
                    {
                        Console.WriteLine("引き分けです。" + Environment.NewLine);
                    }
                }

                Console.WriteLine("【じゃんけん終了】" + Environment.NewLine);

                Player finalWinner = JudgeFinalWinner(player1, player2);
                if (finalWinner != null)
                {
                    Console.WriteLine($"{finalWinner.Name}の勝ちです。" + Environment.NewLine);
                }
                else
                {
                    Console.WriteLine("引き分けです。" + Environment.NewLine);
                }
            }

            /// <summary>
            /// 「じゃんけんポン」と声をかけ、プレイヤーの手を見て、どちらが勝ちかを判定する。
            /// </summary>
            /// <param name="player1"></param>
            /// <param name="player2"></param>
            /// <returns></returns>
            private Player JudgeJanken(Player player1, Player player2)
            {
                HandEnum player1hand = player1.ShowHand();
                HandEnum player2hand = player2.ShowHand();
                Console.WriteLine($"{HandDictionary.HandDict.FirstOrDefault(f => f.Key == player1hand).Value} vs. {HandDictionary.HandDict.FirstOrDefault(f => f.Key == player2hand).Value}");

                Player winner = null;
                if ((player1hand == HandEnum.STONE && player2hand == HandEnum.SCISSORS)
                    || (player1hand == HandEnum.SCISSORS && player2hand == HandEnum.PAPER)
                    || (player1hand == HandEnum.PAPER && player2hand == HandEnum.STONE))
                {
                    winner = player1;
                }
                else if ((player1hand == HandEnum.STONE && player2hand == HandEnum.PAPER)
                    || (player1hand == HandEnum.SCISSORS && player2hand == HandEnum.STONE)
                    || (player1hand == HandEnum.PAPER && player2hand == HandEnum.SCISSORS))
                {
                    winner = player2;
                }

                return winner;
            }

            /// <summary>
            /// 
            /// </summary>
            /// <param name="player1"></param>
            /// <param name="player2"></param>
            /// <returns></returns>
            private Player JudgeFinalWinner(Player player1, Player player2)
            {
                Player winner = null;
                if (player1.WinCount > player2.WinCount)
                {
                    winner = player1;
                }
                else if (player1.WinCount < player2.WinCount)
                {
                    winner = player2;
                }
                return winner;
            }
        }

        /// <summary>
        /// じゃんけんプレーヤークラス
        /// </summary>
        private class Player
        {
            public string Name { get; private set; }
            public int WinCount { get; private set; } = 0;
            private readonly ITactics tactics;

            /// <summary>
            /// コンストラクタ
            /// </summary>
            /// <param name="Name"></param>
            public Player(string Name, ITactics tactics)
            {
                this.Name = Name;
                this.tactics = tactics;
            }

            /// <summary>
            /// じゃんけんの手を出す
            /// </summary>
            /// <returns></returns>
            public HandEnum ShowHand()
            {
                return tactics.ReadTactics();
            }

            /// <summary>
            /// 審判から勝敗を聞く
            /// </summary>
            /// <param name="result"></param>
            public void NotifyResult()
            {
                WinCount++;
            }
        }
    }


    /// <summary>
    /// ランダムに手を出す
    /// </summary>
    public class RandomTactics : ITactics
    {
        private static readonly Random Random = new Random();
        public HandEnum ReadTactics()
        {
            HandEnum hand = 0;
            switch (Random.Next(3))
            {
                case 0:
                    hand = HandEnum.STONE;
                    break;
                case 1:
                    hand = HandEnum.SCISSORS;
                    break;
                case 2:
                    hand = HandEnum.PAPER;
                    break;
            }
            return hand;
        }
    }

    /// <summary>
    /// グーしか出さない
    /// </summary>
    public class StoneOnlyTactics : ITactics
    {
        public HandEnum ReadTactics()
        {
            return HandEnum.STONE;
        }
    }

    /// <summary>
    /// 標準入力
    /// </summary>
    public class BasicInputTactics : ITactics
    {
        public HandEnum ReadTactics()
        {
            Console.WriteLine("手を入力してください。");
            Console.WriteLine("0 : グー");
            Console.WriteLine("1 : チョキ");
            Console.WriteLine("2 : パー");
            Console.Write("? : ");

            HandEnum player1hand;
            while (true)
            {
                if (Enum.TryParse(Console.ReadLine(), out player1hand) && Enum.IsDefined(typeof(HandEnum), player1hand))
                {
                    break;
                }
                else
                {
                    Console.WriteLine("0,1,2 のいずれかを入力してください。");
                    Console.Write("? : ");
                }
            }
            return player1hand;
        }
    }

    /// <summary>
    /// じゃんけん戦略インターフェース
    /// </summary>
    public interface ITactics
    {
        /// <summary>
        /// 戦略を読み、じゃんけんの手を得る
        /// グー、チョキ、パーのいずれかをplayerクラスに定義された以下の定数で返す。
        /// </summary>
        /// <returns></returns>
        HandEnum ReadTactics();
    }
}
```

---

## 標準入力からのじゃんけん

オブジェクト指向の基本形ができた後に組んで見たやつ。  
今見ると、がっつりクラスの中を書き換えており、標準入力以外では使えない形になってしまっている。  
戦略自体をインターフェースを切り出せるサンプルをやった後だと、この組み方でさえいまいちに感じる。  
SOLID原則の一つである、クラスの中身自体を書き換えてはならない原則に反しているので、これはオブジェクト指向のアンチパターンと言えるだろう。  

``` C#
using System;
using System.Linq;

namespace janken
{
    /// <summary>
    /// オブジェクト指向プログラミング版じゃんけん
    /// </summary>
    public class BasicInputJanken
    {
        public void Execute()
        {
            Console.WriteLine("名前を入力してください。");
            var playerName = Console.ReadLine();

            Judge judge = new Judge();
            Player player1 = new Player(playerName);
            Player player2 = new Player("山田さん");
            judge.StartJanken(player1, player2);
            Console.ReadLine();
        }

        /// <summary>
        /// じゃんけんの判定を表すクラス
        /// </summary>
        private class Judge
        {
            private static Random Random = new Random();

            /// <summary>
            /// じゃんけんを開始する
            /// </summary>
            /// <param name="player1"></param>
            /// <param name="player2"></param>
            public void StartJanken(Player player1, Player player2)
            {
                Console.WriteLine("【じゃんけん開始】" + Environment.NewLine);

                for (int i = 0; i < 3; i++)
                {
                    Console.WriteLine($"【{i + 1:D} 回戦目】");
                    Player winner = JudgeJanken(player1, player2);
                    if (winner != null)
                    {
                        Console.WriteLine($"{winner.Name}が勝ちました。" + Environment.NewLine);
                        winner.NotifyResult(true);
                    }
                    else
                    {
                        Console.WriteLine("引き分けです。" + Environment.NewLine);
                    }
                }

                Console.WriteLine("【じゃんけん終了】" + Environment.NewLine);

                Player finalWinner = JudgeFinalWinner(player1, player2);
                if (finalWinner != null)
                {
                    Console.WriteLine($"{finalWinner.Name}の勝ちです。" + Environment.NewLine);
                }
                else
                {
                    Console.WriteLine("引き分けです。" + Environment.NewLine);
                }
            }

            /// <summary>
            /// 「じゃんけんポン」と声をかけ、プレイヤーの手を見て、どちらが勝ちかを判定する。
            /// </summary>
            /// <param name="player1"></param>
            /// <param name="player2"></param>
            /// <returns></returns>
            private Player JudgeJanken(Player player1, Player player2)
            {
                Console.WriteLine("手を入力してください。");
                Console.WriteLine("0 : グー");
                Console.WriteLine("1 : チョキ");
                Console.WriteLine("2 : パー");
                Enum.TryParse(Console.ReadLine(), out HandEnum playerHand);
                HandEnum player1hand = playerHand;
                HandEnum player2hand = player2.ShowHand(new Random(Random.Next()));
                Console.WriteLine($"{HandDictionary.HandDict.FirstOrDefault(f => f.Key == player1hand).Value} vs. {HandDictionary.HandDict.FirstOrDefault(f => f.Key == player2hand).Value}");

                Player winner = null;
                if ((player1hand == HandEnum.STONE && player2hand == HandEnum.SCISSORS)
                    || (player1hand == HandEnum.SCISSORS && player2hand == HandEnum.PAPER)
                    || (player1hand == HandEnum.PAPER && player2hand == HandEnum.STONE))
                {
                    winner = player1;
                }
                else if ((player1hand == HandEnum.STONE && player2hand == HandEnum.PAPER)
                    || (player1hand == HandEnum.SCISSORS && player2hand == HandEnum.STONE)
                    || (player1hand == HandEnum.PAPER && player2hand == HandEnum.SCISSORS))
                {
                    winner = player2;
                }

                return winner;
            }

            /// <summary>
            /// 
            /// </summary>
            /// <param name="player1"></param>
            /// <param name="player2"></param>
            /// <returns></returns>
            private Player JudgeFinalWinner(Player player1, Player player2)
            {
                Player winner = null;
                if (player1.WinCount > player2.WinCount)
                {
                    winner = player1;
                }
                else if (player1.WinCount < player2.WinCount)
                {
                    winner = player2;
                }
                return winner;
            }
        }

        /// <summary>
        /// じゃんけんプレーヤークラス
        /// </summary>
        private class Player
        {
            public string Name { get; private set; }
            public int WinCount { get; private set; } = 0;

            /// <summary>
            /// コンストラクタ
            /// </summary>
            /// <param name="Name"></param>
            public Player(string Name)
            {
                this.Name = Name;
            }

            /// <summary>
            /// じゃんけんの手を出す
            /// </summary>
            /// <returns></returns>
            public HandEnum ShowHand(Random rand)
            {
                HandEnum hand = 0;
                switch (rand.Next(3))
                {
                    case 0:
                        hand = HandEnum.STONE;
                        break;
                    case 1:
                        hand = HandEnum.SCISSORS;
                        break;
                    case 2:
                        hand = HandEnum.PAPER;
                        break;
                }
                return hand;
            }

            /// <summary>
            /// 審判から勝敗を聞く
            /// </summary>
            /// <param name="result"></param>
            public void NotifyResult(bool result)
            {
                if (result)
                {
                    WinCount++;
                }
            }
        }
    }
}
```
