# 速度

---

## group by vs distinct

distinctはインデックスの影響を受けるが、group byは受けないので安定しているとか。  
そもそも両者は結局ほぼ同じになるとか。  

distinctは専用命令なのにgroup byは副作用で重複が削除されているだけ。  
専用命令としてdistinctが用意されているのだから早いに決まっているし、そうじゃなければ存在価値がないという意見。  

ざっと調べてみたが、わからん。  
インデックスやバージョンにもよるっぽいが、そういうのも含めてgroup byのほうに軍配が上がる記事が多い印象。  
ただ、重複を削除するなら専用命令であるDISTINCTのほうが可読性はいい。  
そういう使い分けで良いのではなかろうか？  

[【SQL入門】group by,distinctどちらが性能がよいのか](https://forse.hatenablog.com/entry/2014/03/13/204259)  

### DISTINCTが早い派

[SQL distinctとgroup byの実行計画が全く同じなのに大きな速度差が出る](https://style.potepan.com/articles/22702.html)  

### 違いはない派

>GROUP BYとDISTINCTの実行プランはほぼ同じです。  
[SQLパフォーマンス：SELECT DISTINCTとGROUP BY](https://www.web-dev-qa-db-ja.com/ja/sql/sql%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%EF%BC%9Aselect-distinct%E3%81%A8group-by/1070117836/)  

<!--  -->
>検証結果としましては、実行計画は全く同じで実行速度もほぼ同じ結果となりました。
[DISTINCT vs GROUP BY](https://devblog.thebase.in/entry/2021/12/19/110000)  

### DISTICTよりEXISTS派

>DISTINCT句よりEXISTS句の使用を検討する  
DISTINCTは、条件に一致するレコードを取り出し暗黙のソート処理後に重複レコードを排除することに対し、EXISTS句は条件に一致するレコード１件でもあればそこで処理は終了する為、暗黙のソート処理をしない分、DISTINCTに比べると負荷が小さくなる  
[忘れっぽいエンジニアのオラクルSQLリファレンス](http://oracle.se-free.com/tuning/B1_sql3.html#distinct)  

→  
多分これはない。  
条件に一致するまで検索するので、EXISTSの平均は「(1+N)/2」。  
早い段階で見つかればそれで処理終了だが、見つからない場合は全件捜査することになる。  
EXISTSとINNER JOINであれば、JOINに軍配が上がる記事も多い。  
アイデアとしては面白いが普通にDISTINCTを使ったほうが良い。  

[基礎から理解するデータベースのしくみ](https://xtech.nikkei.com/it/article/COLUMN/20060111/227105/)  

### アンチパターン サブクエリでDISTINCT

これは明確に遅くなる模様。  
今回の場合に関しては純粋な速度なので、ちょっと違うが、後学のために残しておく。  

[SQLのパフォーマンス的にNG集](http://db2.blog.jp/archives/73952121.html)  

---

## IN vs EXISTS vs INNER JOIN

INNER JOIN > EXISTS > IN

>以上のことから、SQL Server では IN 句と EXISTS 句の実行速度に違いがないことが分かりました。  
キャッシュの有無で実行速度に違いはあり、実行する度に経過時間は変化しますが、どちらもおおよそ22秒に収束する事、実行計画（実行プラン）が同じことからも、同じ処理がなされていますので、同じ実行時間となると考えられます。
>
>ただし、他の RDB では同じような実行結果にはなりませんので、IN 句自体の使用は控えておくと DB が変更になってもスムーズに開発や移行ができると思いますので、私自身としましては、EXISTS 句を使用することをお勧めしたいと思います。
また、INNER JOIN では Merge Join にコストがかかるようになっており、実行計画に若干の違いが見受けられます。最速なのはやはり INNER JOIN ですね。
それぞれ、開発の状況に応じて使い分けをする必要があると思いますが、なるべく INNER JOIN > EXISTS > IN の優先順位で使用したいですね。
[IN 句と EXISTS 句で実行速度が速いのはどちらの方か検証してみました | SQL Server](https://itblogdsi.blog.fc2.com/blog-entry-406.html)

[INとEXISTS速度の違い](https://struggling-engineer.com/in-or-exists/)  
