# LIKE

## 概要

LIKE演算子は文字データをワイルドカード検索(あいまい検索やキーワード検索)できる演算子。  

---

## ワイルドカード

- `_` : 任意の1文字  
- `%` : 0文字以上の任意の文字列  

---

## 前方一致検索 (Prefix Search)

「田%」のように最後に「%」を付ければ、先頭が「田」で始まる社員を取得できるようになる。  
このような先頭の文字を指定した検索は「前方一致検索」とも呼ばれている。  

``` sql
SELECT * FROM 社員
WHERE 氏名 LIKE '田%'
```

---

## キーワード検索

特定のキーワードを含んだ文字データの検索。
例えば、氏名に「田」というキーワードを含んだ社員を検索したい場合は次のように記述する。  

``` sql
SELECT * FROM 社員
WHERE 氏名 LIKE '%田%'
```

---

## キーワードが2つ以上ある場合

**LIKE演算子はIN演算子と組み合わせることができない**ため、キーワードが複数ある場合には、条件式を複数記述しなければならない。  

``` sql
SELECT * FROM 社員
WHERE 氏名 LIKE '%田%'
OR 氏名 LIKE '%郎%'
```

---

## パフォーマンス

先頭に「%」を使ったLIKE検索はパフォーマンスが悪いので、多用しないように注意する必要がある。  
特に、ORを使ってキーワードが複数ある場合には、キーボードが増えるほど比例的にパフォーマンスが悪くなる。  
なお、先頭に%を利用せずに、文字を指定したLIKE検索(前方一致検索)の場合には、インデックスを作成することで、パフォーマンス良く検索できるようになる。  

---

## 単一引用符「'」は「''」にする

商品データを格納するテーブルの中に「Guru's Guide」という商品が存在し、これを"`Guru's`"というキーワードで検索したい場合があるとする。  
しかし、単一引用符「'」は、文字データや日付データを囲むためのモノなので、そのまま記述するとエラーになる。  

単一引用符を検索文字の一部として扱いたい場合は、単一引用符を2つ「`''`」に変更する。  

``` sql
SELECT * FROM 商品
WHERE 商品名 LIKE '%Guru''s%'
```

---

## 「_」や「%」が入った文字をLIKEで検索する

商品データを格納するテーブルの中に「果汁100%ジュース」という商品が存在し、これを"100%"というキーワードで検索したい場合があるとする。  
しかし、「%」は、ワイルドカードなので、"`100%`"をそのまま使った場合は、"100個"や"1000台"等も検索対象になる。  

`%`などのワイルドカードを検索文字の一部として使うためには`ESCAPE句`を使用する。  

``` sql
SELECT * FROM 商品
WHERE 商品名 LIKE '果汁100\%%' ESCAPE '\'
```

「`ESCAPE '\'`」と記述すると、「`\`マークがあった場合に、次の文字をワイルドカードとはみなさい」とすることができる。  
「`100\%%`」の最後の`%`は、ワイルドカード文字なので、"100%オレンジ"や"100%リンゴ"などを検索できるようになる。  

---

## ワイルドカードとしての`[]`

SQLServerでは、LIKE演算子のワイルドカードに、大かっこ`[]`もある。  
しかし、これは`ANSI SQL92規格`ではないなので、他のデータベースで利用することはできない。  

大かっこを利用すると、`[]`内に指定した任意の1文字をOR条件で検索できるようになる。  
例えば、`[ABC]`と記述すれば 「AまたはBまたはC」 を条件に検索できる。  
また、`[A-D]`のようにハイフン`[-]`で範囲を指定すれば、「AまたはBまたはCまたはD(AからDまでのいずれかの1文字)」と指定することができる。  
`[0-9]`と記述した場合は、「0から9まで」の数字を条件に検索できる。  

次のように、「あ行」で始まる社員を取得するのも簡単に行える。(ふりがな列がある場合)  

``` sql
SELECT * FROM 社員 WHERE ふりがな LIKE '[あ-お]%'
```

---

## 基本情報技術者過去問題 平成31年春期 午後問3

エ : `= '201%'`  

ワイルドカードを使用した文字列は、LIKE句と同時に使用しなければ効果を生じません。  
年度が"201%"の行は存在しませんので結果は0行になります。  

エを選択したけど、との事。  

`_`が任意の1文字だとは知らなかった。  
つまり、普段よく使っている`LIKE '%○○%'`は、どこでもいいから○○があるかどうかを調べているってわけか。  
