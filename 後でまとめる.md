# 後でまとめたいやつら

## 最近見つかったシンプルなソート法

``` C#
var array = new int[2,4,5,6,4,6,8,2,8,9,4];

for(var i = 0 ; array.length; i++){
    for(var j = 0 ; array.length; j++){
        if (array[j] < array[i]){
            swap(array[i],array[j]);
        }
    }
}

// O(n^2)
```


## 添付プロパティ

例えば、テキストボックスとボタンがあります。
カーソルが当たっている間は色を変えたいけれど、どちらにもその機能はない。
それぞれを継承して拡張した、CustomButton,CustomTextを作ってもいいけど、どちらにも同じコードを書くことになるし作ること自体に手間がかかる。
そういう時に添付プロパティなるものを作って、それをテキストボックスとボタンに実装してあげることで、その機能を実現することができる。
それが、添付プロパティ。

どうやって作るかは後でまとめる。



DependencyProperty→バインディングができるようにする。コントロールにそういう機能がある。

INotify
Classに実装。

バインディングをしたときに、バインド間で通知をしてくれる。
この処理は.Net側の処理なので、その先で何をやっているかはわからない。

CollectionChanged。

ObsColle 
Foreachの中で、inに入れるコレクションの内容が変わった時にエラーが発生する。
これは、イベントが邪魔をしている証拠。
抑制する必要がある。

## インスタンスの状態

[[C# 入門] クラスのインスタンスについて](https://yaspage.com/prog/csharp/cs-instance/)  

DependencyPropertyのBindingの件で東さんがインスタンスの状態なんて事を言っていたので調べたわけだが、  
それとは別にインスタンスについての基礎を紹介しているページがわかりやすかったのでまとめる。  

後日、東さんがまた使っていたので、意味合いから想像すると、例えばLinqで.Where()を実行したときと、.ToList()を実行したときでは、戻ってくる値が違うわけで、  
東さんはどうやら帰ってくる型の事をインスタンスの状態と言っている見たいだ。  

---

## C# プレースホルダー中におけるToStringFormatの指定

SettlementAmount.ToString("N0") → SettlementAmount:N0  
に省略できるらしい。便利。  

因みにToStringするときに文字列で指定するこれは、「書式設定」というらしい。  
そのまんまだね。  
これはプレースホルダー中で有効な機能なだけだった。
C#Ver6からの機能みたい。

``` C#
$"支払額{SettlementAmount:N0}円を人数{TargetPlayerCount}人で均等に割り付けます。{Environment.NewLine}よろしいですか？"
```

[【C#6.0～】文字列補間（$を使った文字列書式設定）](https://imagingsolution.net/program/string_interpolation/)  

---

## staticクラスでthisが使えないのはなぜか？

①スタティックって結局何なのか？  
②staticクラスのメンバーにthisでアクセスできないのはなぜなのか？  

### ①スタティックって結局何なのか？  

[C#初心者のための基礎！staticスタティックの意味と使い方を解説#25](https://anderson02.com/cs/cskiso/cskisoniwari-25/)  

staticはインスタンスを生成しない。  
staticはプログラム実行時にメモリ領域が確保される。  
なので、そのアプリケーションにただ1つだけ生成したい時に使用される。  
staticの用途としては、最初に1回定義したら後は変更されないような情報になるので、データベース接続情報などが適している。  

※インスタンスを生成するということはヒープ領域から領域を拝借するのだから、  
1回だけということはサイズは決まっているので、おそらくスタック領域に展開されるはず。  

### ②staticクラスのメンバーにthisでアクセスできないのはなぜなのか？  

[staticメソッド内でstaticでないメンバを参照できない理由](https://shirakamisauto.hatenablog.com/entry/2015/06/15/181428)  

thisは自分自身のインスタンスを参照する命令。  
staticはインスタンスを生成しないのは①でやった通り。  
インスタンスが存在しないのだから、自分自身のインスタンスにアクセスできるわけがないので、staticクラスでthisは使えない。  

### その他

[staticクラス、staticメソッドの意味と利点](https://teratail.com/questions/174252)  
インスタンス毎に返す値が違うならstaticでないほうがいいし、Mathのsqrtのように誰がどう計算してもそうなるしかないものはstaticであるほうがいい。  
なぜならインスタンス毎に挙動が変わって欲しくないし、そういう共通で使う処理は起動時に一回だけメモリに確保して、いつでも使えるようにしたほうが効率がいいし、  
いちいちnewしてメモリを確保する手間がいらない。  

[わい、static変数とstaticメソッドについて熱く語る](https://qiita.com/Nekonecode/items/19f3a261a8391853ddec)  

---

アプリケーション マニフェスト [application manifest]
アプリケーションおよびそのすべての構成ファイルを記述するファイル。ClickOnce アプリケーションによって使用されます。


---

## 雑記

・俺が仕様書メモとしてまとめてる内容は全て開発フォルダの仕様書フォルダに乗っけておけばいいのでは？
メモ書き程度のやつは上に持っていくのはどうかな。

・ネットワーク
・C# 配列
・バニラのWPFで最小のMVVMサンプルを作ってみたい
・UTF-8,UNICODE,ShiftJis
・配列はjavaだけ。


・skip,takeをまとめたい。skipの存在を知らなかったからreverse.take.reverseなんてくそ面倒くさいことして実現したのもまとめたい。
・linqで文字列をjoinするサンプルがわかりずらいので修正したい。
・javaのジェネリックのまとめをしたい。

・隙間時間は、用語集の確認に使いたい。
・それらがまとめ終わってから令和3年の午前問題の続きをする。
・昨日やったselectmanyとgroupbyのやつもまとめたい。


sql インデックス 仕組み
[インデックスとは？仕組みをわかりやすく解説](https://products.sint.co.jp/siob/blog/index)

[Dispose の意味が未だわからないのですが](https://atmarkit.itmedia.co.jp/bbs/phpBB/viewtopic.php?topic=34497&forum=7)  

[take,skip](https://symfoware.blog.fc2.com/blog-entry-1927.html)
[selectMany](https://www.urablog.xyz/entry/2018/05/28/070000#SelectMany%E3%82%92%E4%BD%BF%E3%81%86)
[groupby](https://www.urablog.xyz/entry/2018/07/07/070000)
[groupbyして先頭](https://entityframework.net/knowledge-base/3850429/get-the-first-record-of-a-group-in-linq-)
<https://stackoverflow.com/questions/19012986/how-to-get-first-record-in-each-group-using-linq/39932057>

``` C#
// やりたいこと割り勘の伝票IDを取得して、重複を排除して、それが2件以上あれば、別々で割り勘を実行した人がいるという事なので、呼び出せないようにしたい。
// ついでに、誰と誰が別々に割り勘しているのかをアナウンスしたいので、求めた伝票IDを持っている人の中でそれぞれ先頭の人だけを抜き出したい。
// 意外と難しかった。SelectManyとGroupByを組み合わせてうまい事出来たので、まとめる。
var count = SettlementDetailList
   // 割り勘の伝票IDを取得
   .Select(s => s.SlipList.FirstOrDefault(w => w.SlipType == SlipType.DutchTreat)?.SlipID)
   // 同じ伝票IDはカウントしない。
   .Distinct()
   // nullを除いた結果が2以上なら、別々の割り勘伝票の人をセットしているのでダメ。
   .Count(c => c != null);

if (count >= 2)
{
    MessageDialogUtil.ShowWarning(Messenger,"dame");
    return;
};

// 組み合わせ始め。何がしたいかわからないね。
IEnumerable<string> targetPlayerList = SettlementDetailList
    .SelectMany(
        p => p.SlipList,
        (s, slip) => new { s.AccountNo, s.ReservationPlayerName, slip }
    )
    .Where(w => dutchTreatSlipIDList.Contains(w.slip.SlipID))
    .Select(s => $"【{s.AccountNo}】【{s.ReservationPlayerName}】様")
    .ToList();


// とりあえず完成形。
// IDだけは別で抜き出さないといけないのがちょっとあれだけど、頑張ればいけそうな気もする。
IEnumerable<string> dutchTreatSlipIDList = SettlementDetailList
    // 割り勘の伝票IDを取得
    .Select(s => s.SlipList.FirstOrDefault(w => w.SlipType == SlipType.DutchTreat)?.SlipID)
    .Distinct()
    .Where(w => w != null)
    .ToList();
if (dutchTreatSlipIDList.Count() >= 2)
{
    IEnumerable<string> targetPlayerList = SettlementDetailList
        .SelectMany(
            p => p.SlipList,
            (s, slip) => (s.AccountNo, s.ReservationPlayerName, slip.SlipID)
        )
        .Where(w => dutchTreatSlipIDList.Contains(w.SlipID))
        .GroupBy(
            p => p.SlipID,
            // SlipIDでグループ化したうち、先頭のデータのみ取得する
            (k, v) => (key: k, value: v.FirstOrDefault())
        )
        .Select(s => $"【{s.value.AccountNo}】【{s.value.ReservationPlayerName}】様")
        .ToList();
    var msg = string.Join(" と ", targetPlayerList) + " はそれぞれで既に割り勘済みのため、割り勘を開くことができません。";
    MessageDialogUtil.ShowWarning(Messenger, msg);
    return;
}
```

[C# LINQで特定の値を先頭にして並び替え](https://teratail.com/questions/120228)  
